<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Effect C++ç¬”è®° | EmberğŸ</title><meta name="author" content="EmberğŸ"><meta name="copyright" content="EmberğŸ"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Effective C++ çš„éƒ¨åˆ†å­¦ä¹ ç¬”è®°">
<meta property="og:type" content="article">
<meta property="og:title" content="Effect C++ç¬”è®°">
<meta property="og:url" content="http://www.ember-l.top/2023/01/20/C++/Effective%20C++/index.html">
<meta property="og:site_name" content="EmberğŸ">
<meta property="og:description" content="Effective C++ çš„éƒ¨åˆ†å­¦ä¹ ç¬”è®°">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ember-img.oss-cn-chengdu.aliyuncs.com/img32.jpg">
<meta property="article:published_time" content="2023-01-20T14:23:24.000Z">
<meta property="article:modified_time" content="2023-01-20T14:41:00.387Z">
<meta property="article:author" content="EmberğŸ">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Effective C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ember-img.oss-cn-chengdu.aliyuncs.com/img32.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.ember-l.top/2023/01/20/C++/Effective%20C++/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"FNCTP04VYC","apiKey":"5edd8c47a13fcf53938686d6f1752dbb","indexName":"dev_blog","hits":{"per_page":10},"languages":{"input_placeholder":"æœç´¢æ–‡ç« ","hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: EmberğŸ","link":"é“¾æ¥: ","source":"æ¥æº: EmberğŸ","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Effect C++ç¬”è®°',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-20 22:41:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/font.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/wave.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/progress_bar.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/readPercent.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3864328_90xjkz8cfrn.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><span id="fps"></span><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/twikoo_beautify.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/tag.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/Swiper/8.0.6/swiper-bundle.min.css"><script data-pjax src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/Swiper/8.0.6/swiper-bundle.min.js"></script><link rel="stylesheet" href="/css/barrage.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><script type="text/javascript" src ="/js/reward.js" ></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="/css/precess_bar.css"/><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/assets/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-SmartHome"></use></svg><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shuji"></use></svg><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zongheshuju">                   </use></svg><span> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fabu-">                   </use></svg><span> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei">                   </use></svg><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenxiang">                   </use></svg><span> éšä¾¿é€›é€›</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-meishikafei"></use></svg><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle">                   </use></svg><span> éŸ³ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Gallery/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fabu-">                   </use></svg><span> ç…§ç‰‡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-dianying">                   </use></svg><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shijie"></use></svg><span> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-pengyouquan">                   </use></svg><span> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Gallery/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyan">                   </use></svg><span> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie">                   </use></svg><span> å‹äººé“¾</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-wangye"></use></svg><span> å°ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon--tongjibiao">                   </use></svg><span> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/article/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon--tongjibiao">                   </use></svg><span> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span> ç”Ÿæ¶¯</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-doughnut"></use></svg><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://ember-img.oss-cn-chengdu.aliyuncs.com/img32.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">EmberğŸ</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-SmartHome"></use></svg><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shuji"></use></svg><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zongheshuju">                   </use></svg><span> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fabu-">                   </use></svg><span> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenlei">                   </use></svg><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fenxiang">                   </use></svg><span> éšä¾¿é€›é€›</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-meishikafei"></use></svg><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-yinle">                   </use></svg><span> éŸ³ä¹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Gallery/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fabu-">                   </use></svg><span> ç…§ç‰‡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-dianying">                   </use></svg><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shijie"></use></svg><span> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-pengyouquan">                   </use></svg><span> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Gallery/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyan">                   </use></svg><span> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-lianjie">                   </use></svg><span> å‹äººé“¾</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-wangye"></use></svg><span> å°ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon--tongjibiao">                   </use></svg><span> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/article/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon--tongjibiao">                   </use></svg><span> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span> ç”Ÿæ¶¯</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-food-doughnut"></use></svg><span> å…³äº</span></a></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:25px;width:25px;fill:currentColor;position:relative;top:2px;right:8px;" aria-hidden="true"><use xlink:href="#icon-sousuo"></use></svg><span> æœç´¢</span></a></div><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:5px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">   </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Effect C++ç¬”è®°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-01-20T14:23:24.000Z" title="å‘è¡¨äº 2023-01-20 22:23:24">2023-01-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-01-20T14:41:00.387Z" title="æ›´æ–°äº 2023-01-20 22:41:00">2023-01-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C/">C++</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">2.3w</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>99åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Effect C++ç¬”è®°"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Effective-C"><a href="#Effective-C" class="headerlink" title="Effective C++"></a>Effective C++</h1><blockquote>
<p>Effectiveå­¦ä¹ ç¬”è®°</p>
</blockquote>
<h1 id="è®©è‡ªå·±ä¹ æƒ¯C"><a href="#è®©è‡ªå·±ä¹ æƒ¯C" class="headerlink" title="è®©è‡ªå·±ä¹ æƒ¯C++"></a>è®©è‡ªå·±ä¹ æƒ¯C++</h1><h2 id="æ¡æ¬¾01"><a href="#æ¡æ¬¾01" class="headerlink" title="æ¡æ¬¾01"></a>æ¡æ¬¾01</h2><p>C++é«˜æ•ˆç¼–ç¨‹æ—¶æƒ…å†µè€Œå˜ï¼Œå–å†³äºä½ ä½¿ç”¨C++çš„é‚£ä¸€éƒ¨åˆ†</p>
<hr>
<h2 id="æ¡æ¬¾02ï¼šå°½é‡ä»¥constï¼Œenumï¼Œinlineæ›¿æ¢-define"><a href="#æ¡æ¬¾02ï¼šå°½é‡ä»¥constï¼Œenumï¼Œinlineæ›¿æ¢-define" class="headerlink" title="æ¡æ¬¾02ï¼šå°½é‡ä»¥constï¼Œenumï¼Œinlineæ›¿æ¢#define"></a>æ¡æ¬¾02ï¼šå°½é‡ä»¥constï¼Œenumï¼Œinlineæ›¿æ¢#define</h2><p><code>Perfer consts enum and inlines to #define</code></p>
<h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦For simple constants, prefer const objects or enums to #defines.</p>
<p>âœ¦For function-like macros, prefer inline functions to #defines.</p>
<hr>
<h2 id="æ¡æ¬¾03ï¼šå°½å¯èƒ½ä½¿ç”¨const"><a href="#æ¡æ¬¾03ï¼šå°½å¯èƒ½ä½¿ç”¨const" class="headerlink" title="æ¡æ¬¾03ï¼šå°½å¯èƒ½ä½¿ç”¨const"></a>æ¡æ¬¾03ï¼šå°½å¯èƒ½ä½¿ç”¨const</h2><p><code>Use const whenever possible</code></p>
<h3 id="constæˆå‘˜å‡½æ•°"><a href="#constæˆå‘˜å‡½æ•°" class="headerlink" title="constæˆå‘˜å‡½æ•°"></a>constæˆå‘˜å‡½æ•°</h3><blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ol>
<li><p>ä»–ä»¬ä½¿classæ¥å£æ¯”è¾ƒå®¹æ˜“è¢«ç†è§£ï¼Œå¯ä»¥å¾—çŸ¥é‚£ä¸ªå‡½æ•°å¯ä»¥æ”¹åŠ¨å¯¹è±¡æˆå‘˜ï¼Œé‚£ä¸ªä¸èƒ½</p>
</li>
<li><p>ä»–ä»¬ä½¿ç”¨â€œæ“ä½œconstå¯¹è±¡â€æˆä¸ºå¯èƒ½ã€‚</p>
</li>
</ol>
<blockquote>
<p>constness</p>
</blockquote>
<p>å½“ä¸¤ä¸ªæˆå‘˜å‡½æ•°å¦‚æœåªæ˜¯å¸¸é‡æ€§ä¸åŒï¼Œå°±å¯ä»¥ç”¨constæ¥é‡è½½</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TextBlock</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">...</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>&amp; <span class="keyword">operator</span>[ ](std::<span class="type">size_t</span> position) <span class="type">const</span></span><br><span class="line">                         <span class="comment">// operator[ ] for&#123; return text[position]; &#125;</span></span><br><span class="line">                        <span class="comment">// const objects</span></span><br><span class="line"><span class="type">char</span>&amp; <span class="keyword">operator</span>[ ](std::<span class="type">size_t</span> position)  </span><br><span class="line">                        <span class="comment">// operator[ ] for&#123; return text[position]; &#125;</span></span><br><span class="line">                        <span class="comment">// non-const objects</span></span><br><span class="line"><span class="keyword">private</span>: </span><br><span class="line">    std::string text;</span><br><span class="line">&#125;;</span><br><span class="line">===============================================</span><br><span class="line"><span class="comment">//TextBlockâ€™s operator[]s can be used like this:</span></span><br><span class="line">TextBlock <span class="built_in">tb</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">std::cout &lt;&lt; tb[<span class="number">0</span>];    <span class="comment">// calls non-const TextBlock::operator[]</span></span><br><span class="line"><span class="function"><span class="type">const</span> TextBlock <span class="title">ctb</span><span class="params">(<span class="string">&quot;World&quot;</span>)</span></span>;</span><br><span class="line">std::cout &lt;&lt; ctb[<span class="number">0</span>];    <span class="comment">// calls const TextBlock::operator[]</span></span><br></pre></td></tr></table></figure>
<h3 id="åœ¨constå’Œnon-constæˆå‘˜å‡½æ•°ä¸­é¿å…é‡å¤"><a href="#åœ¨constå’Œnon-constæˆå‘˜å‡½æ•°ä¸­é¿å…é‡å¤" class="headerlink" title="åœ¨constå’Œnon-constæˆå‘˜å‡½æ•°ä¸­é¿å…é‡å¤"></a>åœ¨constå’Œnon-constæˆå‘˜å‡½æ•°ä¸­é¿å…é‡å¤</h3><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Declaring something const helps compilers detect usage errors. constcan be applied to objects at any scope, to function parameters andreturn types, and to member functions as a whole.</p>
<p>âœ¦Compilers enforce bitwise constness, but you should program usinglogical constness.</p>
<p>âœ¦When const and non-const member functions have essentially identi-cal implementations, code duplication can be avoided by having thenon-const version call the const version.</p>
<hr>
<h2 id="æ¡æ¬¾04ï¼šç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²ç»å…ˆè¢«åˆå§‹åŒ–"><a href="#æ¡æ¬¾04ï¼šç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²ç»å…ˆè¢«åˆå§‹åŒ–" class="headerlink" title="æ¡æ¬¾04ï¼šç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²ç»å…ˆè¢«åˆå§‹åŒ–"></a>æ¡æ¬¾04ï¼šç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²ç»å…ˆè¢«åˆå§‹åŒ–</h2><p><code>Make sure that object are initialized before they&#39;re used</code></p>
<h3 id="åˆå§‹åŒ–ä¸èµ‹å€¼"><a href="#åˆå§‹åŒ–ä¸èµ‹å€¼" class="headerlink" title="åˆå§‹åŒ–ä¸èµ‹å€¼"></a>åˆå§‹åŒ–ä¸èµ‹å€¼</h3><blockquote>
<p>è§„åˆ™</p>
</blockquote>
<p>æ°¸è¿œåœ¨ä½¿ç”¨å¯¹è±¡ä¹‹å‰å°†å®ƒåˆå§‹åŒ–ã€‚å¯¹äºå†…ç½®å†…çœå¿…é¡»è¦æ‰‹å·¥å®Œæˆåˆå§‹åŒ–</p>
<p>å¯¹äºè‡ªå®šä¹‰ç±»å‹æ¥è¯´ï¼Œåˆå§‹åŒ–èŒè´£æ”¾åœ¨æ„é€ å‡½æ•°ä¸Š</p>
<blockquote>
<p>èµ‹å€¼ä¸åˆå§‹åŒ–</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhoneNumber</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ABEntry</span> &#123;<span class="comment">// ABEntry = â€œAddress Book Entryâ€</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">ABEntry</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> std::string&amp; address,</span><br><span class="line">        <span class="type">const</span> std::list&lt;PhoneNumber&gt;&amp; phones);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string theName;</span><br><span class="line">    std::string theAddress;</span><br><span class="line">    std::list&lt;PhoneNumber&gt; thePhones;</span><br><span class="line">    <span class="type">int</span> numTimesConsulted;</span><br><span class="line">&#125;;</span><br><span class="line">ABEntry::<span class="built_in">ABEntry</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> std::string&amp; address,</span><br><span class="line">            <span class="type">const</span> std::list&lt;PhoneNumber&gt;&amp; phones)</span><br><span class="line">&#123;</span><br><span class="line">Â Â Â Â theName = name;<span class="comment">// these are all assignments,</span></span><br><span class="line">Â Â Â Â theAddress = address;<span class="comment">// not initializations</span></span><br><span class="line">Â Â Â Â thePhones = phones;</span><br><span class="line">Â Â Â Â numTimesConsulted = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆå§‹åŒ–</p>
</blockquote>
<p>æˆå‘˜å˜é‡åˆå§‹åŒ–åŠ¨ä½œå‘ç”Ÿåœ¨è¿›å…¥æ„é€ å‡½æ•°æœ¬ä½“ä¹‹å‰ï¼Œç›¸å¯¹äºèµ‹å€¼æ¥è¯´å‘ç”Ÿæ—¶é—´æ›´æ—©ã€‚</p>
<h3 id="åˆå§‹åŒ–åˆ—è¡¨"><a href="#åˆå§‹åŒ–åˆ—è¡¨" class="headerlink" title="åˆå§‹åŒ–åˆ—è¡¨"></a>åˆå§‹åŒ–åˆ—è¡¨</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ABEntry::<span class="built_in">ABEntry</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> std::string&amp; address,</span><br><span class="line">        <span class="type">const</span> std::list&lt;PhoneNumber&gt;&amp; phones): </span><br><span class="line">        <span class="built_in">theName</span>(name),</span><br><span class="line">        <span class="built_in">theAddress</span>(address),<span class="comment">// these are now all initializations</span></span><br><span class="line">        <span class="built_in">thePhones</span>(phones),</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="built_in">numTimesConsulted</span>(<span class="number">0</span>)</span><br><span class="line">&#123;&#125;<span class="comment">// the ctor body is now empty</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆå§‹åŒ–ä¼˜ç‚¹</p>
</blockquote>
<p>é€šå¸¸æ•ˆç‡è¾ƒé«˜ï¼›</p>
<p><strong>èµ‹å€¼ç‰ˆæœ¬</strong>ï¼šå…ˆè°ƒç”¨æ„é€ å‡½æ•°ä¸ºæˆå‘˜å˜é‡èµ‹äºˆåˆå€¼ï¼Œç„¶åç«‹åˆ»åœ¨å¯¹ä»–ä»¬èµ‹äºˆæ–°å€¼ï¼ˆä¼ å…¥çš„å®å‚ï¼‰ã€‚å› æ­¤ä¼šæµªè´¹ä¸€éƒ¨åˆ†æ—¶é—´</p>
<p><strong>åˆå§‹åŒ–ç‰ˆæœ¬</strong>ï¼šæˆå‘˜åˆå§‹åˆ—ä¸­é’ˆå¯¹å„ä¸ªæˆå‘˜å˜é‡è€Œè®¾çš„å®å‚ï¼Œè¢«æ‹¿å»ä½œä¸ºå„æˆå‘˜ä¹‹æ„é€ å‡½æ•°çš„å®å‚ã€‚</p>
<blockquote>
<p>å¿…é¡»åˆå§‹åŒ–çš„æƒ…å†µ</p>
</blockquote>
<p>ä¾‹å¦‚ï¼šæˆå‘˜å˜é‡ä¸ºconstæˆ–referencesï¼Œå¿…é¡»è¦è¿›è¡Œæˆå‘˜åˆå§‹åˆ—è¡¨</p>
<p><strong>ç»¼è¿°ï¼š</strong> ä¸€èˆ¬æƒ…å†µæ€»æ˜¯ä½¿ç”¨æˆå‘˜åˆå§‹åˆ—è¡¨ï¼Œå¯ä»¥é’ˆå¯¹æ™®éçš„å˜é‡ï¼Œè€Œä¸”æ¯”èµ‹å€¼æ›´é«˜æ•ˆ</p>
<h3 id="æˆå‘˜åˆå§‹åŒ–æ¬¡åº"><a href="#æˆå‘˜åˆå§‹åŒ–æ¬¡åº" class="headerlink" title="æˆå‘˜åˆå§‹åŒ–æ¬¡åº"></a>æˆå‘˜åˆå§‹åŒ–æ¬¡åº</h3><ul>
<li><p>base class -&gt; derived class </p>
</li>
<li><p><strong>æˆå‘˜å˜é‡ä»¥è¢«å£°æ˜çš„æ¬¡åºè¿›è¡Œåˆå§‹åŒ–</strong>å› æ­¤å¯¹äºç¤ºä¾‹ABEntry ä¸­theName æœ€å…ˆè¢«åˆå§‹åŒ–ï¼Œç„¶åæ˜¯theAddressï¼Œå†æ˜¯thePhoneï¼Œæœ€åæ˜¯numTimesConsulted.</p>
</li>
</ul>
<h3 id="staticå¯¹è±¡"><a href="#staticå¯¹è±¡" class="headerlink" title="staticå¯¹è±¡"></a>staticå¯¹è±¡</h3><blockquote>
<p>ç”Ÿå‘½å‘¨æœŸ</p>
</blockquote>
<p>ä»è¢«æ„é€ å‡ºæ¥ç›´åˆ°ç¨‹åºç»“æŸï¼Œå› æ­¤ä¸æ˜¯å †æ ˆå¯¹è±¡ã€‚</p>
<blockquote>
<p>å®šä¹‰</p>
</blockquote>
<p>ä¸€èˆ¬è¿™ç§å¯¹è±¡è¢«å®šä¹‰ä¸ºglobalå¯¹è±¡ã€å®šäºäºnamspaceä½œç”¨åŸŸã€classesã€å‡½æ•°å†…ã€ä»¥åŠfileä½œç”¨å†…å£°æ˜ä¸ºstaticçš„å¯¹è±¡</p>
<blockquote>
<p>local staticä¸non-local staticå¯¹è±¡</p>
</blockquote>
<p><strong>long staticå¯¹è±¡</strong>ï¼šå®šä¹‰åŸŸå‡½æ•°å†…ï¼Œå› ä¸ºå®ƒå¯¹äºå‡½æ•°è€Œè¨€æ˜¯local</p>
<p><strong>non-local staticå¯¹è±¡</strong>ï¼šå…¶ä»–å‰©ä½™çš„staticå¯¹è±¡</p>
<h3 id="å¤šæºæ–‡ä»¶è·¨ç¼–è¯‘å•å…ƒç¼–è¯‘"><a href="#å¤šæºæ–‡ä»¶è·¨ç¼–è¯‘å•å…ƒç¼–è¯‘" class="headerlink" title="å¤šæºæ–‡ä»¶è·¨ç¼–è¯‘å•å…ƒç¼–è¯‘"></a>å¤šæºæ–‡ä»¶è·¨ç¼–è¯‘å•å…ƒç¼–è¯‘</h3><p>ä¸€èˆ¬è‡³å°‘åº”è¯¥non-local staticå¯¹è±¡</p>
<blockquote>
<p>é—®é¢˜</p>
</blockquote>
<p>æŸç¼–è¯‘å•å…ƒå†…çš„æŸä¸ªnon-local staticå¯¹è±¡åˆå§‹åŒ–åŠ¨ä½œä½¿ç”¨äº†å¦ä¸€ä¸ªç¼–è¯‘å•å…ƒå†…çš„æŸä¸ªç¼–è¯‘å•å…ƒå†…çš„æŸä¸ªnon-local staticå¯¹è±¡ï¼Œå®ƒæ‰€ç”¨åˆ°çš„è¿™ä¸ªå¯¹è±¡å¯èƒ½æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå› ä¸ºc++å¯¹äº <strong>â€å®šä¹‰åœ¨ä¸åŒç¼–è¯‘å•å…ƒçš„non-localå¯¹è±¡é‚£ä¸ªâ€œåˆå§‹åŒ–æ¬¡åºæ²¡æœ‰æ˜ç¡®çš„è§„å®š</strong></p>
<h4 id="non-local-static-å¯¹è±¡åˆå§‹åŒ–æ¬¡åºé—®é¢˜"><a href="#non-local-static-å¯¹è±¡åˆå§‹åŒ–æ¬¡åºé—®é¢˜" class="headerlink" title="non-local static å¯¹è±¡åˆå§‹åŒ–æ¬¡åºé—®é¢˜"></a>non-local static å¯¹è±¡åˆå§‹åŒ–æ¬¡åºé—®é¢˜</h4><blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileSystem</span> &#123;<span class="comment">// from your libraryâ€™s header file</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">...</span><br><span class="line"><span class="function">std::<span class="type">size_t</span> <span class="title">numDisks</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// one of many member functions</span></span><br><span class="line">...</span><br><span class="line">&#125;; </span><br><span class="line"><span class="keyword">extern</span> FileSystem tfs;<span class="comment">// declare object for clients to use// (â€œtfsâ€ = â€œthe file systemâ€ ); definition// is in some .cpp file in your library</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span> &#123;<span class="comment">// created by library client</span></span><br><span class="line"><span class="keyword">public</span>: </span><br><span class="line"><span class="built_in">Directory</span>( params );...&#125;;</span><br><span class="line">Directory::<span class="built_in">Directory</span>( params )</span><br><span class="line">&#123;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â Â Â std::<span class="type">size_t</span> disks = tfs.<span class="built_in">numDisks</span>( );<span class="comment">// use the tfs object</span></span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡è®¾ï¼šç”¨æˆ·å†³å®šåˆ›å»ºåº”è¯¥Directoryå¯¹è±¡ï¼Œç”¨æ¥æ”¾ç½®ä¸´æ—¶æ–‡ä»¶</p>
<p>Directory tempDir{params}ï¼›</p>
<blockquote>
<p>åˆå§‹åŒ–æ¬¡åºçš„é‡è¦æ€§</p>
</blockquote>
<p>é™¤étfsåœ¨tempDirå…ˆè¢«åˆå§‹åŒ–ï¼Œå¦åˆ™tempDirä¼šç”¨åˆ°å°šæœªåˆå§‹åŒ–çš„tfsã€‚ï¼ˆä½†æ˜¯tfså’ŒtempDiræ˜¯è¢«ä¸åŒäººåœ¨ä¸åŒæ—¶é—´åˆ›å»ºçš„ï¼‰ï¼Œä»–ä»¬æ˜¯ä¸åŒç¼–è¯‘å•å…ƒçš„non-localå¯¹è±¡</p>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>å°†æ¯ä¸ªnon-localå¯¹è±¡æ¬åˆ°æ€»ç»“ä¸“å±çš„å‡½æ•°å†…ï¼ˆå‡½æ•°ä¹Ÿè¦å£°æ˜ä¸ºstaticï¼‰ã€</p>
<p>è¿™äº›å‡½æ•°è¿”å›åº”è¯¥referenceæŒ‡å‘å®ƒæ‰€å«çš„å¯¹è±¡ã€‚ç„¶åç”¨æˆ·è°ƒç”¨è¿™äº›å‡½æ•°</p>
<blockquote>
<p> C++ä¿è¯</p>
</blockquote>
<p>å‡½æ•°å†…çš„local staticå¯¹è±¡ä¼šåœ¨<u>â€è¯¥å‡½æ•°è°ƒç”¨æœŸé—´â€œâ€é¦–æ¬¡é‡åˆ°è¯¥å¯¹è±¡çš„å®šä¹‰å¼â€</u>æ—¶è¢«åˆå§‹åŒ–ã€‚</p>
<p>å› æ­¤å¦‚æœç”¨â€å‡½æ•°è°ƒç”¨â€œ(è¿”å›åº”è¯¥referenceæŒ‡å‘local staticå¯¹è±¡)æ›¿æ¢â€ç›´æ¥è®¿é—®non-local staticå¯¹è±¡â€œï¼Œå°±è·å¾—äº†ä¿è¯ï¼Œä¿è¯ä½ æ‰€è·å¾—referenceå°†æŒ‡å‘åº”è¯¥å†ç»åˆå§‹åŒ–çš„å¯¹è±¡ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<p>ä»æœªè°ƒç”¨non-local staticå¯¹è±¡çš„â€ä»¿çœŸå‡½æ•°â€œï¼Œå°±ç»ä¸ä¼šå¼•å‘æ„é€ å’Œææ„æˆæœ¬</p>
<blockquote>
<p>ä¼˜åŒ–ä»£ç </p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileSystem</span> &#123; ... &#125;; <span class="comment">// as before</span></span><br><span class="line"><span class="function">FileSystem&amp; <span class="title">tfs</span><span class="params">( )</span><span class="comment">// this replaces the tfs object; it could be</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Â Â Â Â <span class="comment">// static in the FileSystem class</span></span><br><span class="line">Â Â Â Â <span class="type">static</span> FileSystem fs;<span class="comment">// define and initialize a local static object</span></span><br><span class="line">Â Â Â Â <span class="keyword">return</span> fs;<span class="comment">// return a reference to it</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span> &#123; ... &#125;;<span class="comment">// as before</span></span><br><span class="line">Directory::<span class="built_in">Directory</span>( params )<span class="comment">// as before, except references to tfs are </span></span><br><span class="line">&#123;<span class="comment">// now to tfs( )</span></span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â Â Â std::<span class="type">size_t</span> disks = <span class="built_in">tfs</span>().<span class="built_in">numDisks</span>( );</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Directory&amp; <span class="title">tempDir</span><span class="params">( )</span><span class="comment">// this replaces the tempDir object; it</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">            <span class="comment">// could be static in the Directory class</span></span><br><span class="line">Â Â Â Â <span class="function"><span class="type">static</span> Directory <span class="title">td</span><span class="params">( params )</span></span>;<span class="comment">// define/initialize local static object</span></span><br><span class="line"></span><br><span class="line">Â Â Â Â <span class="keyword">return</span> td;<span class="comment">// return reference to it</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“ï¼š-1"><a href="#æ€»ç»“ï¼š-1" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Manually initialize objects of built-in type, because C++ only some-times initializes them itself.</p>
<p>âœ¦In  a  constructor,  prefer  use  of  the  member  initialization  list  to  assignment  inside  the  body  of  the  constructor.  List  data  members  in the initialization list in the same order theyâ€™re declared in the class.</p>
<p>âœ¦Avoid  initialization  order  problems  across  translation  units  by  re-placing non-local static objects with local static objects.</p>
<h1 id="æ„é€ -ææ„-èµ‹å€¼è¿ç®—"><a href="#æ„é€ -ææ„-èµ‹å€¼è¿ç®—" class="headerlink" title="æ„é€ /ææ„/èµ‹å€¼è¿ç®—"></a>æ„é€ /ææ„/èµ‹å€¼è¿ç®—</h1><h2 id="æ¡æ¬¾05ï¼šäº†è§£C-é»˜è®¤ç¼–å†™å’Œè°ƒç”¨äº†å“ªäº›å‡½æ•°"><a href="#æ¡æ¬¾05ï¼šäº†è§£C-é»˜è®¤ç¼–å†™å’Œè°ƒç”¨äº†å“ªäº›å‡½æ•°" class="headerlink" title="æ¡æ¬¾05ï¼šäº†è§£C++é»˜è®¤ç¼–å†™å’Œè°ƒç”¨äº†å“ªäº›å‡½æ•°"></a>æ¡æ¬¾05ï¼šäº†è§£C++é»˜è®¤ç¼–å†™å’Œè°ƒç”¨äº†å“ªäº›å‡½æ•°</h2><p><code>Know what functions C++silently writes and calls.</code></p>
<h3 id="æ€»ç»“ï¼š-2"><a href="#æ€»ç»“ï¼š-2" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Compilers may implicitly generate a classâ€™s default constructor, copyconstructor, copy assignment operator, and destructor</p>
<hr>
<h2 id="æ¡æ¬¾06ï¼šè‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œå°±å› è¯¥æ˜ç¡®çš„æ‹’ç»"><a href="#æ¡æ¬¾06ï¼šè‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œå°±å› è¯¥æ˜ç¡®çš„æ‹’ç»" class="headerlink" title="æ¡æ¬¾06ï¼šè‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œå°±å› è¯¥æ˜ç¡®çš„æ‹’ç»"></a>æ¡æ¬¾06ï¼šè‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œå°±å› è¯¥æ˜ç¡®çš„æ‹’ç»</h2><p><code>Explicitly disallow the use of compiler-generated functions you do not want.</code></p>
<h3 id="æ€»ç»“ï¼š-3"><a href="#æ€»ç»“ï¼š-3" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦To disallow functionality automatically provided by compilers, declare the corresponding member functions private and give no imple-mentations. Using a base class like private is one way to do this.</p>
<hr>
<h2 id="æ¡æ¬¾07ï¼šä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°"><a href="#æ¡æ¬¾07ï¼šä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°" class="headerlink" title="æ¡æ¬¾07ï¼šä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°"></a>æ¡æ¬¾07ï¼šä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span>&#123;</span><br><span class="line">    <span class="built_in">B</span>()&#123;std::cout&lt;&lt;<span class="string">&quot;B constrctor&quot;</span>&lt;&lt;std::endl;&#125;</span><br><span class="line">     ~<span class="built_in">B</span>()&#123;std::cout&lt;&lt;<span class="string">&quot;B destrutor&quot;</span>&lt;&lt;std::endl;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">D</span>:<span class="keyword">public</span> B&#123;</span><br><span class="line">    <span class="built_in">D</span>()&#123;std::cout&lt;&lt;<span class="string">&quot;D constrctor&quot;</span>&lt;&lt;std::endl;&#125;</span><br><span class="line">    ~<span class="built_in">D</span>()&#123;std::cout&lt;&lt;<span class="string">&quot;D destrutor&quot;</span>&lt;&lt;std::endl;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        D d;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;std::endl;</span><br><span class="line">    <span class="comment">//å¤šæ€</span></span><br><span class="line">    &#123;</span><br><span class="line">        B* pb = <span class="keyword">new</span> <span class="built_in">B</span>();</span><br><span class="line">        <span class="keyword">delete</span> pb;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout&lt;&lt;std::endl;</span><br><span class="line">    &#123;</span><br><span class="line">        B* pd = <span class="keyword">new</span> <span class="built_in">D</span>();</span><br><span class="line">        <span class="keyword">delete</span> pd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œç»“æœ</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">B constrctor</span><br><span class="line">D constrctor</span><br><span class="line">D destrutor</span><br><span class="line">B destrutor</span><br><span class="line"></span><br><span class="line">B constrctor</span><br><span class="line">B destrutor</span><br><span class="line"></span><br><span class="line">B constrctor</span><br><span class="line">D constrctor</span><br><span class="line">B destrutor</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“ï¼š-4"><a href="#æ€»ç»“ï¼š-4" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Polymorphic base classes should declare virtual destructors. If aclass has any virtual functions, it should have a virtual destructor.</p>
<p>âœ¦Classes not designed to be base classes or not designed to be usedpolymorphically should not declare virtual destructors.</p>
<hr>
<h2 id="æ¡æ¬¾08ï¼šåˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°"><a href="#æ¡æ¬¾08ï¼šåˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°" class="headerlink" title="æ¡æ¬¾08ï¼šåˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°"></a>æ¡æ¬¾08ï¼šåˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°</h2><p><code>prevent exception from leaving destruction</code></p>
<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Destructors should never emit exceptions. If functions called in adestructor may throw, the destructor should catch any exceptions,then swallow them or terminate the program.</p>
<p>âœ¦If class clients need to be able to re act to exceptions thrown duringan operation, the class should provide a regular (i.e., non-destruc-tor) function that performs the operation.</p>
<hr>
<h2 id="æ¡æ¬¾11ï¼šåœ¨operator-ä¸­â€œè‡ªæˆ‘èµ‹å€¼â€"><a href="#æ¡æ¬¾11ï¼šåœ¨operator-ä¸­â€œè‡ªæˆ‘èµ‹å€¼â€" class="headerlink" title="æ¡æ¬¾11ï¼šåœ¨operator=ä¸­â€œè‡ªæˆ‘èµ‹å€¼â€"></a>æ¡æ¬¾11ï¼šåœ¨operator=ä¸­â€œè‡ªæˆ‘èµ‹å€¼â€</h2><p><code>Handle assignment to self in operator=</code></p>
<p>ä»¥widgetçª—å£ç±»ä¸ºç¤ºä¾‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bitmap</span>&#123;...&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span>&#123;</span><br><span class="line">... </span><br><span class="line"><span class="keyword">private</span>ï¼š</span><br><span class="line">    Bit* pb;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Widget w;</span><br><span class="line">w = w; è‡ªæˆ‘èµ‹å€¼ </span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•ä¸€ï¼šè¯åŒæµ‹è¯•"><a href="#æ–¹æ³•ä¸€ï¼šè¯åŒæµ‹è¯•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šè¯åŒæµ‹è¯•"></a>æ–¹æ³•ä¸€ï¼šè¯åŒæµ‹è¯•</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span> == &amp;rhs)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">//è¯åŒæµ‹è¯•</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">delete</span> pbï¼›</span><br><span class="line">    pb = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.bp);Â Â Â Â <span class="comment">//é˜²æ­¢æµ…æ‹·è´é—®é¢˜</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¼‚å¸¸é—®é¢˜ï¼š</p>
</blockquote>
<p>new Bitmapå‡ºç°å¼‚å¸¸ï¼ˆåˆ†é…å†…å­˜é”™è¯¯å¯¼è‡´é”™è¯¯ï¼‰this-&gt;pbä¼šæŒ‡å‘ä¸€å—è¢«åˆ é™¤çš„å†…å­˜</p>
<h3 id="æ–¹æ³•äºŒï¼šå¼‚å¸¸å®‰å…¨æ€§"><a href="#æ–¹æ³•äºŒï¼šå¼‚å¸¸å®‰å…¨æ€§" class="headerlink" title="æ–¹æ³•äºŒï¼šå¼‚å¸¸å®‰å…¨æ€§"></a>æ–¹æ³•äºŒï¼šå¼‚å¸¸å®‰å…¨æ€§</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">    Bitmap* pOrig = pb;                 <span class="comment">//åˆ›å»º*thisä¸€ä¸ªå‰¯æœ¬</span></span><br><span class="line">    pb = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb);           <span class="comment">//pbæŒ‡å‘*pbçš„ä¸€ä¸ªå‰¯æœ¬</span></span><br><span class="line">    <span class="keyword">delete</span> pOrig                          <span class="comment">//åˆ é™¤å‰¯æœ¬</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯åŒæµ‹è¯•æ•ˆç‡é—®é¢˜</p>
</blockquote>
<p>åº”ç”¨è¯åŒæµ‹è¯•ä¼šå¯¼è‡´ä»£ç æ•ˆç‡å˜ä½ï¼Œifåˆ†æ”¯å¯¼è‡´æ‰§è¡Œé€Ÿåº¦ä¸‹é™</p>
<blockquote>
<p>å‰¯æœ¬ï¼š</p>
</blockquote>
<p>ä¸æ˜¯æŒ‡å‘ä¸€ä¸ªå¯¹è±¡åªæ˜¯ä¸€ä¸ª<strong>å€¼å®¹å™¨</strong>ï¼Œå¦‚å‡½æ•°ä¼ å‚</p>
<h3 id="æ–¹æ³•ä¸‰ï¼šcopy-swapï¼ˆå¼‚å¸¸å®‰å…¨æ€§ï¼‰â€”-æ¡æ¬¾29"><a href="#æ–¹æ³•ä¸‰ï¼šcopy-swapï¼ˆå¼‚å¸¸å®‰å…¨æ€§ï¼‰â€”-æ¡æ¬¾29" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šcopy-swapï¼ˆå¼‚å¸¸å®‰å…¨æ€§ï¼‰â€”-æ¡æ¬¾29"></a>æ–¹æ³•ä¸‰ï¼šcopy-swapï¼ˆå¼‚å¸¸å®‰å…¨æ€§ï¼‰â€”-æ¡æ¬¾29</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(Widget&amp; rhs)</span></span></span><br><span class="line"><span class="function">    </span>&#123;...&#125;  </span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs)<span class="comment">//ä¸€ä¸ªå‰¯æœ¬ä¿®æ”¹å®ƒä¸ä¼šä¿®æ”¹å…¶æœ¬èº«</span></span><br><span class="line">&#123;</span><br><span class="line">    Widget <span class="built_in">temp</span>(rhs);       <span class="comment">//rhsæ•°æ®å‰¯æœ¬</span></span><br><span class="line">    <span class="built_in">swap</span>(temp);            <span class="comment">//å°†*thisçš„å±äºå’Œå‰¯æœ¬çš„æ•°æ®äº’æ¢</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A variation on this theme takes advantage of the facts that</p>
<p> (1) a classâ€™scopy assignment operator may be declared to take its argument byvalue and</p>
<p> (2) passing something by value makes a copy of it (seeItem20)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=( Widget rhs)<span class="comment">//ä¸€ä¸ªå‰¯æœ¬ä¿®æ”¹å®ƒä¸ä¼šä¿®æ”¹å…¶å¯¹è±¡æœ¬èº«</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">swap</span>(rhs);            <span class="comment">//pass by value å°†*thisçš„å±äºå’Œå‰¯æœ¬çš„æ•°æ®äº’æ¢</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><blockquote>
<p>âœ¦Make sure operator= is well-behaved when an object is assigned to itself. Techniques include comparing addresses of source and target objects, careful statement ordering, and copy-and-swap.</p>
<p>âœ¦Make sure that any function operating on more than one object be-haves correctly if two or more of the objects are the same.</p>
</blockquote>
<hr>
<h1 id="èµ„æºç®¡ç†"><a href="#èµ„æºç®¡ç†" class="headerlink" title="èµ„æºç®¡ç†"></a>èµ„æºç®¡ç†</h1><h2 id="æ¡æ¬¾14ï¼šåœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º"><a href="#æ¡æ¬¾14ï¼šåœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º" class="headerlink" title="æ¡æ¬¾14ï¼šåœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º"></a>æ¡æ¬¾14ï¼šåœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º</h2><p><code>think carefully about copying behavior in resource-managing classes</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Lock</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">explicit</span> <span class="title">Lock</span><span class="params">(Mutex *pm)</span>: mutexPtr(pm)</span></span><br><span class="line"><span class="function">Â Â Â Â Â Â Â Â &#123;</span> <span class="built_in">lock</span>(mutexPtr); &#125;<span class="comment">// acquire resource</span></span><br><span class="line">Â Â Â Â ~<span class="built_in">Lock</span>( )</span><br><span class="line"> Â Â Â Â Â Â Â &#123; <span class="built_in">unlock</span>(mutexPtr); &#125;<span class="comment">// release resource</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Â Â Â Â Mutex *mutexPtr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>Clients use Lock in the conventional RAII fashion:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Mutex m;<span class="comment">// define the mutex you need to use</span></span><br><span class="line">...</span><br><span class="line">&#123; <span class="comment">// create block to define critical sectionLock </span></span><br><span class="line"><span class="built_in">ml</span>(&amp;m);    <span class="comment">// lock the mutex</span></span><br><span class="line">...    <span class="comment">// perform critical section operations</span></span><br><span class="line">&#125;    <span class="comment">// automatically unlock mutex at end</span></span><br><span class="line">    <span class="comment">// of block</span></span><br></pre></td></tr></table></figure>
<h3 id="RAIIå¯¹è±¡copiedçš„é€‰æ‹©"><a href="#RAIIå¯¹è±¡copiedçš„é€‰æ‹©" class="headerlink" title="RAIIå¯¹è±¡copiedçš„é€‰æ‹©"></a>RAIIå¯¹è±¡copiedçš„é€‰æ‹©</h3><ul>
<li><p>ç¦æ­¢å¤åˆ¶ï¼ˆprohibit copyingï¼‰</p>
</li>
<li><p>å¯¹åº•å±‚èµ„æºä½¿ç”¨â€œå¼•ç”¨è®¡æ•°æ³•â€</p>
</li>
</ul>
<h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦ å¤åˆ¶RAIIå¯¹è±¡å¿…é¡»ä¸€å¹¶å¤åˆ¶å®ƒæ‰€ç®¡ç†çš„èµ„æºï¼Œæ‰€ä»¥èµ„æºçš„copyingè¡Œä¸ºå†³å®šRAIIå¯¹è±¡çš„copyingè¡Œä¸º</p>
<p>âœ¦æ™®éè€Œå¸¸è§çš„RAII classes copying è¡Œä¸ºæ—¶ï¼šä¸€ç›´copyingã€å®è¡Œå¼•ç”¨è®¡æ•°æ³•ã€‚</p>
<h2 id="æ¡æ¬¾15ï¼šåœ¨èµ„æºç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®"><a href="#æ¡æ¬¾15ï¼šåœ¨èµ„æºç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®" class="headerlink" title="æ¡æ¬¾15ï¼šåœ¨èµ„æºç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®"></a>æ¡æ¬¾15ï¼šåœ¨èµ„æºç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</h2><p><code>provide access to raw resources in resource-managing classes</code></p>
<p><strong>åŸå› ï¼š</strong> ç¼–è¯‘å™¨æ— æ³•å°†RAIIç±»(shared_ptr)ä½œä¸ºæŒ‡é’ˆ,ä¼šå°†å…¶ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œæ— æ³•å‘ç”Ÿéšå¼è½¬æ¢è€ŒæŠ¥é”™</p>
<blockquote>
<p><strong>ç¤ºä¾‹</strong> ï¼š</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="function">tr1::shared_ptr&lt;Investment&gt; <span class="title">pInv</span><span class="params">(createInvestment())</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">daysHeld</span><span class="params">(<span class="type">const</span> Investment *pi)</span></span>;<span class="comment">// return number of days</span></span><br><span class="line">                                    <span class="comment">// investment has been held</span></span><br><span class="line"><span class="type">int</span> days = <span class="built_in">daysHeld</span>(pInv);<span class="comment">// error!</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong> </p>
</blockquote>
<p><code>convert an object of the RAII class (in this case,tr1::shared_ptr) into the raw resource</code></p>
<p>(1)<strong>explicit conversion:</strong></p>
<p>smart_ptr offer a get number function to perform explicit conversion to return a raw pointer inside this smart_ptr</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> days = <span class="built_in">daysHeld</span>(pInv.<span class="built_in">get</span>( ));<span class="comment">// fine, passes the raw pointer</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// in pInv to daysHeld</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_string</span><span class="params">(<span class="type">const</span> string* str)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//explicit</span></span><br><span class="line">    <span class="keyword">auto</span> ptr = std::<span class="built_in">make_shared</span>&lt;string&gt;(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="built_in">test_string</span>(ptr);<span class="comment">//error can`t convert RAII to string</span></span><br><span class="line">    <span class="built_in">test_string</span>(ptr.<span class="built_in">get</span>());<span class="comment">//offer raw resource</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2)<strong>implicit conversion:</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Str</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Str</span><span class="params">(<span class="type">const</span> string&amp; str)</span>:m_str(str)&#123;</span>&#125;</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">string</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> m_str;&#125;<span class="comment">//implicit convertion</span></span><br><span class="line">    <span class="function">string <span class="title">get</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> m_str;&#125;</span><br><span class="line">    ~<span class="built_in">Str</span>()&#123;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string m_str;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_string</span><span class="params">(<span class="type">const</span> string&amp; str)</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_implicit_</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Str <span class="title">a</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line">    <span class="built_in">test_string</span>(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦APIs often require access to raw resources, so each RAII classshould offer a way to get at the resource it manages.</p>
<p>âœ¦Access may be via explicit conversion or implicit conversion. In gen-eral, explicit conversion is safer, but implicit conversion is more con-venient for clients.</p>
<hr>
<h1 id="è®¾è®¡ä¸å£°æ˜"><a href="#è®¾è®¡ä¸å£°æ˜" class="headerlink" title="è®¾è®¡ä¸å£°æ˜"></a>è®¾è®¡ä¸å£°æ˜</h1><h2 id="æ¡æ¬¾20ï¼šå®ä»¥pass-by-reference-to-const-æ›¿æ¢pass-by-value"><a href="#æ¡æ¬¾20ï¼šå®ä»¥pass-by-reference-to-const-æ›¿æ¢pass-by-value" class="headerlink" title="æ¡æ¬¾20ï¼šå®ä»¥pass-by-reference-to-const æ›¿æ¢pass-by-value"></a>æ¡æ¬¾20ï¼šå®ä»¥pass-by-reference-to-const æ›¿æ¢pass-by-value</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Person</span>()=<span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> string&amp; a):<span class="built_in">p_name</span>(a)&#123;&#125;</span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> Person&amp; other)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> string <span class="title">printN</span><span class="params">()</span><span class="type">const</span></span>&#123;std::cout&lt;&lt;<span class="string">&quot;P&quot;</span>&lt;&lt;st::endl;<span class="keyword">return</span> p_name;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Person</span>()&#123;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string p_name;</span><br><span class="line">    string p_address;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> : <span class="keyword">public</span> Person&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Student</span>()=<span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Student</span>(<span class="type">const</span> string&amp; a):<span class="built_in">s_name</span>(a)&#123;std::cout&lt;&lt;<span class="string">&quot;S construct\n&quot;</span>;&#125;</span><br><span class="line">    <span class="comment">//Student(const Student&amp; other)&#123;std::cout&lt;&lt;&quot;S copy construct\n&quot;;&#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> string <span class="title">printN</span><span class="params">()</span><span class="type">const</span></span>&#123;std::cout&lt;&lt;<span class="string">&quot;S&quot;</span>&lt;&lt;std::endl;<span class="keyword">return</span> s_name;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Student</span>()&#123;std::cout &lt;&lt; <span class="string">&quot;S destruct\n&quot;</span>;&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string s_name;</span><br><span class="line">    string s_address;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test1</span><span class="params">(<span class="type">const</span> Person&amp; p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;p.<span class="built_in">printN</span>()&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç”¨pass-by-reference-to-constçš„å¥½å¤„"><a href="#ç”¨pass-by-reference-to-constçš„å¥½å¤„" class="headerlink" title="ç”¨pass-by-reference-to-constçš„å¥½å¤„"></a>ç”¨pass-by-reference-to-constçš„å¥½å¤„</h3><ol>
<li><p><strong>é«˜æ•ˆ</strong>ï¼Œä¸ä¼šåˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œå› æ­¤ä¸ä¼šå†æ¬¡è°ƒç”¨construtå’Œdeconstructã€‚</p>
</li>
<li><p><strong>å‡†ç¡®ä¸”æ­£ç¡®çš„å¤šæ€</strong>ï¼Œpass-by-valueæ— æ³•è¯†åˆ«å‡†ç¡®çš„objectï¼Œå¦‚test1ä¸­ï¼Œreal object éƒ½æ˜¯personæ— æ³•è°ƒç”¨studentçš„å¤šæ€ï¼Œpass-by-reference-to-constæ˜¯å¯ä»¥å‡†ç¡®è°ƒç”¨studentå¯¹è±¡</p>
</li>
</ol>
<h3 id="æ€»ç»“-5"><a href="#æ€»ç»“-5" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Prefer pass-by-reference-to-const over pass-by-value. Itâ€™s typicallymore efficient and it avoids the slicing problem.</p>
<p>âœ¦The rule doesnâ€™t apply to built-in types and STL iterator and func-tion object types. For them, pass-by-value is usually appropriat</p>
<hr>
<h2 id="æ¡æ¬¾21ï¼šå¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶reference"><a href="#æ¡æ¬¾21ï¼šå¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶reference" class="headerlink" title="æ¡æ¬¾21ï¼šå¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶reference"></a>æ¡æ¬¾21ï¼šå¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶reference</h2><p><code>Don&#39;t try return a reference when you must return an object</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span> ()= <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">double</span> x, <span class="type">double</span> y):<span class="built_in">x_</span>(x),<span class="built_in">y_</span>(y)</span><br><span class="line">    &#123;cout&lt;&lt;<span class="string">&quot;construt&quot;</span>&lt;&lt;endl; &#125;</span><br><span class="line">    .........</span><br><span class="line">    <span class="keyword">friend</span> <span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational &amp;lhs,</span><br><span class="line">                    <span class="type">const</span> Rational&amp; rhs)</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> x_, y_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ®µä»£ç æè¿°æœ‰ç†æ•°çš„ç›¸ä¹˜çš„ç±»çš„è®¾è®¡</p>
<h3 id="å½“ä»¥referenceä½œä¸ºè¿”å›å€¼æ—¶çš„å‡ å¤§è¯¯åŒº"><a href="#å½“ä»¥referenceä½œä¸ºè¿”å›å€¼æ—¶çš„å‡ å¤§è¯¯åŒº" class="headerlink" title="å½“ä»¥referenceä½œä¸ºè¿”å›å€¼æ—¶çš„å‡ å¤§è¯¯åŒº"></a>å½“ä»¥referenceä½œä¸ºè¿”å›å€¼æ—¶çš„å‡ å¤§è¯¯åŒº</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">==================on the stack===================</span><br><span class="line"><span class="type">const</span> Rational&amp; <span class="keyword">operator</span>*(<span class="type">const</span> Rational &amp;lhs,</span><br><span class="line">                    <span class="type">const</span> Rational&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">    Rational <span class="built_in">result</span>(lhs.x_*lhs.y_,rhs.x_*rhs.y_);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">=================on the heap======================</span><br><span class="line"><span class="type">const</span> Rational&amp; <span class="keyword">operator</span>*(<span class="type">const</span> Rational &amp;lhs,</span><br><span class="line">                    <span class="type">const</span> Rational&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">    Rational *result =  <span class="keyword">new</span> <span class="built_in">Rational</span>(lhs.x_*lhs.y_,rhs.x_*rhs.y_);</span><br><span class="line">    <span class="keyword">return</span> *result;</span><br><span class="line">&#125;</span><br><span class="line">=================<span class="type">static</span> local====================</span><br><span class="line"><span class="type">const</span> Rational&amp; <span class="keyword">operator</span>*(<span class="type">const</span> Rational &amp;lhs,</span><br><span class="line">                    <span class="type">const</span> Rational&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> Rational result</span><br><span class="line">    result = <span class="built_in">Result</span>(lhs.x_*lhs.y_,rhs.x_*rhs.y_);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p><strong>on the stack</strong> :referenceä½œä¸ºè¿”å›å€¼æ—¶ï¼Œresultå¯¹è±¡æ˜¯ä¸€ä¸ªstackå€¼ï¼Œå½“å…¶è¿”å›æ—¶ç¦»å¼€äº†ä½œç”¨åŸŸï¼Œresultå¯¹è±¡ä¼šè¢«é”€æ¯ï¼Œreferenceè¿”å›æ—¶ä¼šå¯¼è‡´å…¶æŒ‡å‘äº†ä¸€ä¸ªè¢«é”€æ¯çš„å€¼</p>
</li>
<li><p><strong>on the heap</strong> :heapåˆ†é…çš„å†…å­˜ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œæ— æ³•å¾—çŸ¥åˆé€‚å¯¹è¯¥å¯¹è±¡è¿›è¡Œdeleteï¼Œå› æ­¤ä¼šå¯¼è‡´å†…å­˜æ³„æ¼</p>
</li>
<li><p><strong>static local</strong> :ä¼šå¼•èµ·å¤šçº¿ç¨‹é—®é¢˜ï¼Œä¾‹å¦‚æ•°æ®å…±äº«é—®é¢˜</p>
</li>
</ol>
<h3 id="æ­£ç¡®åšæ³•ï¼š"><a href="#æ­£ç¡®åšæ³•ï¼š" class="headerlink" title="æ­£ç¡®åšæ³•ï¼š"></a>æ­£ç¡®åšæ³•ï¼š</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational &amp;lhs,</span><br><span class="line">                    <span class="type">const</span> Rational&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">result</span><span class="params">(lhs.x_*lhs.y_,rhs.x_*rhs.y_)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼šè™½ç„¶ä¼šä»˜å‡ºä¸€ç‚¹ç‚¹çš„æˆæœ¬ä»£ä»·ï¼ˆconstructå’Œdeconstructï¼‰ï¼Œä½†ä»é•¿è¿œçš„è§’åº¦å’Œç»¼åˆå¯¹æ¯”å¯çŸ¥ï¼Œæ­¤æ–¹æ³•æ˜¯æœ€åˆé€‚çš„åšæ³•</p>
<h3 id="æ€»ç»“ï¼š-5"><a href="#æ€»ç»“ï¼š-5" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Never return a pointer or reference to a local stack object, a refer-ence to a heap-allocated object, or a pointer or reference to a localstatic object if there is a chance that more than one such object willbe needed. (Item4 provides an example of a design where returninga reference to a local static is reasonable, at least in single-threadedenvironments.)</p>
<hr>
<h2 id="æ¡æ¬¾22ï¼šå°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate"><a href="#æ¡æ¬¾22ï¼šå°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate" class="headerlink" title="æ¡æ¬¾22ï¼šå°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate"></a>æ¡æ¬¾22ï¼šå°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate</h2><p><code>Declare data member private</code></p>
<h3 id="privateï¼ˆæä¾›å°è£…ï¼‰å’Œå…¶ä»–ï¼ˆæä¾›å°è£…ï¼‰"><a href="#privateï¼ˆæä¾›å°è£…ï¼‰å’Œå…¶ä»–ï¼ˆæä¾›å°è£…ï¼‰" class="headerlink" title="privateï¼ˆæä¾›å°è£…ï¼‰å’Œå…¶ä»–ï¼ˆæä¾›å°è£…ï¼‰"></a>privateï¼ˆæä¾›å°è£…ï¼‰å’Œå…¶ä»–ï¼ˆæä¾›å°è£…ï¼‰</h3><p>å¯¹äºprotectå£°æ˜çš„æˆå‘˜å˜é‡ï¼Œå½“å…¶å‡ºç°é—®é¢˜åæˆ–æ˜¯è¢«å–æ¶ˆåï¼Œå°†ä¼šå½±å“æ•´ä¸ªæ´¾ç”Ÿç±»</p>
<h3 id="æ€»ç»“ï¼š-6"><a href="#æ€»ç»“ï¼š-6" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Declare data members private. It gives clients syntactically uniformaccess to data, affords fine-grained access control, allows invariantsto be enforced, and offers class authors implementation flexibility.</p>
<p>âœ¦protected is no more encapsulated than publicï¼ˆprotect ä¸ public å·®ä¸å¤šï¼‰</p>
<h2 id="æ¡æ¬¾23ï¼šå®ä»¥non-memberã€non-friendæ›¿æ¢memberå‡½æ•°"><a href="#æ¡æ¬¾23ï¼šå®ä»¥non-memberã€non-friendæ›¿æ¢memberå‡½æ•°" class="headerlink" title="æ¡æ¬¾23ï¼šå®ä»¥non-memberã€non-friendæ›¿æ¢memberå‡½æ•°"></a>æ¡æ¬¾23ï¼šå®ä»¥non-memberã€non-friendæ›¿æ¢memberå‡½æ•°</h2><p><code>Perfer non-memberã€non-friend to member function</code> </p>
<h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><blockquote>
<p>ç¤ºä¾‹ :</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WebBrower</span></span><br><span class="line">&#123;</span><br><span class="line">    ...    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearCache</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearHistory</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">removeCookies</span><span class="params">()</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">==================member================</span><br><span class="line"><span class="keyword">class</span> WebBrower&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="type">void</span> <span class="built_in">clearEverything</span>();<span class="comment">//è°ƒç”¨clearCacheã€clearHistoryã€</span></span><br><span class="line">                           <span class="comment">//removeCookies</span></span><br><span class="line">&#125;</span><br><span class="line">=================non-member============</span><br><span class="line"><span class="type">void</span> <span class="built_in">clearBrowser</span>(WebBrowser&amp; wb)</span><br><span class="line">&#123;</span><br><span class="line">    wb.<span class="built_in">clearCache</span>();</span><br><span class="line">    wb.<span class="built_in">clearHistory</span>();</span><br><span class="line">    wb.<span class="built_in">removeCookies</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>æˆ‘ä»¬æ›´æ„¿æ„ä½¿ç”¨non-memberä»£æ›¿memberå‡½æ•°</code></p>
<blockquote>
<p>åŸå› </p>
</blockquote>
<p>1.non-memberçš„å°è£…æ€§æ¯”memberå‡½æ•°çš„æ›´å¼º</p>
<p>2.non-memberå¯¹ç±»çš„ç›¸å…³æœºèƒ½æœ‰è¾ƒå¤§çš„åŒ…è£¹å¼¹æ€§</p>
<blockquote>
<p><strong>å°è£…</strong>ï¼šå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿæ”¹å˜äº‹ç‰©è€Œåªå½±å“æœ‰é™å®¢æˆ·</p>
</blockquote>
<p>æ„ˆå¤šä¸œè¥¿è¢«å°è£…ï¼Œæ„ˆå°‘äººèƒ½çœ‹è§å®ƒï¼Œå› æ­¤èƒ½å¤Ÿæœ‰æ„ˆå¤§çš„å¼¹æ€§å»æ”¹å˜å®ƒ</p>
<p>æ„ˆå¤šå‡½æ•°å¯ä»¥è®¿é—®å°è£…çš„å‡½æ•°ï¼Œæ•°æ®çš„å°è£…æ€§è¶Šä½</p>
<p><strong>æ¡æ¬¾22</strong>ï¼šæˆå‘˜å˜é‡åº”è¯¥æ˜¯privateï¼Œä»¥ä¸ºå¦‚æœä»–ä»¬ä¸æ˜¯ï¼Œå°±æœ‰æ— æ•°çš„å‡½æ•°å¯ä»¥å»è®¿é—®ä»–ä»¬ï¼Œæ²¡æœ‰å°è£…å¯è¨€</p>
<blockquote>
<p>è®¿é—®é™åˆ¶</p>
</blockquote>
<p>èƒ½å¤Ÿè®¿é—®privateæˆå‘˜å˜é‡çš„å‡½æ•°åªæœ‰classå’Œmemberå‡½æ•°ä¸friendå‡½æ•°å¯ä»¥è®¿é—®</p>
<h3 id="ç¨‹åºè®¾è®¡é—®é¢˜"><a href="#ç¨‹åºè®¾è®¡é—®é¢˜" class="headerlink" title="ç¨‹åºè®¾è®¡é—®é¢˜"></a>ç¨‹åºè®¾è®¡é—®é¢˜</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> WebBrowserStuff&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WebBrowser</span>&#123;...&#125;;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clearBrowser</span><span class="params">(WebBrowser&amp; wb)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è®¾è®¡ç‰¹ç‚¹</p>
</blockquote>
<ul>
<li><p>namespace ä¸classesä¸åŒï¼Œ<strong>namespaceå¯ä»¥æ”¯æŒè·¨å¤šä¸ªæºç æ–‡ä»¶</strong>è€Œclassä¸èƒ½</p>
</li>
<li><p>non-memberã€non-friendå‡½æ•°ä¸ºç”¨æˆ·æä¾›è¾ƒå¥½çš„ç¨‹åºæœºèƒ½ä»¥åŠå°è£…æ€§</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤´æ–‡ä»¶webbrowsersã€‚</span></span><br><span class="line"><span class="keyword">namespace</span> WebBrowserStuff&#123;</span><br><span class="line">   <span class="comment">//æ ¸å¿ƒæœºèƒ½ï¼Œæä¾›æ‰€æœ‰çš„non-memberå‡½æ•° </span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//webbrowserbookmarksã€‚</span></span><br><span class="line"><span class="keyword">namespace</span> WebBrowserStuff</span><br><span class="line">&#123;</span><br><span class="line">    ... <span class="comment">//å£°æ˜ä¸ä¹¦ç­¾ç›¸å…³çš„non-memberã€non-friendä¾¿åˆ©å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//webbrowsercookies</span></span><br><span class="line"><span class="keyword">namespace</span> WebBrowerStuff</span><br><span class="line">&#123;</span><br><span class="line">    ...<span class="comment">//å£°æ˜ä¸cookiesç›¸å…³çš„non-memberã€non-friendä¾¿åˆ©å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æ¡ˆä¾‹è¿ç”¨äº†namespaceçš„è·¨è¶Šå¤šä¸ªæºç æ–‡ä»¶çš„ç‰¹ç‚¹</p>
<blockquote>
<p>æ ‡å‡†åº“ç»„ç»‡æ–¹å¼</p>
</blockquote>
<p>åœ¨STLå¤´æ–‡ä»¶ä¸­stdå‘½åç©ºé—´å†…çš„æ¯ä¸€ä¸ªä¸œè¥¿ï¼Œæ¯ä¸ªå¤´æ–‡ä»¶å£°æ˜stdçš„æŸäº›æœºèƒ½</p>
<p>ä¾‹å¦‚åªæƒ³ç”¨vectorï¼Œé‚£å°±åªç”¨vectorå¤´æ–‡ä»¶ï¼Œè¿™å…è®¸å®¢æˆ·æ”¯é˜Ÿä»–ä»¬æ‰€ç”¨çš„<strong>å°éƒ¨åˆ†ç³»ç»Ÿå½¢æˆç¼–è¯‘ä¾èµ–</strong>ï¼Œä½†è¯¥æ–¹æ³•ä¸èƒ½é€‚ç”¨äºmemberå‡½æ•°ï¼Œä»¥ä¸ºclasså¿…é¡»æ•´ä½“å®šä¹‰ï¼Œä¸å¯åˆ†å‰²</p>
<p>å°†æ‰€æœ‰ä¾¿åˆ©å‡½æ•°æ”¾åœ¨å¤šä¸ªå¤´æ–‡ä»¶å†…ä½†éš¶å±åŒä¸€å‘½åç©ºé—´ï¼Œæ„å‘³ç”¨æˆ·å¯ä»¥è½»æ¾çš„æ‰©å±•ã€‚éœ€è¦åªåšåˆ°åˆ™æ˜¯ï¼Œåœ¨è¯¥å‘½åç©ºé—´<strong>æ·»åŠ non-memberã€non-friendå‡½æ•°</strong>ã€‚</p>
<h3 id="æ€»ç»“ï¼š-7"><a href="#æ€»ç»“ï¼š-7" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><blockquote>
<p>âœ¦Prefer non-member non-friend functions to member functions. Do-ing so increases encapsulation, packaging flexibility, and functionalextensibility.</p>
</blockquote>
<hr>
<h2 id="æ¡æ¬¾24ï¼š-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢-è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°"><a href="#æ¡æ¬¾24ï¼š-è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢-è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°" class="headerlink" title="æ¡æ¬¾24ï¼š è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢,è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°"></a>æ¡æ¬¾24ï¼š è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢,è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°</h2><p><code>Declare non-member functions when type conversions should apply to all parameters</code></p>
<blockquote>
<p>ç¤ºä¾‹ï¼šRational</p>
</blockquote>
<p>è¿ç”¨æ¡æ¬¾3ï¼Œ20ï¼Œ21ä¹¦å†™æ­£ç¡®çš„operator*</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">float</span> numerator = <span class="number">0</span>,<span class="comment">// ctor is deliberately not explicit;</span></span><br><span class="line">    <span class="type">float</span> denominator = <span class="number">1</span>):<span class="built_in">n</span>(numerator),<span class="built_in">d</span>(denominator)&#123;&#125;;<span class="comment">// allows implicit int-to-Rational</span></span><br><span class="line">    <span class="comment">// conversions</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numerator</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// accessors for numerator and</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">denominator</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// denominator â€” see Item22private:</span></span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; out,<span class="type">const</span> Rational&amp; rhs)</span><br><span class="line">    &#123;</span><br><span class="line">        out&lt;&lt; rhs.n/rhs.d;</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; rhs)<span class="type">const</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Rational <span class="title">result</span><span class="params">((n*rhs.n),(d*rhs.d))</span></span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">float</span> n;</span><br><span class="line">    <span class="type">float</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Rational <span class="title">r1</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">Rational <span class="title">r2</span><span class="params">(<span class="number">3</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    Rational r3 = r1 * r2;<span class="comment">//right</span></span><br><span class="line"></span><br><span class="line">    r3  = r1 * <span class="number">2</span>;<span class="comment">//right</span></span><br><span class="line">    r3  = <span class="number">2</span> * r1;<span class="comment">//error</span></span><br><span class="line"></span><br><span class="line">    std::cout&lt;&lt;r3&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„äº‹é¡¹</p>
</blockquote>
<ul>
<li><p>åœ¨éšå¼è½¬æ¢æ—¶ï¼Œæ„é€ å‡½æ•°éœ€è¦å†™å‡ºé»˜è®¤å‚æ•°ï¼Œä¸ç„¶ä¸èƒ½è¿›è¡Œéšå¼è½¬æ¢ï¼Œå› ä¸ºRationalç±»æ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°;</p>
</li>
<li><p>åœ¨æ„é€ å‡½æ•°åŠ ä¸Šexplicitå°±å¯ä»¥é˜²æ­¢éšå¼è½¬æ¢</p>
</li>
<li><p>2 *  r1 ä¸èƒ½æˆåŠŸè¿è¡Œï¼Œæ˜¯ä¸æ˜¯ä¸æ»¡è¶³äº¤æ¢å¾‹ï¼Ÿ</p>
</li>
</ul>
<blockquote>
<p>é‡å†™ä¸Šè¿°ä¾‹å­</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">result = r1.<span class="keyword">operator</span>*(<span class="number">2</span>);</span><br><span class="line">result = <span class="number">2.</span>opeator*(r1);<span class="comment">//é”™è¯¯</span></span><br><span class="line"><span class="comment">//ç­‰åŒäº</span></span><br><span class="line">result = opeator*(<span class="number">2</span>,r1);</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºr1å†…å«ä¸€ä¸ªoperator<em>å‡½æ•°çš„classçš„å¯¹è±¡ï¼Œå¹¶ä¸”å°†2è¿›è¡Œéšå¼è½¬æ¢r1.operator </em> (Rational(2))</p>
<p>å¯¹äº2.operator(r1)æ˜¾ç„¶æ—¶é”™è¯¯çš„,æ²¡æœ‰è¿™ä¸ªé‡è½½å‡½æ•°</p>
<h3 id="å°†operatorå†™ä¸ºnon-memberå‡½æ•°"><a href="#å°†operatorå†™ä¸ºnon-memberå‡½æ•°" class="headerlink" title="å°†operatorå†™ä¸ºnon-memberå‡½æ•°"></a>å°†operatorå†™ä¸ºnon-memberå‡½æ•°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; lhs,<span class="type">const</span> Rational&amp; rhs)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>(lhs.<span class="built_in">numerator</span>()*rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                        rhs.<span class="built_in">denominator</span>()*rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<ul>
<li><p>non-memberå‡½æ•°å¦‚æ¡æ¬¾23æ‰€è¿°å°è£…æ€§æ›´å¼º</p>
</li>
<li><p>æ”¯æŒæ‰€æœ‰å‚æ•°çš„éšå¼ç±»å‹è½¬æ¢</p>
</li>
</ul>
<h3 id="æ€»ç»“-6"><a href="#æ€»ç»“-6" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><blockquote>
<p>âœ¦If you need type conversions on all parameters to a function (includ-ing the one that would otherwise be pointed to by the this pointer),the function must be a non-member.</p>
</blockquote>
<hr>
<h2 id="æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å‡ºå¼‚å¸¸çš„swapå‡½æ•°"><a href="#æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å‡ºå¼‚å¸¸çš„swapå‡½æ•°" class="headerlink" title="æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å‡ºå¼‚å¸¸çš„swapå‡½æ•°"></a>æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å‡ºå¼‚å¸¸çš„swapå‡½æ•°</h2><p><code>consider support a no-throwing swap</code></p>
<h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><h4 id="æ— æ³•äº¤æ¢å€¼ã€æ— æ³•äº¤æ¢æŒ‡é’ˆ"><a href="#æ— æ³•äº¤æ¢å€¼ã€æ— æ³•äº¤æ¢æŒ‡é’ˆ" class="headerlink" title="æ— æ³•äº¤æ¢å€¼ã€æ— æ³•äº¤æ¢æŒ‡é’ˆ"></a>æ— æ³•äº¤æ¢å€¼ã€æ— æ³•äº¤æ¢æŒ‡é’ˆ</h4><p>æ™®é€šswapå‡½æ•°å®ç°ç»†èŠ‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>* a,<span class="type">int</span>* b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* temp = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> *p1 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> *p2 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">swap</span>(p1,p2);</span><br><span class="line">========================</span><br><span class="line">åœ°å€ä¸å˜ï¼Œå€¼ä¸å˜</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é™·é˜±</p>
</blockquote>
<p>å¯¹äºc/c++çš„åˆå­¦è€…æ¥è¯´ï¼ŒçŠ¯ä¸‹ä¸€ä¸ªå¾ˆå¤§çš„é™·é˜±ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬åªä¼ è¿‡å»ä¸€ä¸ªåœ°å€å¯¹äºè€…ä¸ªåœ°å€å€¼åªæ˜¯ä¸€ä¸ª<strong>å‰¯æœ¬ä¿¡æ¯</strong>ï¼Œå¹¶ä¸æ˜¯åŸå¯¹è±¡ï¼Œå¯¼è‡´æ— æ³•äº¤æ¢åœ°å€å€¼æ›´æ— æ³•äº¤æ¢æŒ‡é’ˆå€¼ã€‚æˆ‘ä»¬åªæ˜¯é€šè¿‡ä¼ å‚è¿‡æ¥çš„ä¸€ä¸ª <strong>(åœ°å€)å€¼(å‰¯æœ¬)</strong>,è¿™æ˜¯æˆ‘ä»¬åªæ˜¯å¯¹åŸå¯¹è±¡çš„æŒ‡é’ˆå‰¯æœ¬åšäº†äº¤æ¢</p>
<h4 id="æ— æ³•äº¤æ¢åœ°å€ã€å¯ä»¥äº¤æ¢æŒ‡é’ˆ"><a href="#æ— æ³•äº¤æ¢åœ°å€ã€å¯ä»¥äº¤æ¢æŒ‡é’ˆ" class="headerlink" title="æ— æ³•äº¤æ¢åœ°å€ã€å¯ä»¥äº¤æ¢æŒ‡é’ˆ"></a>æ— æ³•äº¤æ¢åœ°å€ã€å¯ä»¥äº¤æ¢æŒ‡é’ˆ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>* a,<span class="type">int</span>* b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* temp = *a;</span><br><span class="line">    *a = *b;</span><br><span class="line">    *b = *temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> *p1 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> *p2 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">swap</span>(p1,p2);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§£æ</p>
</blockquote>
<p>è§£å¼•ç”¨åï¼Œæ­¤æ—¶<em>aã€</em>bæ˜¯aã€båœ°å€å¯¹åº”å†…å­˜çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åŸå¯¹è±¡å€¼ï¼Œæ”¹æ“ä½œè¿›è¡Œçš„æ˜¯<strong>å¯¹(åŸå¯¹è±¡)å†…å­˜çš„è¿›è¡Œç½®æ¢</strong>ï¼Œä½†æ­¤æ—¶å¹¶ä¸ä¼šæ”¹å˜åœ°å€å€¼ï¼Œåœ°å€å€¼ä»æ˜¯ä¸€ä¸ªå‰¯æœ¬</p>
<h4 id="å¯ä»¥äº¤æ¢å€¼å’Œåœ°å€"><a href="#å¯ä»¥äº¤æ¢å€¼å’Œåœ°å€" class="headerlink" title="å¯ä»¥äº¤æ¢å€¼å’Œåœ°å€"></a>å¯ä»¥äº¤æ¢å€¼å’Œåœ°å€</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>** a,<span class="type">int</span>** b)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* temp = *a;</span><br><span class="line">    *a = *b;</span><br><span class="line">    *b = temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> *p1 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> *p2 = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">2</span>);</span><br><span class="line"><span class="built_in">swap</span>(p1,p2);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§£æ</p>
</blockquote>
<p>p1å’Œp2æ˜¯ä¸€ä¸ªåœ°å€</p>
<p>æˆ‘ä»¬ç”¨åŒå±‚æŒ‡é’ˆï¼Œå†™å‡ºä¸€ä¸ªswapçš„ç½®æ¢å‡½æ•°ï¼Œæˆ‘ä»¬ä¼ å…¥åœ°å€è¿›å»ï¼Œæ­¤æ—¶aã€bçš„å€¼æ˜¯æŒ‡å‘p1å’Œp2çš„åœ°å€ã€‚å¯¹aã€bè¿›è¡Œè§£å¼•ç”¨ï¼Œåˆ™<strong>å¯¹åº”çš„<em>a ã€</em>bæ˜¯å¯¹åº”p1ã€p2çš„åœ°å€åŸå¯¹è±¡</strong>ã€‚</p>
<p>è¿›è¡Œç½®æ¢åˆ™<strong>äº¤æ¢çš„æ˜¯p1å’Œp2çš„å€¼</strong>ï¼Œé‚£ä¹ˆåœ°å€äº¤æ¢ï¼Œç›¸åº”æ”¹å˜çš„æ˜¯p1å’Œp2çš„å¯¹è±¡åæ‰€å¯¹åº”çš„åœ°å€è€Œå·²ï¼Œè€Œå®é™…çš„å†…å­˜å¹¶æ²¡æœ‰ç½®æ¢è€Œå·²ã€‚</p>
<h4 id="å¼•ç”¨æ–¹æ³•"><a href="#å¼•ç”¨æ–¹æ³•" class="headerlink" title="å¼•ç”¨æ–¹æ³•"></a>å¼•ç”¨æ–¹æ³•</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::swap;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">( T&amp; a, T&amp; b)</span><span class="comment">// swaps aâ€™s and bâ€™s values</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">temp</span><span class="params">(a)</span></span>;</span><br><span class="line">    a = b;</span><br><span class="line">    b = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•æ—¢å¯ä»¥æ”¹å€¼ä¹Ÿå¯ä»¥æ”¹åœ°å€ï¼Œå› ä¸ºå¼•ç”¨çš„æœ¬èº«å°±æ˜¯<strong>ç»‘å®šä¸€ä¸ªåŸå¯¹è±¡</strong>ï¼Œå¹¶ä¸æ˜¯å‰¯æœ¬</p>
<h3 id="æ ‡å‡†åº“swap"><a href="#æ ‡å‡†åº“swap" class="headerlink" title="æ ‡å‡†åº“swap"></a>æ ‡å‡†åº“swap</h3><blockquote>
<p> std::swap</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="comment">// typical implementation of </span></span><br><span class="line">std::swap;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">( T&amp; a, T&amp; b)</span><span class="comment">// swaps aâ€™s and bâ€™s values</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Â Â Â Â <span class="function">T <span class="title">temp</span><span class="params">(a)</span></span>;</span><br><span class="line">Â Â Â Â a = b;</span><br><span class="line">Â Â Â Â b = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åªè¦Tæ”¯æŒcopying(é€šè¿‡copyæ„é€ å‡½æ•°å’Œassignmentæ“ä½œç¬¦å®Œæˆ)ï¼Œé»˜è®¤çš„swapä¼šå®ç°ä»£ç å°±ä¼šå°†ç±»å‹ä¸ºTçš„å¯¹è±¡è¿›è¡Œç½®æ¢</p>
<h3 id="ç¤ºä¾‹ï¼šswap"><a href="#ç¤ºä¾‹ï¼šswap" class="headerlink" title="ç¤ºä¾‹ï¼šswap"></a>ç¤ºä¾‹ï¼šswap</h3><blockquote>
<p>å®è·µWidgetç±»</p>
</blockquote>
<ul>
<li>ç”¨pimplæ‰‹æ³•å°†Widgetçš„æ•°æ®æˆå‘˜å°è£…åˆ°WidgetImplä¸­</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WidgetImpl</span> &#123;<span class="comment">// class for Widget data;</span></span><br><span class="line"><span class="keyword">public</span>:<span class="comment">// details are unimportant...</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Â Â Â Â <span class="type">int</span> a, b, c;<span class="comment">// possibly lots of data â€”</span></span><br><span class="line">Â Â Â Â std::vector&lt;<span class="type">double</span>&gt; v;<span class="comment">// expensive to copy!...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;<span class="comment">// class using the pimpl idiom</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="built_in">Widget</span>(<span class="type">const</span> Widget&amp; rhs);</span><br><span class="line">Â Â Â Â Widget&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Widget&amp; rhs)<span class="comment">// to copy a Widget, copy its</span></span><br><span class="line">Â Â Â Â &#123;Â Â Â Â Â Â Â Â <span class="comment">// WidgetImpl object. For</span></span><br><span class="line">Â Â Â Â Â Â Â Â ...<span class="comment">// details on implementing</span></span><br><span class="line">Â Â Â Â Â Â Â Â *pImpl = *(rhs.pImpl);<span class="comment">// operator= in general,</span></span><br><span class="line">Â Â Â Â Â Â Â Â ...<span class="comment">// see Items 10, 11, and 12.</span></span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Â Â Â Â WidgetImpl *pImpl;<span class="comment">// ptr to object with this </span></span><br><span class="line">&#125;;<span class="comment">// Widgetâ€™s data</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è®¾è®¡é—®é¢˜</p>
</blockquote>
<ul>
<li><p>ç½®æ¢ä¸¤ä¸ªWidgetå¯¹è±¡è¿‡äºå¤æ‚ï¼Œæµªè´¹ç©ºé—´å’Œæ•ˆç‡(å¯¹äºç½®æ¢Widgetå¯¹è±¡å€¼ï¼Œæˆ‘ä»¬åªéœ€è¦åšçš„æ˜¯ç½®æ¢implæŒ‡é’ˆï¼Œä½†é»˜è®¤çš„swapè¦äº¤æ¢Widgetç±»æ›´éœ€è¦äº¤æ¢WidgetImpl)</p>
</li>
<li><p>å¯ä»¥ç›´æ¥äº¤æ¢æŒ‡é’ˆçš„åœ°å€ï¼Œæ”¹å˜æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜</p>
</li>
</ul>
<h4 id="ç½®æ¢å…¶implæŒ‡é’ˆ"><a href="#ç½®æ¢å…¶implæŒ‡é’ˆ" class="headerlink" title="ç½®æ¢å…¶implæŒ‡é’ˆ"></a>ç½®æ¢å…¶implæŒ‡é’ˆ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> std&#123;</span><br><span class="line">    <span class="keyword">template</span>&lt;&gt;</span><br><span class="line">    <span class="type">void</span> <span class="built_in">swap</span>&lt;Widget&gt;(Widget&amp; a,Widget&amp; b)<span class="comment">//std::swapçš„å…¨ç‰¹åŒ–ç‰ˆæœ¬åªèƒ½å¯¹</span></span><br><span class="line">           <span class="comment">//&lt;Widget&gt;è¡¨ç¤ºè¿™ä¸€ç‰¹ä¾‹åŒ–ç‰ˆæœ¬åªæ˜¯é’ˆå¯¹æŒ‡é’ˆäº¤æ¢è€Œè®¾è®¡</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">swap</span>(a.pImpl,b.pImpl);    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜</p>
</blockquote>
<p>pImplæ˜¯å±äºWidgetçš„privateæˆå‘˜å› æ­¤æ­¤å‡½æ•°è‚¯å®šæ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å£°æ˜ä¸ºfriendå‡½æ•°ä½†å…¶å°è£…æ€§è¾ƒå¼±ï¼Œå¯ä»¥å°†swapå£°æ˜ä¸ºmemberå‡½æ•°å¦‚ä¸‹ï¼š</p>
<h4 id="å£°æ˜publicæˆå‘˜å‡½æ•°ç½®æ¢"><a href="#å£°æ˜publicæˆå‘˜å‡½æ•°ç½®æ¢" class="headerlink" title="å£°æ˜publicæˆå‘˜å‡½æ•°ç½®æ¢"></a>å£°æ˜publicæˆå‘˜å‡½æ•°ç½®æ¢</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="comment">// same as above, except for the</span></span><br><span class="line"><span class="keyword">public</span>:<span class="comment">// addition of the swap mem func</span></span><br><span class="line">...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">( Widget&amp; other)</span></span>&#123;</span><br><span class="line">        <span class="keyword">using</span> std::swap;<span class="comment">// the need for this declaration</span></span><br><span class="line">                    <span class="comment">// is explained later in this Item</span></span><br><span class="line">        <span class="built_in">swap</span>(pImpl, other.pImpl);<span class="comment">// to swap Widgets, swap their</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// pImpl pointers</span></span><br><span class="line">        ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;<span class="comment">// revised specialization of</span></span><br><span class="line"><span class="type">void</span> <span class="built_in">swap</span>&lt;Widget&gt;(Widget&amp; a,<span class="comment">// std::swap</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Widget&amp; b)</span><br><span class="line">&#123;</span><br><span class="line">    a.<span class="built_in">swap</span>(b);<span class="comment">// to swap Widgets, call their</span></span><br><span class="line">&#125;<span class="comment">// swap member function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<p>èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œå¹¶ä¸”å…·æœ‰STLå®¹å™¨çš„ä¸€è‡´æ€§ï¼Œä»¥ä¸ºstd::swapä¹Ÿæä¾›äº†æœ‰pulic swapæˆå‘˜å‡½æ•°çš„å’Œstd::swapçš„ç‰¹åŒ–ç‰ˆæœ¬</p>
<blockquote>
<p>ç¼ºç‚¹</p>
</blockquote>
<p>å¯¹äºWidget class templatesè€Œéclasses å°†æ•°æ®ç±»å‹åŠ ä»¥å‚æ•°åŒ–</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WidgetImpl</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123; ... &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> swap&lt;Widget&lt;T&gt; &gt;(Widget&lt;T&gt;&amp; a,<span class="comment">// error! illegal code!</span></span><br><span class="line">Â Â Â Â Â Â Â Â Widget&lt;T&gt;&amp; b)</span><br><span class="line">&#123;</span><br><span class="line"> Â Â Â Â a.<span class="built_in">swap</span>(b); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é”™è¯¯åˆ†æ</p>
</blockquote>
<p>ä¼å›¾åç‰¹åŒ–ä¸€ä¸ªfunction template(std::swap)ï¼Œä½†C++åªèƒ½å¯¹class templatesåç‰¹åŒ–ï¼Œåœ¨function templatesèº«ä¸Šæ—¶ä¸èƒ½åç‰¹åŒ–çš„ã€‚å› æ­¤æ— æ³•ç¼–è¯‘ã€‚</p>
<h4 id="åç‰¹åŒ–function-template"><a href="#åç‰¹åŒ–function-template" class="headerlink" title="åç‰¹åŒ–function template"></a>åç‰¹åŒ–function template</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> std &#123;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="comment">// an overloading of std::swap </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(Widget&lt;T&gt;&amp; a,<span class="comment">// (note the lack of â€œ&lt;...&gt;â€ after</span></span></span></span><br><span class="line"><span class="params"><span class="function">                Widget&lt;T&gt;&amp; b)</span><span class="comment">// â€œswapâ€), but see below for</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    a.<span class="built_in">swap</span>(b); </span><br><span class="line">&#125;<span class="comment">// why this isnâ€™t valid code&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜</p>
</blockquote>
<p>é‡è½½function templatesæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†stdæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‘½åç©ºé—´ï¼š</p>
<ul>
<li><p>å¯ä»¥å…¨ç‰¹åŒ–stdå†…çš„templates</p>
</li>
<li><p>ä¸å¯ä»¥æ·»åŠ æ–°çš„templates(classæˆ–function)åˆ°stdé‡Œé¢</p>
</li>
</ul>
<h3 id="æ ‡å‡†åšæ³•"><a href="#æ ‡å‡†åšæ³•" class="headerlink" title="æ ‡å‡†åšæ³•"></a>æ ‡å‡†åšæ³•</h3><blockquote>
<p>é«˜æ•ˆæ­£ç¡®çš„åšæ³•ï¼šnon-memberçš„swapã€memberçš„swapå‡½æ•°ç›¸ç»“åˆ</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> WidgetStuff &#123;</span><br><span class="line">...<span class="comment">// templatized WidgetImpl, etc.</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="comment">// as before, including the swapclass </span></span><br><span class="line">Widget &#123; ... &#125;;<span class="comment">// member function</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="comment">// non-member swap function;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(Widget&lt;T&gt;&amp; a,<span class="comment">// not part of the std namespace</span></span></span></span><br><span class="line"><span class="params"><span class="function">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Widget&lt;T&gt;&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â a.<span class="built_in">swap</span>(b);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>swapå®ç°æ•ˆç‡ä¸è¶³çš„è§£å†³(classæˆ–templateè¿ç”¨äº†pimplæ‰‹æ³•)</p>
</blockquote>
<ol>
<li><p>æä¾›ä¸€ä¸ªpublicçš„swapå‡½æ•°ï¼Œè®©å®ƒé«˜æ•ˆåœ°ç½®æ¢ä½ çš„ç±»å‹çš„ä¸¤ä¸ªå¯¹è±¡å€¼ï¼Œè€Œå…¶ä¸èƒ½æŠ›å‡ºå¼‚å¸¸</p>
</li>
<li><p>åœ¨ä½ çš„classæˆ–templateæ‰€åœ¨çš„å‘½åç©ºé—´æä¾›ä¸€ä¸ªnon-member swapï¼Œå¹¶ä»¤ä»–è°ƒç”¨ä¸Šè¿°swapæˆå‘˜å‡½æ•°</p>
</li>
<li><p>å¦‚æœç¼–å†™ä¸€ä¸ª<strong>class(è€Œéclass template)</strong>ï¼Œä¸ºä½ çš„classç‰¹åŒ–ä¸€ä¸ªstd::swapï¼Œå¹¶ä»¤ä»–è°ƒç”¨ä½ çš„swapçš„æˆå‘˜å‡½æ•°</p>
</li>
<li><p>å¿…é¡»ä½¿ç”¨using std::swap,ä»¥ä¾¿å…¶èƒ½å¤Ÿåœ¨å‡½æ•°ç±»æ›å…‰å¯è§ï¼Œç„¶åæŠ¥ä»·namspaceä¿®é¥°ç¬¦</p>
</li>
</ol>
<h3 id="æ€»ç»“-7"><a href="#æ€»ç»“-7" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Provide a swap member function when std::swap would be inefficientfor your type. Make sure your swap doesnâ€™t throw exceptions.</p>
<p>âœ¦If you offer a member swap, also offer a non-member swap that callsthe member. For classes (not templates), specialize std::swap, too.</p>
<p>âœ¦When calling swap, employ a using declaration for std::swap, then callswap without namespace qualification.</p>
<p>âœ¦Itâ€™s fine to totally specialize std templates for user-defined types, butnever try to add something completely new to std.</p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="æ¡æ¬¾26ï¼šå°½é‡å°†å˜é‡çš„å£°æ˜ç½®å"><a href="#æ¡æ¬¾26ï¼šå°½é‡å°†å˜é‡çš„å£°æ˜ç½®å" class="headerlink" title="æ¡æ¬¾26ï¼šå°½é‡å°†å˜é‡çš„å£°æ˜ç½®å"></a>æ¡æ¬¾26ï¼šå°½é‡å°†å˜é‡çš„å£°æ˜ç½®å</h2><p><code>Postpone variable definitions as long as possible</code></p>
<h3 id="å˜é‡å£°æ˜å‰ç½®ç¤ºä¾‹"><a href="#å˜é‡å£°æ˜å‰ç½®ç¤ºä¾‹" class="headerlink" title="å˜é‡å£°æ˜å‰ç½®ç¤ºä¾‹"></a>å˜é‡å£°æ˜å‰ç½®ç¤ºä¾‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this function defines the variable &quot;encrypted&quot; too soon</span></span><br><span class="line"><span class="function">std::string <span class="title">encryptPassword</span><span class="params">(<span class="type">const</span> std::string&amp; password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    string encrypted;</span><br><span class="line">    <span class="keyword">if</span> (password.<span class="built_in">length</span>( ) &lt; MinimumPasswordLength) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">logic_error</span>(<span class="string">&quot;Password is too short&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...            <span class="comment">// do whatever is necessary to place an</span></span><br><span class="line">                   <span class="comment">// encrypted version of password in encrypted</span></span><br><span class="line">    <span class="keyword">return</span> encrypted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜</p>
</blockquote>
<p>ä½¿ç”¨ï¼šæ­£å¸¸æ‰§è¡Œçš„æ—¶å€™éœ€è¦ç”¨åˆ°encrypted</p>
<p>æœªä½¿ç”¨ï¼šå½“å¼‚å¸¸æŠ›å‡ºæ—¶ï¼Œencryptedå¯¹è±¡çš„æ„é€ æˆæœ¬å·²ç»é€ æˆï¼Œè€Œææ„è¦ç¦»å¼€ä½œç”¨åŸŸåæ‰ä¼šå¯ç”¨ã€‚</p>
<h3 id="å˜é‡ç½®å"><a href="#å˜é‡ç½®å" class="headerlink" title="å˜é‡ç½®å"></a>å˜é‡ç½®å</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this function postpones encryptedâ€™s definition until itâ€™s truly necessary</span></span><br><span class="line"><span class="function">std::string <span class="title">encryptPassword</span><span class="params">(<span class="type">const</span> std::string&amp; password)</span></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    <span class="keyword">if</span> (password.<span class="built_in">length</span>( ) &lt; MinimumPasswordLength) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">logic_error</span>(<span class="string">&quot;Password is too short&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    string encrypted;</span><br><span class="line">    ...          <span class="comment">// do whatever is necessary to place an</span></span><br><span class="line">                <span class="comment">// encrypted version of password in encrypted</span></span><br><span class="line">    <span class="keyword">return</span> encrypted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¾ªç¯ä¸­çš„å˜é‡å£°æ˜"><a href="#å¾ªç¯ä¸­çš„å˜é‡å£°æ˜" class="headerlink" title="å¾ªç¯ä¸­çš„å˜é‡å£°æ˜"></a>å¾ªç¯ä¸­çš„å˜é‡å£°æ˜</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Approach A: define outside loop</span></span><br><span class="line">Widget w;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) </span><br><span class="line">&#123;</span><br><span class="line">    w = some value dependent on i;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Approach B: define inside loop</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">Widget <span class="title">w</span><span class="params">(some value dependent on i)</span></span>;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸¤ç§æ–¹æ³•çš„æˆæœ¬å¯¹æ¯”</p>
</blockquote>
<p>â– Approach A: 1 constructor + 1 destructor + n assignments.</p>
<p>â– Approach B: n constructors + n destructors.</p>
<blockquote>
<p>æ•ˆç‡åˆ†æ</p>
</blockquote>
<p>â– Approach A:å¯è§æ€§å¼ºï¼Œå½“nè¾ƒå¤§æ—¶æ•ˆç‡æ›´å¥½</p>
<p>â– Approach B:nå°æ—¶æ•ˆç‡é«˜</p>
<p>(1) assignmentç›¸æ¯”constructor-destruction(å¯¹)æ›´åŠ ä¾¿å®œ</p>
<p>(2) å¦‚æœæ‚¨æ­£åœ¨å¤„ç†ä»£ç ä¸­å¯¹æ€§èƒ½æ•æ„Ÿçš„éƒ¨åˆ†ï¼Œåˆ™åº”é»˜è®¤ä½¿ç”¨æ–¹æ³•Bã€‚</p>
<h3 id="æ€»ç»“ï¼š-8"><a href="#æ€»ç»“ï¼š-8" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Postpone variable definitions as long as possible. It increases pro-gram clarity and improves program efficiency.</p>
<hr>
<h2 id="æ¡æ¬¾27ï¼šå°½é‡å°‘åšè½¬å‹æ“ä½œ"><a href="#æ¡æ¬¾27ï¼šå°½é‡å°‘åšè½¬å‹æ“ä½œ" class="headerlink" title="æ¡æ¬¾27ï¼šå°½é‡å°‘åšè½¬å‹æ“ä½œ"></a>æ¡æ¬¾27ï¼šå°½é‡å°‘åšè½¬å‹æ“ä½œ</h2><p><code>Minimize casting</code></p>
<h3 id="Cè¯­è¨€è½¬å‹è¯­æ³•"><a href="#Cè¯­è¨€è½¬å‹è¯­æ³•" class="headerlink" title="Cè¯­è¨€è½¬å‹è¯­æ³•"></a>Cè¯­è¨€è½¬å‹è¯­æ³•</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Cé£æ ¼çš„è½¬å‹</span></span><br><span class="line">(T) expression<span class="comment">// cast expression to be of type T</span></span><br><span class="line"><span class="comment">//å‡½æ•°é£æ ¼çš„è½¬å‹</span></span><br><span class="line"><span class="built_in">T</span>(expression)<span class="comment">// cast expression to be of type T</span></span><br></pre></td></tr></table></figure>
<h3 id="C-æ–°å¼è½¬å‹-new-style"><a href="#C-æ–°å¼è½¬å‹-new-style" class="headerlink" title="C++æ–°å¼è½¬å‹(new-style)"></a>C++æ–°å¼è½¬å‹(new-style)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">const_cast</span>&lt;T&gt;(expression)</span><br><span class="line"><span class="built_in">dynamic_cast</span>&lt;T&gt;(expression)</span><br><span class="line"><span class="built_in">reinterpret_cast</span>&lt;T&gt;(expression)</span><br><span class="line"><span class="built_in">static_cast</span>&lt;T&gt;(expression)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>const_casté€šå¸¸è¢«ç”¨æ¥å°†å¯¹è±¡çš„å¸¸é‡æ€§å»é™¤</p>
</li>
<li><p>dynamic_cast ä¸»è¦ç”¨æ¥æ‰§è¡Œâ€œå‘ä¸‹è½¬å‹â€(safe downcasting),ä¹Ÿå°±æ˜¯ç”¨æ¥å†³å®šæŸå¯¹è±¡æ˜¯å¦å½’å±ç»§æ‰¿ä½“ç³»ä¸­çš„æŸä¸ªç±»å‹ã€‚</p>
</li>
<li><p>reinterpret_castæ„å›¾æ‰§è¡Œä½çº§è½¬å‹ï¼Œå®é™…åŠ¨ä½œï¼ˆåŠç»“æœï¼‰å¯èƒ½å–å†³äºç¼–è¯‘å™¨ï¼Œä¸å¯ä»¥ç§»æ¤ã€‚ä¾‹å¦‚å°†pointer to int è½¬å‹ä¸ºä¸€ä¸ªintã€‚</p>
</li>
<li><p>static_castç”¨æ¥å¼ºåˆ¶éšå¼è½¬æ¢ï¼Œä¾‹å¦‚å°†non-constå¯¹è±¡è½¬ä¸ºconstå¯¹è±¡ï¼Œæˆ–å°†intè½¬ä¸ºdoubleç­‰ç­‰ã€‚å®ƒå¯ä»¥ç”¨æ¥æ‰§è¡Œä¸Šè¿°å¤šç§è½¬æ¢çš„åå‘è½¬æ¢ï¼Œä¾‹å¦‚å°†void*æŒ‡é’ˆè½¬ä¸ºtypedæŒ‡é’ˆï¼Œå°†pointer-to-baseè½¬ä¸ºpointer-to-deriveredã€‚ä½†å®ƒæ— æ³•å°†cosntè½¬ä¸ºnon-constâ€”â€”è¿™ä¸ªåªæœ‰const_castæ‰èƒ½åŠåˆ°ã€‚</p>
</li>
</ul>
<h3 id="æ–°å¼è½¬æ¢çš„ä¼˜ç‚¹"><a href="#æ–°å¼è½¬æ¢çš„ä¼˜ç‚¹" class="headerlink" title="æ–°å¼è½¬æ¢çš„ä¼˜ç‚¹"></a>æ–°å¼è½¬æ¢çš„ä¼˜ç‚¹</h3><ul>
<li><p>åœ¨ä»£ç ä¸­å®¹æ˜“è¢«è¯†åˆ«å‡ºæ¥(grepå·¥å…·å’Œäººå·¥è¯†åˆ«)ï¼Œæ‰¾å‡ºç±»å‹ç³»ç»Ÿåœ¨é‚£ä¸ªåœ°ç‚¹è¢«ç ´å</p>
</li>
<li><p>å„è½¬å‹åŠ¨ä½œçš„ç›®æ ‡è¶Šçª„åŒ–ï¼Œç¼–è¯‘å™¨è¶Šå¯èƒ½è¯Šæ–­é”™è¯¯åœ°ç‚¹ï¼Œä¾‹å¦‚å°†constnesså»é™¤ï¼Œé™¤éä½¿ç”¨æ–°å¼è½¬å‹ä¸­çš„const_castå¦ä¹‹æ— æ³•é€šè¿‡ç¼–è¯‘</p>
</li>
</ul>
<h3 id="æ—§å¼ç±»å‹è½¬æ¢çš„ä½¿ç”¨åœºæ™¯ï¼š"><a href="#æ—§å¼ç±»å‹è½¬æ¢çš„ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="æ—§å¼ç±»å‹è½¬æ¢çš„ä½¿ç”¨åœºæ™¯ï¼š"></a>æ—§å¼ç±»å‹è½¬æ¢çš„ä½¿ç”¨åœºæ™¯ï¼š</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">explicit</span> <span class="title">Widget</span><span class="params">(<span class="type">int</span> size)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doSomeWork</span><span class="params">(<span class="type">const</span> Widget&amp; w)</span></span>;</span><br><span class="line"><span class="built_in">doSomeWork</span>(<span class="built_in">Widget</span>(<span class="number">15</span>));<span class="comment">// create Widget from int</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// with function-style </span></span><br><span class="line"><span class="built_in">castdoSomeWork</span>(<span class="built_in">static_cast</span>&lt;Widget&gt;(<span class="number">15</span>));<span class="comment">// create Widget from int</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// with C++-style cast</span></span><br></pre></td></tr></table></figure>
<p>åœ¨function-styleçœ‹èµ·æ¥æ›´åƒç±»å‹è½¬æ¢ã€‚å¯è¿›è¡Œæ˜¾å¼æ„é€ å‡½æ•°ä¸­ç±»å‹è½¬æ¢ã€‚</p>
<h3 id="RTII-Run-Time-Type-Identification"><a href="#RTII-Run-Time-Type-Identification" class="headerlink" title="RTII(Run Time Type Identification)"></a>RTII(Run Time Type Identification)</h3><blockquote>
<p>å«ä¹‰</p>
</blockquote>
<p>ä»¤ç¼–è¯‘å™¨ç¼–è¯‘å‡ºè¿è¡ŒæœŸé—´æ‰§è¡Œçš„ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x,y;</span><br><span class="line">...</span><br><span class="line"><span class="type">double</span> d = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(x)/y;</span><br></pre></td></tr></table></figure>
<p>å°†int è½¬å‹ä¸ºdoubleä¼šäº§ç”Ÿä¸€äº›ä»£ç ï¼Œå› ä¸ºintä¸doubleçš„åº•å±‚æè¿°ä¸ç›¸åŒ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;...&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Drive</span>:<span class="keyword">public</span> Base&#123;...&#125;;</span><br><span class="line">Derived d;</span><br><span class="line">Base* pb = &amp;d;<span class="comment">// implicitly convert Derived*â‡’  Base*</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä¸¤ä¸ªæŒ‡é’ˆçš„å€¼å¹¶ä¸ç›¸åŒ(&amp;d,pb)ï¼Œè¿™ä¸ªæ—¶å€™ä¼šåˆä¸€ä¸ªåç§»é‡è¿è¡ŒæœŸæ–½åŠ åœ¨Derived*æŒ‡é’ˆä¸Šå–å¾—æ­£ç¡®çš„æŒ‡é’ˆå€¼ã€‚</p>
<h3 id="è½¬å‹å®¹æ˜“å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç "><a href="#è½¬å‹å®¹æ˜“å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç " class="headerlink" title="è½¬å‹å®¹æ˜“å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç "></a>è½¬å‹å®¹æ˜“å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Window</span> &#123;<span class="comment">// base class</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onResize</span><span class="params">( )</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        ... </span><br><span class="line">    &#125;<span class="comment">// base onResize impl</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialWindow</span>: <span class="keyword">public</span> Window &#123;</span><br><span class="line"><span class="comment">// derived class</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onResize</span><span class="params">( )</span> </span>&#123;</span><br><span class="line">    <span class="comment">// derived onResize impl;</span></span><br><span class="line">    <span class="built_in">static_cast</span>&lt;Window&gt;(*<span class="keyword">this</span>).<span class="built_in">onResize</span>();<span class="comment">// cast *this to Window,</span></span><br><span class="line">                                         <span class="comment">// then call its onResize;</span></span><br><span class="line">                                        <span class="comment">// this doesnâ€™t work!</span></span><br><span class="line">    ...<span class="comment">// do SpecialWindow-</span></span><br><span class="line">    &#125;<span class="comment">// specific stuff</span></span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜æ‰€åœ¨</p>
</blockquote>
<p>static_cast(<em>this).onResize()ï¼Œè°ƒç”¨çš„onResizeå¹¶ä¸æ˜¯å½“å‰å¯¹è±¡ä¸Šçš„å‡½æ•°ï¼Œè€Œæ˜¯ç¨æ—©è½¬å‹åŠ¨ä½œæ‰€å»ºç«‹çš„ä¸€ä¸ª â€œ</em>thiså¯¹è±¡çš„base classæˆåˆ†â€ çš„<strong>æš‚æ—¶å‰¯æœ¬</strong>èº«ä¸Šçš„onResizeã€‚</p>
<p>(å‡½æ•°å°±æ˜¯å‡½æ•°ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæˆå‘˜ä»…æ­¤ä¸€ä»½ï¼Œå…³é”®åœ¨äºæˆå‘˜å‡½æ•°éƒ½å«æœ‰ä¸ªéšè—çš„thisæŒ‡é’ˆï¼Œå› æ­¤ä¼šå½±å“æˆå‘˜æ“ä½œæ•°æ®)</p>
<p><strong>æ¢å¥è¯æ¥è¯´å°±æ˜¯ä¼šä¸¢å¤±åœ¨å½“å‰å¯¹è±¡base-classä¸­å¯¹æ•°æ®çš„æ“ä½œ</strong></p>
<p><code>it does not invoke that function on the current object! Instead, the cast creates a new, temporary copy of the base class part of *this, then invokes onResize on the copy!</code> </p>
<blockquote>
<p>å®é™…ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">      <span class="built_in">A</span>():<span class="built_in">size</span>(<span class="number">0</span>)&#123;&#125;;</span><br><span class="line">      <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">get_size</span><span class="params">()</span></span>&#123;</span><br><span class="line">         ++size; </span><br><span class="line">         <span class="keyword">return</span> size;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span> size;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>:<span class="keyword">public</span> A&#123;</span><br><span class="line">   <span class="keyword">public</span>:</span><br><span class="line">      <span class="built_in">B</span>():<span class="built_in">A</span>()&#123;&#125;;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">get_size</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;A&gt;(*<span class="keyword">this</span>).<span class="built_in">get_size</span>();  <span class="comment">//error</span></span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p> å¦‚ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬çš„æ“ä½œä»…ä»…åªæ˜¯åœ¨*thisæŒ‡é’ˆå¼ºè½¬å¾—åˆ°ä¸€ä¸ªå‰¯æœ¬ä¸Šè°ƒç”¨äº†å‡½æ•°ï¼Œå› æ­¤åœ¨å½“å‰å¯¹è±¡ä¸Šå¹¶æ²¡æœ‰è°ƒç”¨base-classçš„æˆå‘˜å‡½æ•°ï¼Œæ‰€æœ‰A::get_sizeä¸­çš„size++ä¸ä¼šåœ¨å½“å‰å¯¹è±¡ä¸Šä½œç”¨ï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœä¸º1.</p>
<blockquote>
<p>è§£å†³åŠæ³•ï¼šå»é™¤ç±»å‹è½¬æ¢</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialWindow</span>: <span class="keyword">public</span> Window &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onResize</span><span class="params">( )</span> </span>&#123;</span><br><span class="line">Â Â Â Â Window::<span class="built_in">onResize</span>( );<span class="comment">// call Window::onResize</span></span><br><span class="line">Â Â Â Â ...<span class="comment">// on *this</span></span><br><span class="line">&#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="dynamic-cast"><a href="#dynamic-cast" class="headerlink" title="dynamic__cast"></a>dynamic__cast</h3><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>åªæœ‰æŒ‡å‘base-classçš„ä¸€ä¸ªpointeræˆ–referenceæ—¶ï¼Œæƒ³è¦å»æ“ä½œè®¤å®šä¸ºderived-classå¯¹è±¡èº«ä¸Šæ‰§è¡Œderived-classæ“ä½œå‡½æ•°ï¼Œä¾é è¯¥dynamic__castè½¬å‹æ–¹æ³•å®ç°</p>
<h4 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h4><p>dynamic_castçš„æ‰§è¡Œé€Ÿåº¦<strong>ç›¸å½“çš„æ…¢</strong>ï¼Œè€Œä¸”<strong>å‘ä¸‹è½¬å‹</strong>æœ¬å°±æ˜¯ä¸€ä¸ª<strong>ä¸å®‰å…¨çš„è¡Œä¸º</strong>ï¼Œå› æ­¤æœ‰ä¸¤ä¸ªåŠæ³•ç”¨æ¥å–ä»£dynamic__cast</p>
<h4 id="åšæ³•ä¸€"><a href="#åšæ³•ä¸€" class="headerlink" title="åšæ³•ä¸€"></a>åšæ³•ä¸€</h4><p>ä½¿ç”¨å®¹å™¨å¹¶åœ¨è¯·æ±‡æ€»å­˜å‚¨ç›´æ¥æŒ‡å‘derived-classå¯¹è±¡çš„æŒ‡é’ˆ(é€šå¸¸ä¸ºåªèƒ½æŒ‡é’ˆ)ï¼Œæ¶ˆé™¤äº†â€é€šè¿‡base-classæ¥å£å¤„ç†å¯¹è±¡å‡½æ•°â€œçš„éœ€è¦ã€‚</p>
<blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<p>å‡è®¾å…ˆå‰çš„window/specialwindowç»§æ‰¿ä½“ç³»åªæœ‰specialwindowsæ‰æ”¯æŒé—ªçƒæ•ˆæœ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Window</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialWindow</span>: <span class="keyword">public</span> Window &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">blink</span><span class="params">( )</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span><span class="comment">// see Item13 for info</span></span><br><span class="line">std::vector&lt;std::tr1::shared_ptr&lt;Window&gt; &gt; VPW;  </span><br><span class="line"><span class="comment">// on tr1::shared_ptr</span></span><br><span class="line">VPW winPtrs;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">for</span> ( VPW::iterator iter = winPtrs.<span class="built_in">begin</span>();<span class="comment">// undesirable code:</span></span><br><span class="line">        iter != winPtrs.<span class="built_in">end</span>();<span class="comment">// uses dynamic_cast++iter) </span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (SpecialWindow *psw = <span class="built_in">dynamic_cast</span>&lt;SpecialWindow*&gt;</span><br><span class="line">                                (iter-&gt;<span class="built_in">get</span>()))</span><br><span class="line">        psw-&gt;<span class="built_in">blink</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¿®æ”¹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> std::vector&lt;std::tr1::shared_ptr&lt;SpecialWindow&gt; &gt; VPSW;</span><br><span class="line">VPSW winPtrs;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">for</span> (VPSW::iterator iter = winPtrs.<span class="built_in">begin</span>();<span class="comment">// better code: uses </span></span><br><span class="line">        iter != winPtrs.<span class="built_in">end</span>();<span class="comment">// no dynamic_cast++iter)</span></span><br><span class="line">    (*iter)-&gt;<span class="built_in">blink</span>();</span><br></pre></td></tr></table></figure>
<p>ç¼ºé™·åœ¨äºæ— æ³•åœ¨åŒä¸€å®¹å™¨å†…å­˜å‚¨æŒ‡å‘windowçš„ä»»ä½•æ´¾ç”Ÿç±»ã€‚å¤„ç†å¤šçª—å£éœ€è¦å¤šä¸ªå®¹å™¨ï¼Œä»–ä»¬éƒ½å…·å¤‡ç±»å‹å®‰å…¨æ€§</p>
<h4 id="åšæ³•äºŒ"><a href="#åšæ³•äºŒ" class="headerlink" title="åšæ³•äºŒ"></a>åšæ³•äºŒ</h4><p>é€šè¿‡base-classæ¥å£å¤„ç†æ‰€æœ‰windowçš„æ‰€æœ‰æ´¾ç”Ÿç±»ï¼Œå°±æ˜¯åœ¨base-classå†…æä¾›virtualå‡½æ•°åšä»»ä½•æƒ³å¤šwindowæ´¾ç”Ÿç±»åšçš„æ—¶</p>
<blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<p>è™½ç„¶specialwindowå¯ä»¥é—ªçƒï¼Œä½†æˆ–è®¸å°†é—ªçƒå‡½æ•°å£°æ˜åœ¨base-classä¸­å¹¶æä¾›ä¸€ä»½ç©ºçš„é»˜è®¤å‡½æ•°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Window</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">blink</span><span class="params">()</span> </span>&#123; &#125;<span class="comment">// default impl is no-op;</span></span><br><span class="line">    ...                    <span class="comment">// see Item34 for why</span></span><br><span class="line">&#125;;<span class="comment">// a default impl may be</span></span><br><span class="line"><span class="comment">// a bad idea</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpecialWindow</span>: <span class="keyword">public</span> Window &#123;</span><br><span class="line">    <span class="keyword">public</span>:<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">blink</span><span class="params">()</span> </span>&#123; ... &#125;<span class="comment">// in this class, blink</span></span><br><span class="line">Â Â Â Â ...</span><br><span class="line"><span class="comment">// does something</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> std::vector&lt;std::tr1::shared_ptr&lt;Window&gt; &gt; VPW;</span><br><span class="line">VPW winPtrs;<span class="comment">// container holds// (ptrs to) all possible</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// Window types</span></span><br><span class="line"><span class="keyword">for</span> ( VPW::iterator iter = winPtrs.<span class="built_in">begin</span>( );iter != winPtrs.<span class="built_in">end</span>( );</span><br><span class="line">                ++iter)<span class="comment">// note lack of </span></span><br><span class="line">        (*iter)-&gt;<span class="built_in">blink</span>( );<span class="comment">// dynamic_cast</span></span><br></pre></td></tr></table></figure>
<p>æ— è®ºæ˜¯é‚£ç§åšæ³•â€”â€”â€ç±»å®‰å…¨å®¹å™¨â€œè¿˜æ˜¯â€virtualå‡½æ•°å¾€ç»§æ‰¿ä½“ç³»ä¸Šæ–¹ç§»åŠ¨â€œï¼Œéƒ½åªæ˜¯ä¸€ä¸ªå¯è¡Œæ–¹æ¡ˆï¼Œéœ€è¦é è‡ªå·±åˆ¤æ–­</p>
<h3 id="æ€»ç»“ï¼š-9"><a href="#æ€»ç»“ï¼š-9" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Avoid casts whenever practical, especially dynamic_casts in perfor-mance-sensitive code. If a design requires casting, try to develop acast-free alternative. </p>
<p>âœ¦When casting is necessary, try to hide it inside a function. Clientscan then call the function instead of putting casts in their own code.</p>
<p>âœ¦Prefer C++-style casts to old-style casts. They are easier to see, andthey are more specific about what they do.</p>
<hr>
<h2 id="æ¡æ¬¾28ï¼šé¿å…è¿”å›handles-reference-pointer-iterators-æŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†"><a href="#æ¡æ¬¾28ï¼šé¿å…è¿”å›handles-reference-pointer-iterators-æŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†" class="headerlink" title="æ¡æ¬¾28ï¼šé¿å…è¿”å›handles(reference,pointer,iterators)æŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†"></a>æ¡æ¬¾28ï¼šé¿å…è¿”å›handles(reference,pointer,iterators)æŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</h2><p><code>Avoid returning â€œhandlesâ€ to object internals</code></p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾æ‚¨æ­£åœ¨å¤„ç†ä¸€ä¸ªæ¶‰åŠçŸ©å½¢çš„åº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªçŸ©å½¢å¯ä»¥ç”±å…¶å·¦ä¸Šè§’å’Œå³ä¸‹è§’è¡¨ç¤ºã€‚è¦ä½¿çŸ©å½¢å¯¹è±¡ä¿æŒè¾ƒå°ï¼Œå¯ä»¥å†³å®šå®šä¹‰å…¶èŒƒå›´çš„ç‚¹ä¸åº”å­˜å‚¨åœ¨çŸ©å½¢æœ¬èº«ä¸­ï¼Œè€Œåº”å­˜å‚¨åœ¨çŸ©å½¢æŒ‡å‘çš„è¾…åŠ©ç»“æ„ä¸­</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123; <span class="comment">// class for representing points</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> x, <span class="type">int</span> y);</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setX</span><span class="params">(<span class="type">int</span> newVal)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setY</span><span class="params">(<span class="type">int</span> newVal)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RectData</span> &#123;<span class="comment">// Point data for a Rectangl</span></span><br><span class="line">    ePoint ulhc;<span class="comment">// ulhc = â€œ upper left-hand cornerâ€</span></span><br><span class="line">    Point lrhc;<span class="comment">// lrhc = â€œ lower right-hand cornerâ€</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function">Point&amp; <span class="title">upperLeft</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> pData-&gt;ulhc; &#125;</span><br><span class="line">    <span class="function">Point&amp; <span class="title">lowerRight</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> pData-&gt;lrhc; &#125;</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::tr1::shared_ptr&lt;RectData&gt; pData;<span class="comment">// see Item13 for info on</span></span><br><span class="line">&#125;;<span class="comment">// tr1::shared_ptr</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºRectangleç±»æˆ‘ä»¬æ·»åŠ ä¸¤ä¸ªconst-reference member functionï¼Œä¸ºä½•ä½¿ç”¨const-referenceåœ¨<code>æ¡æ¬¾20</code>ä¸­æœ‰è¯´æ˜ã€‚ä½†å› æ­¤ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ã€‚</p>
<h3 id="ç ´åå°è£…æ€§"><a href="#ç ´åå°è£…æ€§" class="headerlink" title="ç ´åå°è£…æ€§"></a>ç ´åå°è£…æ€§</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point <span class="title">coord1</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="function">Point <span class="title">coord2</span><span class="params">(<span class="number">100</span>, <span class="number">100</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">const</span> Rectangle <span class="title">rec</span><span class="params">(coord1, coord2)</span></span>;<span class="comment">// rec is a const rectangle from</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// (0, 0) to (100, 100)</span></span><br><span class="line">rec.<span class="built_in">upperLeft</span>().<span class="built_in">setX</span>(<span class="number">50</span>);<span class="comment">// now rec goes from</span></span><br><span class="line">                        <span class="comment">// (50, 0) to (100, 100)!</span></span><br></pre></td></tr></table></figure>
<p>ç”±ä¸Šè¿°ä»£ç å¯ä»¥å¾—çŸ¥ï¼Œæˆ‘ä»¬ä¸ä»…ä»…èƒ½å¯¹çŸ©å½¢çš„ç‚¹è¿›è¡Œè¯»ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬<strong>å®šä¹‰çš„æ•°æ®æˆå‘˜ä¸publicå°±æ²¡æœ‰ä»€ä¹ˆä¸¤æ ·</strong>ã€‚(è™½ç„¶æˆ‘ä»¬åœ¨upperLeft()å‡½æ•°æ·»åŠ äº†constå®šä¹‰ï¼Œä½†æˆ‘ä»¬åªæ˜¯ä¸èƒ½å¯¹æŒ‡å‘Rectdataçš„æ™ºèƒ½æŒ‡é’ˆè¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥å¯¹è¯¥å¯¹è±¡å†…éƒ¨çš„å€¼è¿›è¡Œä¿®æ”¹)</p>
<blockquote>
<p>ä¿®æ”¹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â ...</span><br><span class="line"><span class="function"><span class="type">const</span> Point&amp; <span class="title">upperLeft</span><span class="params">( )</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span> pData-&gt;ulhc; &#125;</span><br><span class="line"><span class="function"><span class="type">const</span> Point&amp; <span class="title">lowerRight</span><span class="params">( )</span> <span class="type">const</span> </span>&#123;</span><br><span class="line"> Â Â Â Â <span class="keyword">return</span> pData-&gt;lrhc; &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡å°†è¿”å›å€¼åŠ ä¸Šconstæˆ‘ä»¬å¯ä»¥è®©constæˆå‘˜é™å®šç¬¦ä¸åœ¨æ˜¯ä¸ªfakeï¼Œæˆ‘ä»¬åªèƒ½å¯¹æ•°æ®è¿›è¡Œè¯»å†™ã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼ä»ç„¶ä¼šå¼•èµ·ä¸‹è¿°é—®é¢˜</p>
<h3 id="dangling-handles-æ‰€æŒ‡å¯¹è±¡ä¸å­˜åœ¨"><a href="#dangling-handles-æ‰€æŒ‡å¯¹è±¡ä¸å­˜åœ¨" class="headerlink" title="dangling handles æ‰€æŒ‡å¯¹è±¡ä¸å­˜åœ¨"></a>dangling handles æ‰€æŒ‡å¯¹è±¡ä¸å­˜åœ¨</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GUIObject</span> &#123; ... &#125;;</span><br><span class="line"><span class="type">const</span> Rectangle                <span class="comment">// returns a rectangle by</span></span><br><span class="line"><span class="built_in">boundingBox</span>(<span class="type">const</span> GUIObject&amp; obj);<span class="comment">// value; see Item3 for why</span></span><br><span class="line">                                <span class="comment">//  return type is const</span></span><br><span class="line">=====================================================</span><br><span class="line"><span class="comment">//Now consider how a client might use this function:</span></span><br><span class="line">GUIObject *pgo;<span class="comment">// make pgo point to</span></span><br><span class="line">...            <span class="comment">// some GUIObject</span></span><br><span class="line"><span class="type">const</span> Point *pUpperLeft =Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// get a ptr to the upper </span></span><br><span class="line">    &amp;(<span class="built_in">boundingBox</span>(*pgo).<span class="built_in">upperLeft</span>( ));<span class="comment">// left point of its</span></span><br><span class="line">                                       <span class="comment">// bounding box</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜åˆ†æ</p>
</blockquote>
<p>ä¸Šè¿°é—®é¢˜ä¸­ä¼šè°ƒç”¨boundingBox(*pgo)å‡½æ•°å¯¹è±¡ï¼Œå®ƒæ‰€è¿”å›çš„å€¼æ˜¯ä¸€ä¸ªä¸´æ—¶çš„Rectangleå‰¯æœ¬(temp)ï¼Œå½“æˆ‘ä»¬ç”¨upperLeftå»ä½œç”¨ä¸tempèº«ä¸Šï¼Œè¿”å›ä¸€ä¸ªreferenceæŒ‡å‘tempçš„ä¸€ä¸ªå†…éƒ¨æˆåˆ†</p>
<blockquote>
<p>é”™è¯¯</p>
</blockquote>
<p>å½“æˆ‘ä»¬ç»“æŸè¿™æ®µè¯­å¥æ˜¯ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬çš„boundBoxçš„è¿”å›å€¼(temp)ï¼Œå°†ä¼šè¢«ææ„ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªtempå¯¹è±¡çš„å†…éƒ¨æˆå‘˜éƒ½ä¸å¤å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„pUpperLeftå°±æŒ‡å‘äº†ä¸€ä¸ª<strong>ä¸å¤å­˜åœ¨çš„å€¼</strong>ã€‚</p>
<h3 id="ä¾‹å¤–ï¼šoperator"><a href="#ä¾‹å¤–ï¼šoperator" class="headerlink" title="ä¾‹å¤–ï¼šoperator[]"></a>ä¾‹å¤–ï¼šoperator[]</h3><p>åœ¨vectorå’Œstringå®¹å™¨ä¸­æœ‰ä¸ªæˆå‘˜å‡½æ•°operator[]å¯ä»¥é€‰æ‹©ä¸ªåˆ«çš„å…ƒç´ ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯è¿”å›referenceæŒ‡å‘â€œå®¹å™¨å†…çš„æ•°æ®â€ï¼Œä½†é‚£äº›æ•°æ®ä¼šéšç€å®¹å™¨çš„é”€æ¯è€Œé”€æ¯ã€‚è¿™ä»…ä»…åªæ˜¯æœ‰ä¸ªä¾‹å¤–ã€‚</p>
<h3 id="æ€»ç»“-8"><a href="#æ€»ç»“-8" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Avoid returning handles (references, pointers, or iterators) to object internals. Not returning handles increases encapsulation, helpsconst member functions act const, and minimizes the creation of dangling handles.</p>
<hr>
<h2 id="æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€œè€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„"><a href="#æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€œè€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„" class="headerlink" title="æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€œè€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„"></a>æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€œè€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„</h2><p><code>Strive for exception-safe code</code></p>
<blockquote>
<p>å¼‚å¸¸é—®é¢˜</p>
</blockquote>
<p>ä»¥classç”¨æ¥è¡¨ç°å¤¹å¸¦èƒŒæ™¯å›¾æ¡ˆçš„GUIèœå•ï¼Œè¿ç”¨äºå¤šçº¿ç¨‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrettyMenu</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">changebackground</span><span class="params">(std::istream&amp; imgSrc)</span></span>;</span><br><span class="line">    ...  </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Mutex mutex;</span><br><span class="line">    Image* bgImage;</span><br><span class="line">    <span class="type">int</span> imagechages;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">changebackground</span><span class="params">(std::istream&amp; imgSrc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">lock</span>(&amp;mutex);</span><br><span class="line">    <span class="keyword">delete</span> bgImage;</span><br><span class="line">    ++ imageChanges;</span><br><span class="line">    bgImage = <span class="keyword">new</span> <span class="built_in">Image</span>(imgSrc);</span><br><span class="line">    <span class="built_in">unlock</span>(&amp;mutex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="â€å¼‚å¸¸å®‰å…¨â€œçš„æ¡ä»¶"><a href="#â€å¼‚å¸¸å®‰å…¨â€œçš„æ¡ä»¶" class="headerlink" title="â€å¼‚å¸¸å®‰å…¨â€œçš„æ¡ä»¶"></a>â€å¼‚å¸¸å®‰å…¨â€œçš„æ¡ä»¶</h3></blockquote>
<ol>
<li><p><strong>ä¸æ³„æ¼ä»»ä½•èµ„æº</strong>ï¼šnew Image(imgSrc)å¯¼è‡´å¼‚å¸¸ï¼Œå¯¹unlockçš„è°ƒç”¨å°±ç»ä¸ä¼šæ‰§è¡Œã€‚</p>
</li>
<li><p><strong>ä¸å…è®¸æ•°æ®è´¥å</strong>ï¼šnew Iamge(imgSrc)æŠ›å‡ºå¼‚å¸¸ï¼ŒbgImageå°±æ˜¯æŒ‡å‘ä¸€ä¸ªè¢«åˆ é™¤çš„å¯¹è±¡ï¼ŒimageChangesä»¥åŠè¢«ç´¯åŠ ï¼Œè€Œå…¶å®å¹¶æ²¡æœ‰æ–°çš„å›¾åƒè¢«æˆåŠŸå®‰è£…èµ·æ¥</p>
</li>
</ol>
<blockquote>
<p>RAIIè§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">prettMenu::changeBackground</span><span class="params">(std::istream&amp; imgSrc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Lock <span class="title">ml</span><span class="params">(&amp;mutex)</span></span>;</span><br><span class="line">    <span class="keyword">delete</span> bgImage;</span><br><span class="line">    ++imageChages++;</span><br><span class="line">    bgImage = <span class="keyword">new</span> <span class="built_in">Image</span>(imgSrc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ä¸åœ¨éœ€è¦è°ƒç”¨unlock</code></p>
<blockquote>
<h3 id="â€å¼‚å¸¸å®‰å…¨å‡½æ•°â€œä¿è¯"><a href="#â€å¼‚å¸¸å®‰å…¨å‡½æ•°â€œä¿è¯" class="headerlink" title="â€å¼‚å¸¸å®‰å…¨å‡½æ•°â€œä¿è¯"></a>â€å¼‚å¸¸å®‰å…¨å‡½æ•°â€œä¿è¯</h3></blockquote>
<ul>
<li><p><strong>åŸºæœ¬æ‰¿è¯º</strong>ï¼šå¼‚å¸¸æŠ›å‡ºæ—¶ï¼Œä¸ä¼šä½¿å¯¹è±¡æˆ–æ•°æ®ç»“æ„ä¼šå› æ­¤è€Œç ´åï¼Œå°±æ•°æ®ä¿æŒå¼‚å¸¸æŠ›å‡ºé’±çš„çŠ¶æ€</p>
</li>
<li><p><strong>å¼ºçƒˆä¿è¯</strong>ï¼šå¼‚å¸¸æŠ›å‡ºä½¿ï¼Œç¨‹åºçŠ¶æ€ä¸ä¼šæ”¹å˜ã€‚(å‡½æ•°å¤±è´¥æ¢å¤åˆ°â€è°ƒç”¨å‡½æ•°ä¹‹å‰â€œçš„çŠ¶æ€)</p>
</li>
<li><p><strong>ä¸æŠ›æ·ä¿è¯</strong>ï¼šå®ƒä»¬æ€»èƒ½å®Œæˆæ€»èƒ½çš„åŸå…ˆæ‰¿è¯ºçš„åŠŸèƒ½</p>
</li>
</ul>
<h3 id="å¼‚å¸¸å®‰å…¨å‡½æ•°è§£å†³é—®é¢˜"><a href="#å¼‚å¸¸å®‰å…¨å‡½æ•°è§£å†³é—®é¢˜" class="headerlink" title="å¼‚å¸¸å®‰å…¨å‡½æ•°è§£å†³é—®é¢˜"></a>å¼‚å¸¸å®‰å…¨å‡½æ•°è§£å†³é—®é¢˜</h3><blockquote>
<h4 id="æ™ºèƒ½æŒ‡é’ˆè§£å†³é—®é¢˜ï¼š"><a href="#æ™ºèƒ½æŒ‡é’ˆè§£å†³é—®é¢˜ï¼š" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆè§£å†³é—®é¢˜ï¼š"></a>æ™ºèƒ½æŒ‡é’ˆè§£å†³é—®é¢˜ï¼š</h4></blockquote>
<p>1.å¼•ç”¨æ™ºèƒ½æŒ‡é’ˆç±»ç®¡ç†å†…å­˜</p>
<p>2.å°†è®¡æ•°å™¨çš„æ¬¡åºäº¤æ¢</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrettMenu</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    std::shared_ptr&lt;Image&gt; bgImage;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrettMenu::changBackground</span><span class="params">(std::istream&amp; imgSrc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Lock <span class="title">ml</span><span class="params">(&amp;mutex)</span></span>;</span><br><span class="line">    bgImage.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">Image</span>(imgSrc));<span class="comment">//ä»¥â€new Imageâ€œ;</span></span><br><span class="line">                                    <span class="comment">//è®¾å®šbgImageå†…éƒ¨æŒ‡é’ˆ</span></span><br><span class="line">    ++imageChagnes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<p>ä¸éœ€æ‰‹åŠ¨deleteæ—§å›¾åƒï¼Œè€Œä¸”åˆ é™¤æ“ä½œæ˜¯åœ¨å¯¹è±¡è¢«æˆåŠŸåˆ›å»ºçš„ä¹‹åï¼Œå› æ­¤newæˆåŠŸåæ‰ä¼šæˆåŠŸè°ƒç”¨resetå‡½æ•°ï¼ŒImageï¼ˆimgSrcï¼‰çš„ä¸´æ—¶å¯¹è±¡ä¹Ÿä¼šåœ¨resetä¸­é‡Šæ”¾æ‰ï¼ˆdeleteï¼‰</p>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<p>Imageæ„é€ å‡½æ•°ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆè¾“å‡ºæµçš„è¯»å–è®°å·å·²ç»è¢«ç§»èµ°ï¼‰</p>
<h3 id="Copy-and-Swap"><a href="#Copy-and-Swap" class="headerlink" title="Copy and Swap"></a>Copy and Swap</h3><blockquote>
<p><strong>åŸåˆ™ä»‹ç»</strong>ï¼š</p>
</blockquote>
<p>ä¸ºä½ æ‰“é€ ä¿®æ”¹çš„å¯¹è±¡ï¼ˆåŸä»¶ï¼‰åšå‡ºä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åå†é‚£å‰¯æœ¬èº«ä¸Šåšä¸€åˆ‡çš„ä¿®æ”¹ã€‚è‹¥ä¿®æ”¹å‘ç”Ÿé”™è¯¯ï¼Œæºå¯¹è±¡ä»èƒ½ä¿å­˜åŸå§‹çŠ¶æ€ã€‚ä¿®æ”¹æˆåŠŸï¼Œåˆ™åŸä»¶å’Œå‰¯æœ¬åšç½®æ¢æ“ä½œã€‚</p>
<p>ä¿®æ”¹å¯¹è±¡æ•°æ®å‰¯æœ¬ï¼Œä¸€ä¸ª<strong>ä¸ä¼šæŠ›å‡ºå¼‚å¸¸çš„å‡½æ•°</strong>ï¼ˆswapï¼‰ä¸­å°†ä¿®æ”¹åçš„æ•°æ®å’ŒåŸä»¶ç½®æ¢</p>
<blockquote>
<p>â€éš¶å±å¯¹è±¡æ•°æ®â€œ <strong>pimpi idiom</strong></p>
</blockquote>
<p>ä»åŸå¯¹è±¡æ”¾è¿›ä¸€ä¸ªå¦ä¸€ä¸ªå¯¹è±¡å†…ï¼Œç„¶åèµ‹äºˆåŸå¯¹è±¡ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘é‚£ä¸ªå®ç°å¯¹è±¡ï¼ˆå‰¯æœ¬ï¼‰ã€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PMImpl</span>&#123;<span class="comment">//pImplæ˜¯ä¸€ä¸ªprivateæˆå‘˜å…·æœ‰å°è£…æ€§</span></span><br><span class="line">    std::shared_ptr&lt;Image&gt; bgImage;</span><br><span class="line">    <span class="type">int</span> imageChage;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrettMenu</span>&#123;</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Mutex mutex;</span><br><span class="line">    std::shared_ptr&lt;PMImpl&gt; pImpl;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrettMenu::changeBackground</span><span class="params">(std::istream pImpl)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> std::swap;</span><br><span class="line">    <span class="function">Lock <span class="title">ml</span><span class="params">(&amp;mutex)</span></span>;</span><br><span class="line">    <span class="comment">//è®¾è®¡copyå‰¯æœ¬ï¼ˆå€¼å¯¹è±¡ï¼‰ï¼Œä¿å­˜åŸå§‹æ•°æ®</span></span><br><span class="line">    <span class="function">std::shared_ptr&lt;PMImpl&gt; <span class="title">ptemp</span><span class="params">(<span class="keyword">new</span> PMImpl(*pImpl))</span></span>;</span><br><span class="line">    <span class="comment">//ä¿®æ”¹å‰¯æœ¬</span></span><br><span class="line">    ptemp-&gt;bgImage.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">Image</span>(imgSrc);</span><br><span class="line"></span><br><span class="line">    ptemp-&gt;imageChanges++;</span><br><span class="line">    <span class="comment">//åŸå§‹å¯¹è±¡ä¸å‰¯æœ¬äº¤æ¢</span></span><br><span class="line">    <span class="built_in">swap</span>(pImpl,pNew);<span class="comment">//ç½®æ¢æ•°æ®ï¼Œé‡Šæ”¾mutexÂ·</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“ï¼š-10"><a href="#æ€»ç»“ï¼š-10" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><blockquote>
<p>âœ¦Exception-safe functions leak no resources and allow no data struc-tures to become corrupted, even when exceptions are thrown. Suchfunctions offer the basic, strong, or nothrow guarantees.</p>
<p>âœ¦The strong guarantee can often be implemented via copy-and-swap,but the strong guarantee is not practical for all functions.</p>
<p>âœ¦A function can usually offer a guarantee no stronger than the weak-est guarantee of the functions it calls. </p>
</blockquote>
<hr>
<h2 id="æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–"><a href="#æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–" class="headerlink" title="æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–"></a>æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–</h2><p><code>Understand the ins and outs of inlining</code></p>
<h3 id="inlineçš„ç»†èŠ‚"><a href="#inlineçš„ç»†èŠ‚" class="headerlink" title="inlineçš„ç»†èŠ‚"></a>inlineçš„ç»†èŠ‚</h3><ol>
<li>inlineå‡½æ•°ä»£ç é‡ä¸æ˜“è¿‡å¤§ä¼šå¯¼è‡´ç¨‹åºä½“ç§¯è¿‡å¤§ï¼Œå¯¼è‡´ä»£ç è†¨èƒ€ä»¥è‡³äºé¢å¤–çš„æ¢é¡µè¡Œä¸º</li>
<li>inlineåªæ˜¯å¯¹ç¼–è¯‘å™¨çš„ç”³è¯·å¹¶ä¸æ˜¯å¼ºåˆ¶å‘½ä»¤ï¼Œclasså†…çš„å‡½æ•°è¢«éšå–»çš„ç§°ä¸ºinline</li>
<li>inlineé€šå¸¸è¢«ç½®äºå¤´æ–‡ä»¶ï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è¿›è¡Œinliningï¼Œè€Œä¸ºå°†ä¸€ä¸ªâ€œå‡½æ•°è°ƒç”¨â€æ›¿æ¢ä¸ºâ€œè¢«è°ƒç”¨å‡½æ•°çš„æœ¬ä½“â€</li>
</ol>
<h3 id="inlineçš„å£°æ˜"><a href="#inlineçš„å£°æ˜" class="headerlink" title="inlineçš„å£°æ˜"></a>inlineçš„å£°æ˜</h3><blockquote>
<p>éšå¼å£°æ˜ä¸ºinlineçš„å‡½æ•°</p>
</blockquote>
<ul>
<li>memberå‡½æ•°</li>
<li>friendå‡½æ•°</li>
</ul>
<blockquote>
<p>ä¸åº”è¢«å£°æ˜ä¸ºinlineçš„å‡½æ•°</p>
</blockquote>
<ul>
<li>æ„é€ ä»¥åŠææ„å‡½æ•°</li>
</ul>
<h3 id="æ€»ç»“-9"><a href="#æ€»ç»“-9" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Limit most inlining to small, frequently called functions. This facili-tates debugging and binary upgradability, minimizes potential codebloat, and maximizes the chances of greater program speed.</p>
<p>âœ¦Donâ€™t declare function templates inline just because they appear inheader files.</p>
<hr>
<h2 id="æ¡æ¬¾31ï¼šå°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½"><a href="#æ¡æ¬¾31ï¼šå°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½" class="headerlink" title="æ¡æ¬¾31ï¼šå°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½"></a>æ¡æ¬¾31ï¼šå°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½</h2><p><code>Minimize compilation dependdencies between files</code></p>
<h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Person</span>( <span class="type">const</span> std::string&amp; name, <span class="type">const</span> Date&amp; birthday,</span><br><span class="line"><span class="type">const</span> Address&amp; addr);</span><br><span class="line"><span class="function">std::string <span class="title">name</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">birthDate</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="function">std::string <span class="title">address</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">std::string theName;<span class="comment">// implementation detail</span></span><br><span class="line">Date theBirthDate;<span class="comment">// implementation detail</span></span><br><span class="line">Address theAddress;<span class="comment">// implementation detail</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¦æƒ³è®©Person classç¼–è¯‘éœ€è¦åŠ å…¥ä»¥ä¸‹å¤´æ–‡ä»¶çš„ç±»æˆ–å‡½æ•°å£°æ˜å¼</p>
<h1 id="include-lt-string-gt"><a href="#include-lt-string-gt" class="headerlink" title="include &lt; string &gt;"></a>include &lt; string &gt;</h1><h1 id="include-â€œdate-hâ€"><a href="#include-â€œdate-hâ€" class="headerlink" title="include â€œdate.hâ€"></a>include â€œdate.hâ€</h1><h1 id="include-â€œaddress-hâ€"><a href="#include-â€œaddress-hâ€" class="headerlink" title="include â€œaddress.hâ€"></a>include â€œaddress.hâ€</h1><p>ä½†è¿™æ ·ä¼šå¯¼è‡´è¿™äº›æ–‡ä»¶ä¸­å½¢æˆä¸€ç§ç¼–è¯‘çš„<strong>ä¾å­˜å…³ç³»</strong>ï¼Œæ‰€ä¾èµ–çš„å¤´æ–‡ä»¶å‘ç”Ÿæ”¹å˜éƒ½ä¼šè®©Person classçš„å¤´æ–‡ä»¶è¿›è¡Œé‡æ–°æ–‡ä»¶</p>
<blockquote>
<p>å°†classçš„å®ç°ç»†ç›®è‡³äºclassçš„å®šä¹‰å¼ä¸­</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">string</span>;<span class="comment">// forward declaration (an incorrect</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// one â€” see below)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>;<span class="comment">// forward declaration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span>;<span class="comment">// forward declaration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> Date&amp; birthday,</span><br><span class="line">                                        <span class="type">const</span> Address&amp; addr);</span><br><span class="line">    <span class="function">std::string <span class="title">name</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">birthDate</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">address</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜</p>
</blockquote>
<ol>
<li><p>stringå‰ç½®å£°æ˜é”™è¯¯ï¼Œæ­£ç¡®çš„ä¹Ÿå¤æ‚</p>
</li>
<li><p>å‰ç½®å£°æ˜æ¯ä¸€ä¸ªä¸œè¥¿å›°éš¾çš„æ˜¯ï¼Œç¼–è¯‘å™¨å¿…é¡»çŸ¥é“å¯¹è±¡çš„å¤§å°</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    Person <span class="title function_">p</span><span class="params">(params)</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘å™¨æ¸…æ¥šçš„çŸ¥é“intéœ€è¦å¤šå¤§ï¼Œè€ŒPersonéœ€è¦è¯¢é—®classçš„å®šä¹‰å¼ã€‚</p>
<p>é’ˆå¯¹äºPersonç±»å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•ï¼šå°†Personåˆ†å‰²ä¸ºä¸¤ä¸ªclassesï¼Œä¸€ä¸ªåª<strong>æä¾›æ¥å£</strong>ï¼Œä¸€ä¸ªåªè´Ÿè´£<strong>å®ç°è¯¥æ¥å£</strong>ã€‚å°†è´Ÿè´£å®ç°çš„Implementation classå–åä¸ºPersonImplï¼ŒPersonå°†å®šä¹‰å¦‚ä¸‹</p>
<h3 id="pimpl-idiom-pointer-to-implementation"><a href="#pimpl-idiom-pointer-to-implementation" class="headerlink" title="pimpl idiom(pointer to implementation)"></a>pimpl idiom(pointer to implementation)</h3><p><em>pimpl æƒ¯ä¾‹</em>æ˜¯ä¸€ç§æ–°å¼ C++ æŠ€æœ¯ï¼Œç”¨äº<strong>éšè—å®ç°ã€æœ€å°åŒ–è€¦åˆå’Œåˆ†ç¦»æ¥å£</strong>ã€‚ Pimpl å¯¹äºâ€æŒ‡å‘å®ç°çš„æŒ‡é’ˆâ€æ˜¯çŸ­çš„ã€‚ä½ å¯èƒ½å·²ç†Ÿæ‚‰æ¦‚å¿µï¼Œä½†é€šè¿‡å…¶ä»–åç§°ï¼ˆå¦‚ Cheä¸€ cat æˆ–ç¼–è¯‘å™¨é˜²ç«å¢™æƒ¯ä¾‹ï¼‰äº†è§£å®ƒã€‚</p>
<p>ä¸‹é¢æ˜¯ pimpl æƒ¯ä¾‹å¦‚ä½•æ”¹è¿›è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ul>
<li><p>æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ç¼–è¯‘ä¾èµ–é¡¹ã€‚</p>
</li>
<li><p>æ¥å£å’Œå®ç°åˆ†ç¦»ã€‚</p>
</li>
<li><p>å¯ç§»æ¤æ€§ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<p>æœ‰è¾ƒå¥½çš„å°è£…æ€§ä»¥åŠå‡å°‘å®¢æˆ·ç«¯çš„æ–‡ä»¶ä¾èµ–æ€§</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨Pimpl</span></span><br><span class="line"><span class="comment">// åœ¨å¤´æ–‡ä»¶person.hppä¸­</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Person</span>();</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// Personç±»çš„å®ç°ç»†èŠ‚æ”¾ç½®åœ¨è¯¥å‰å‘å£°æ˜çš„å®ç°ç±»ä¸­ã€‚</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Impl</span>;</span><br><span class="line">  <span class="comment">// æŒ‡å‘å®ç°ç±»Implçš„ç§æœ‰æŒ‡é’ˆ</span></span><br><span class="line">  std::unique_ptr&lt;Impl&gt; pimpl_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æºæ–‡ä»¶person.cppä¸­</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;person.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;basic_info.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span>::Impl &#123;</span><br><span class="line">  std::string name;</span><br><span class="line">  std::string id;</span><br><span class="line">  BasicInfo basic_info;</span><br><span class="line">&#125;;</span><br><span class="line">Person::<span class="built_in">Person</span>() : <span class="built_in">pimpl_</span>(std::<span class="built_in">make_unique</span>&lt;Impl&gt;()) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>1.å‡å°‘äº†éœ€è¦åŒ…å«çš„å¤´æ–‡ä»¶ï¼›2.å½“å†…éƒ¨å®ç°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®¢æˆ·ç«¯çš„ä»£ç ä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼šå®¢æˆ·ç«¯åœ¨gccç¼–è¯‘ä¸­åªéœ€è¦è¿æ¥ä¸Šå…¶åŠ¨æ€è¿æ¥åº“æˆ–è€…é™æ€åº“æ–‡ä»¶ï¼Œè¿™æ—¶å€™æœåŠ¡ç«¯å·²ç»å°†æ‰€éœ€çš„æ–‡ä»¶çš„ç¼–è¯‘å®Œäº†ï¼Œå¯ä»¥å‡å°‘å®¢æˆ·ç«¯ç¼–è¯‘çš„æ—¶é—´</p>
<p>ç”±æ­¤ä¿®æ”¹ä»¥ä¸ŠPersonä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span><span class="comment">// standard library components</span></span></span><br><span class="line"><span class="comment">// shouldnâ€™t be forward-declared</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span> <span class="comment">// for tr1::shared_ptr; see belowclass PersonImpl;</span></span></span><br><span class="line"><span class="comment">// forward decl of Person impl. </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonImpl</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>;<span class="comment">// forward decls of classes used in</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span>;<span class="comment">// Person interface</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> Date&amp; birthday,</span><br><span class="line">                                    <span class="type">const</span> Address&amp; addr);</span><br><span class="line">Â Â Â Â <span class="function">std::string <span class="title">name</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">Â Â Â Â <span class="function">std::string <span class="title">birthDate</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">Â Â Â Â <span class="function">std::string <span class="title">address</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:<span class="comment">// ptr to implementation;</span></span><br><span class="line">    std::tr1::shared_ptr&lt;PersonImpl&gt; pImpl;<span class="comment">// see Item13 for info on</span></span><br><span class="line">&#125;;<span class="comment">// std::tr1::shared_ptr</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç main classä¸­å†…æ¶µä¸€ä¸ª</p>
<p>è¿™æ ·çš„è®¾è®¡ä¸‹ï¼ŒPersonçš„å®¢æˆ·å°±å®Œå…¨ä¸Dataesï¼ŒAddressä»¥åŠPersonsçš„å®ç°çš„ç»†ç›®åˆ†ç¦»ã€‚å› æ­¤å“ªäº›classesçš„ä»»ä½•å®ç°ä¿®æ”¹éƒ½ä¸éœ€è¦Personå®¢æˆ·æ–­é‡æ–°ç¼–è¯‘ã€‚â€œæ¥å£ä¸å®ç°åˆ†ç¦»â€</p>
<blockquote>
<p>å…³é”®</p>
</blockquote>
<p>è¿™ä¸ªåˆ†ç¦»åœ¨äºä»¥â€œå£°æ˜çš„ä¾å­˜æ€§â€æ›¿æ¢ä¸ºâ€œå®šä¹‰çš„ä¾å­˜æ€§â€ï¼Œç¼–è¯‘æœ€å°åŒ–çš„æœ¬è´¨ï¼šç°å®ä¸­è®©å¤´æ–‡ä»¶å°½å¯èƒ½çš„è‡ªæˆ‘æ»¡è¶³ï¼Œä¸‡ä¸€åšä¸åˆ°ï¼Œåˆ™è®©ä»–ä¸å…¶ä»–æ–‡ä»¶å†…çš„å£°æ˜å¼(å¹¶éå®šä¹‰å¼)ç›¸ä¾</p>
<h3 id="è®¾è®¡ç­–ç•¥"><a href="#è®¾è®¡ç­–ç•¥" class="headerlink" title="è®¾è®¡ç­–ç•¥"></a>è®¾è®¡ç­–ç•¥</h3><p>â– Avoid using objects when object references and pointers will do</p>
<p>â– Depend on class declarations instead of class definitions whenever you can.</p>
<p>å£°æ˜å‡½æ•°è€Œå®ƒç”¨åˆ°æŸä¸ªclasså¼ï¼Œä½ å¹¶ä¸éœ€è¦æ”¹classçš„å®šä¹‰ï¼šçºµä½¿å‡½æ•°ä»¥by valueæ–¹å¼ä¼ é€’æ”¹ç±»å‹çš„å‚æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>;<span class="comment">// class declaration</span></span><br><span class="line"><span class="function">Date <span class="title">today</span><span class="params">( )</span></span>;<span class="comment">// fine â€” no definition</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clearAppointments</span><span class="params">(Date d)</span></span>;<span class="comment">// of Date is needed</span></span><br></pre></td></tr></table></figure>
<p>å£°æ˜è¿™ä¸¤ä¸ªå‡½æ•°çš„æ— éœ€Dateçš„å®šä¹‰å¼ï¼Œä½†æ˜¯å½“æœ‰äººè°ƒç”¨å“ªäº›å‡½æ•°å¼ï¼Œè°ƒç”¨ä¹‹å‰éœ€è¦è®©Dateçš„å®šä¹‰å¼æ›å…‰</p>
<p>å¦‚æœå°†â€æä¾›classå®šä¹‰å¼â€œï¼ˆé€šè¿‡#includeå®Œæˆï¼‰çš„ä¹‰åŠ¡å†²â€<strong>å‡½æ•°å£°æ˜æ‰€åœ¨</strong>â€œä¹‹å¤´æ–‡ä»¶è½¬ç§»åˆ°â€<strong>å†…æ¶µå‡½æ•°è°ƒç”¨</strong>â€œä¹‹å®¢æˆ·æ–‡ä»¶ï¼Œä¾¿å¯å°†â€<strong>å¹¶éçœŸæ­£å¿…è¦çš„ç±»å‹å®šä¹‰</strong>â€œä¸å®¢æˆ·ç«¯ä¹‹é—´çš„<strong>ç¼–è¯‘ä¾å­˜</strong>å»é™¤æ‰</p>
<p>â– Provide separate header files for declarations and definitions</p>
<p>éœ€è¦ä¸¤ä¸ªå¤´æ–‡ä»¶ï¼Œä¸€ä¸ªç”¨äºå£°æ˜å¼ï¼Œä¸€ä¸ªç”¨äºå®šä¹‰å¼ã€‚æ–‡ä»¶å¿…é¡»ä¿æŒä¸€è‡´æ€§ï¼Œå¦‚æœå£°æ˜å¼è¢«æ”¹å˜ï¼Œä¸¤ä¸ªæ–‡ä»¶éƒ½éœ€è¦æ”¹å˜ã€‚<strong>#includeä¸€ä¸ªå£°æ˜æ–‡ä»¶</strong>è€Œéå‰ç½®å£°æ˜è‹¥å¹²å‡½æ•° </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;datefwd.h&quot;</span><span class="comment">// header file declaring (but not</span></span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// defining) </span></span><br><span class="line"><span class="function"><span class="keyword">class</span> DateDate <span class="title">today</span><span class="params">( )</span></span>;<span class="comment">// as before</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clearAppointments</span><span class="params">(Date d)</span></span>;</span><br></pre></td></tr></table></figure>
<p>C++ä¸­æä¾›å…³é”®å­—exportï¼Œå…è®¸å°†templateå£°æ˜å¼å’Œtemplateå®šä¹‰å¼åˆ†å‰²ä¸ä¸åŒçš„æ–‡ä»¶å†…ï¼Œä½†å¼è¿™ä¸ªå…³é”®å­—åœ¨æœ‰äº›ç¼–è¯‘å™¨é‡Œä¸æ”¯æŒ</p>
<h3 id="Handle-classses"><a href="#Handle-classses" class="headerlink" title="Handle classses"></a>Handle classses</h3><p>åƒPersonè¿™æ ·ä½¿ç”¨pimpl idiomçš„classesï¼Œè¢«ç§°ä¸ºHandle classesã€‚</p>
<blockquote>
<p>æ–¹æ³•ä¸€</p>
</blockquote>
<p>å°†ä»–ä»¬çš„æ‰€æœ‰å‡½æ•°è½¬äº¤ç»™ä¸€ä¸ªç›¸åº”çš„å®éªŒç±»å¹¶ç”±åè€…å®Œæˆå®é™…å·¥ä½œã€‚ä¾‹å¦‚å–å¼„Personçš„ä¸¤ä¸ªæˆå‘˜å‡½æ•°çš„å®ç°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Person.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PersonImpl.h&quot;</span><span class="comment">// we must also #include PersonImplâ€™s class</span></span></span><br><span class="line"><span class="comment">// definition, otherwise we couldnâ€™t call </span></span><br><span class="line"><span class="comment">// its member functions; note that </span></span><br><span class="line"><span class="comment">// PersonImpl has exactly the same public</span></span><br><span class="line"><span class="comment">// member functions as Person â€” their</span></span><br><span class="line"><span class="comment">// interfaces are identical</span></span><br><span class="line">Person::<span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> Date&amp; birthday,</span><br><span class="line">            <span class="type">const</span> Address&amp; addr): </span><br><span class="line">                        <span class="built_in">pImpl</span>(<span class="keyword">new</span> </span><br><span class="line">                            <span class="built_in">PersonImpl</span>(name, birthday, addr))&#123;&#125;</span><br><span class="line"><span class="function">std::string <span class="title">Person::name</span><span class="params">( )</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> pImpl-&gt;<span class="built_in">name</span>( );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Personæ„é€ å‡½æ•°ä»¥newè°ƒç”¨PersonImplæ„é€ å‡½æ•°ï¼Œä»¥åŠPerson::nameå‡½æ•°å†…è°ƒPersonImpl::nameï¼Œè®©Personç™¾å¹´åŸä¸€ä¸ªHandle classä½†ä¸ä¼šæ”¹å˜ä»–åšçš„äº‹ï¼Œåªä¼šæ”¹å˜å®ƒåšäº‹çš„æ–¹æ³•</p>
<h3 id="Interface-classes"><a href="#Interface-classes" class="headerlink" title="Interface classes"></a>Interface classes</h3><p>ä»¤Personç§°ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æŠ½è±¡åŸºç±»ï¼Œç§°ä¸ºinterface classã€‚è¿™æ±‡æ€»classçš„ç›®çš„äº‹çŒ«å”derivedçš„æ¥å£ï¼Œå› æ­¤ä»–é€šå¸¸ä¸å¸¦æœ‰æˆå‘˜å˜é‡ï¼Œä¹Ÿæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªvirtualææ„å‡½æ•°ä»¥åŠä¸€ç»„pure virtalå‡½æ•°ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Person</span>( );</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> std::string <span class="title">name</span><span class="params">( )</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> std::string <span class="title">birthDate</span><span class="params">( )</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> std::string <span class="title">address</span><span class="params">( )</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>classçš„ç”¨æˆ·å¿…é¡»ä»¥Personçš„pointerå’Œreferenceæ¥å†™åº”ç”¨ç¨‹åºï¼Œå› ä¸ºä»–ä¸å¯èƒ½é’ˆå¯¹â€å†…å«pure virtualå‡½æ•°â€œçš„person classeså…·ä½“å‡ºå®ä½“ã€‚</p>
<p>interface classçš„å®¢æˆ·å¿…é¡»æœ‰åŠæ³•ä¸ºè¿™ç§classåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p>
<p>å¦‚ä¸‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â Â Â <span class="type">static</span> std::tr1::shared_ptr&lt;Person&gt;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// return a tr1::shared_ptr to a new</span></span><br><span class="line">Â Â Â Â <span class="built_in">create</span>(<span class="type">const</span> std::string&amp; name,<span class="comment">// Person initialized with the</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="type">const</span> Date&amp; birthday,<span class="comment">// given params; see Item18 for</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="type">const</span> Address&amp; addr);<span class="comment">// why a tr1::shared_ptr is returned</span></span><br><span class="line">...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·å°†ä¼šè¿™æ ·ä½¿ç”¨è¿™äº›æ¥å£</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">std::string name;</span><br><span class="line">Date dateOfBirth;Address address;</span><br><span class="line">...<span class="comment">// create an object supporting the Person interface</span></span><br><span class="line">std::<span class="function">tr1::shared_ptr&lt;Person&gt; <span class="title">pp</span><span class="params">(Person::create(name, dateOfBirth,</span></span></span><br><span class="line"><span class="params"><span class="function">                 address))</span></span>;</span><br><span class="line">    ...</span><br><span class="line">    std::cout &lt;&lt; pp-&gt;<span class="built_in">name</span>( )</span><br><span class="line">                            <span class="comment">// use the object via the</span></span><br><span class="line">    &lt;&lt; <span class="string">&quot; was born on &quot;</span></span><br><span class="line">                            <span class="comment">// Person interface</span></span><br><span class="line">Â Â Â Â &lt;&lt; pp-&gt;<span class="built_in">birthDate</span>( )</span><br><span class="line">Â Â Â Â &lt;&lt; <span class="string">&quot; and now lives at &quot;</span></span><br><span class="line">Â Â Â Â &lt;&lt; pp-&gt;<span class="built_in">address</span>( );</span><br><span class="line">    ...                    <span class="comment">// the object is automatically </span></span><br><span class="line">                            <span class="comment">// deleted when pp goes out of </span></span><br><span class="line">                            <span class="comment">// scope </span></span><br></pre></td></tr></table></figure>
<p>æ”¯æŒinterface classæ¥å£çš„é‚£ä¸ªconcrete class å¿…é¡»è¢«å®šä¹‰å‡ºæ¥ï¼Œè€Œå…¶çœŸæ­£çš„æ„é€ å‡½æ•°å¿…é¡»è¢«è°ƒç”¨ã€‚ä¸€åˆ‡éƒ½åœ¨virtualæ„é€ å‡½æ•°å®ç°æ‰€åœ¨çš„æ–‡ä»¶å†…æ”¾ç”Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RealPerson</span>: <span class="keyword">public</span> Person </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">RealPerson</span>(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> Date&amp; birthday,</span><br><span class="line"><span class="type">const</span> Address&amp; addr):   <span class="built_in">theName</span>(name), </span><br><span class="line"><span class="built_in">theBirthDate</span>(birthday), </span><br><span class="line"><span class="built_in">theAddress</span>(addr)&#123;&#125;</span><br><span class="line"><span class="keyword">virtual</span> ~<span class="built_in">RealPerson</span>( ) &#123; &#125;</span><br><span class="line"><span class="function">std::string <span class="title">name</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// implementations of these </span></span><br><span class="line"><span class="function">std::string <span class="title">birthDate</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// functions are not shown, but </span></span><br><span class="line"><span class="function">std::string <span class="title">address</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// they are easy to imagineprivate:</span></span><br><span class="line">std::string theName;Date theBirthDate;Address theAddress;&#125;;</span><br><span class="line">======================================================</span><br><span class="line"><span class="comment">//Given RealPerson, it is truly trivial to write Person::create:</span></span><br><span class="line">std::tr1::shared_ptr&lt;Person&gt; Person::</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="built_in">create</span>(<span class="type">const</span> std::string&amp; name,</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="type">const</span> Date&amp; birthday,</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="type">const</span> Address&amp; addr)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> std::tr1::<span class="built_in">shared_ptr</span>&lt;Person&gt;(<span class="keyword">new</span> </span><br><span class="line">                        <span class="built_in">RealPerson</span>( name, birthday,addr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæ›´ç°å®çš„Person::createå®ç°ä»£ç ä¼šåˆ›å»ºä¸åŒç±»å‹çš„derived classå¯¹è±¡ã€‚å–å†³äºé¢å¤–å‚æ•°å€¼ã€è¯»è‡ªæ–‡ä»¶æˆ–æ•°æ®åº“çš„æ•°æ®ã€ç¯å¢ƒå˜é‡ã€‚</p>
<p>RealPersonç¤ºèŒƒå®ç°äº†Interface class çš„ä¸¤ä¸ªæœ€å¸¸è§çš„æœºåˆ¶ä¹‹ä¸€ï¼šä»Interface classç»§æ‰¿æ¥å£è§„æ ¼ï¼Œç„¶åå®ç°å‡ºæ¥å£æ‰€è¦†ç›–çš„å‡½æ•°ã€‚ç¬¬äºŒç‚¹åˆ™æ˜¯å¤šé‡ç»§æ‰¿</p>
<h3 id="æ€»ç»“ï¼š-11"><a href="#æ€»ç»“ï¼š-11" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦The general idea behind minimizing compilation dependencies is todepend on declarations instead of definitions. Two approachesbased on this idea are Handle classes and Interface classes.</p>
<p>âœ¦Library header files should exist in full and declaration-only forms.This applies regardless of whether templates are involved.</p>
<hr>
<h1 id="ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡"><a href="#ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡" class="headerlink" title="ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡"></a>ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡</h1><h2 id="æ¡æ¬¾32ï¼šç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºçš„is-aå…³ç³»"><a href="#æ¡æ¬¾32ï¼šç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºçš„is-aå…³ç³»" class="headerlink" title="æ¡æ¬¾32ï¼šç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºçš„is-aå…³ç³»"></a>æ¡æ¬¾32ï¼šç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºçš„is-aå…³ç³»</h2><p><code>Make sure public inheritance models &quot;is-a&quot;</code></p>
<p>é€šè¿‡publicç»§æ‰¿å‡ºçš„å…³ç³»ä¸ºâ€œis-aâ€å…³ç³»ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="keyword">public</span> Person &#123; ... &#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">(<span class="type">const</span> Person&amp; p)</span></span>;<span class="comment">// anyone can eat</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">study</span><span class="params">(<span class="type">const</span> Student&amp; s)</span></span>;<span class="comment">// only students study</span></span><br><span class="line">Person p;<span class="comment">// p is a PersonStudent s;// s is a Student</span></span><br><span class="line"><span class="built_in">eat</span>(p);<span class="comment">// fine, p is a Person</span></span><br><span class="line"><span class="built_in">eat</span>(s);<span class="comment">// fine, s is a Student,</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">// and a Student is-a Person</span></span><br><span class="line"><span class="built_in">study</span>(s);<span class="comment">// fine</span></span><br><span class="line"><span class="built_in">study</span>(p);<span class="comment">// error! p isnâ€™t a Student</span></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šè¿°å…³ç³»å¯ä»¥è¡¨è¿°å‡ºå­¦ç”Ÿæ˜¯äººï¼Œä½†äººè¿™ä¸ªæŠ½è±¡ç±»å´ä¸ä¸€å®šæ˜¯äºº</p>
<h3 id="is-açš„è¯¯åŒº"><a href="#is-açš„è¯¯åŒº" class="headerlink" title="is-açš„è¯¯åŒº"></a>is-açš„è¯¯åŒº</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">( )</span></span>;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">// birds can fly</span></span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span>: <span class="keyword">public</span> Bird &#123;</span><br><span class="line">Â Â Â Â <span class="comment">// penguins are birds</span></span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é”™è¯¯</p>
</blockquote>
<p>è¿™ä¸ªç»§æ‰¿ä½“ç³»ä¸­è¯´æ˜ä¼é¹…æ˜¯é¸Ÿçš„æ´¾ç”Ÿç±»ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å«æœ‰é¸Ÿç±»çš„æ‰€æœ‰è¡Œä¸ºï¼Œä½†æ˜¯ä¼é¹…å´ä¸ä¼šé£ï¼Œè¿™ç‚¹æ˜¾å¾—ä¸æ˜¯ç‰¹åˆ«çš„ä¸¥è°¨ã€‚æˆ‘ä»¬åº”è¯¥è®©is-aæœ‰è¾ƒä½³çš„çœŸå®æ€§</p>
<h3 id="æ–¹æ³•ä¸€-åŒclassç»§æ‰¿ä½“ç³»"><a href="#æ–¹æ³•ä¸€-åŒclassç»§æ‰¿ä½“ç³»" class="headerlink" title="æ–¹æ³•ä¸€:åŒclassç»§æ‰¿ä½“ç³»"></a>æ–¹æ³•ä¸€:åŒclassç»§æ‰¿ä½“ç³»</h3><blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â Â Â <span class="comment">// no fly function is declared</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FlyingBird</span>: <span class="keyword">public</span> Bird &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">( )</span></span>;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span>: <span class="keyword">public</span> Bird &#123;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â Â Â <span class="comment">// no fly function is declared </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šè¿è¡ŒæœŸé”™è¯¯"><a href="#æ–¹æ³•äºŒï¼šè¿è¡ŒæœŸé”™è¯¯" class="headerlink" title="æ–¹æ³•äºŒï¼šè¿è¡ŒæœŸé”™è¯¯"></a>æ–¹æ³•äºŒï¼šè¿è¡ŒæœŸé”™è¯¯</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">error</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;<span class="comment">// defined elsewhere</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Penguin</span>: <span class="keyword">public</span> Bird &#123;</span><br><span class="line"><span class="keyword">public</span>:<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fly</span><span class="params">( )</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">Â Â Â Â <span class="built_in">error</span>(<span class="string">&quot;Attempt to make a penguin fly!&quot;</span>); &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„å£°æ˜å‡ºä¼é¹…æ˜¯ä¸ä¼šé£çš„ï¼Œé‚£ä¹ˆè¯´ä¼é¹…ä¼šé£åˆ™æ˜¯ä¸€ç§é”™è¯¯çš„è®¤çŸ¥ï¼Œåœ¨è¿è¡ŒæœŸçš„æ—¶å€™ä¼šè¢«æ£€æµ‹å‡ºæ¥</p>
<h3 id="æ€»ç»“-10"><a href="#æ€»ç»“-10" class="headerlink" title="æ€»ç»“:"></a>æ€»ç»“:</h3><p>âœ¦Public inheritance means â€œis-a.â€ Everything that applies to baseclasses must also apply to derived classes, because every derivedclass object is a base class object.</p>
<hr>
<h2 id="æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°"><a href="#æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°" class="headerlink" title="æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°"></a>æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°</h2><p><code>Avoid hiding inherited names</code></p>
<h3 id="å‘½åæŸ¥æ‰¾è§„åˆ™-ä½œç”¨åŸŸ"><a href="#å‘½åæŸ¥æ‰¾è§„åˆ™-ä½œç”¨åŸŸ" class="headerlink" title="å‘½åæŸ¥æ‰¾è§„åˆ™(ä½œç”¨åŸŸ)"></a>å‘½åæŸ¥æ‰¾è§„åˆ™(ä½œç”¨åŸŸ)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> x;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf2</span><span class="params">( )</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">( )</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf4</span><span class="params">()</span></span>&#123;<span class="built_in">mf2</span>();&#125;;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\é»å’æ°\AppData\Roaming\marktext\images\2022-05-03-11-30-29-image.png" alt=""></p>
<p>Baseçš„ä½œç”¨åŸŸå¤§äºDerivedçš„ä½œç”¨åŸŸï¼Œæ ¹æ®å‘½åæŸ¥æ‰¾æ³•ï¼Œå½“æˆ‘ä»¬åœ¨Derivedç±»ä¸­æŸ¥æ‰¾mf2æ—¶ï¼Œé€‰æ‹©æ–¹å‘Derived-&gt;Base-&gt;globalã€‚å°ä¸€çº§çš„ä½œç”¨åŸŸä¼šå°†å…¶è¦†ç›–ã€‚</p>
<h3 id="åç§°å¯è§†æ€§-name-visibility"><a href="#åç§°å¯è§†æ€§-name-visibility" class="headerlink" title="åç§°å¯è§†æ€§(name visibility)"></a>åç§°å¯è§†æ€§(name visibility)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf2</span><span class="params">( )</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf3</span><span class="params">( )</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf3</span><span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">( )</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf4</span><span class="params">( )</span></span>;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\é»å’æ°\AppData\Roaming\marktext\images\2022-05-03-11-37-52-image.png" alt=""></p>
<p>Baseå†…åä¸ºmf1å’Œmf3çš„é‡è½½å‡½æ•°éƒ½è¢«Derivedå†…çš„mf1å’Œmf3å‡½æ•°æ‰€é®æ©ã€‚ä»åç§°æŸ¥æ‰¾è§‚ç‚¹æ¥çœ‹Base::mf1å’ŒBase::mf3ä¸åœ¨è¢«Derivedç»§æ‰¿ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Derived d;</span><br><span class="line"><span class="type">int</span> x;</span><br><span class="line">...</span><br><span class="line">d.<span class="built_in">mf1</span>( );<span class="comment">// fine, calls Derived::mf1d.mf1(x);</span></span><br><span class="line">        <span class="comment">// error! Derived::mf1 hides Base::mf1</span></span><br><span class="line">d.<span class="built_in">mf2</span>( );<span class="comment">// fine, calls Base::mf2</span></span><br><span class="line">d.<span class="built_in">mf3</span>( );<span class="comment">// fine, calls Derived::mf3</span></span><br><span class="line">d.<span class="built_in">mf3</span>(x);<span class="comment">// error! Derived::mf3 hides Base::mf3</span></span><br></pre></td></tr></table></figure>
<p>æ›´å…·ä»¥ä¸Šä»£ç å¯çŸ¥ï¼Œå½“æˆ‘ä»¬åœ¨é‡è½½å‡½æ•°æ—¶ï¼Œåœ¨å­ç±»ä¸­å°±åªèƒ½å¯¹Derivedä½œç”¨åŸŸçš„å‡½æ•°åå¯è§ï¼Œä½†æ˜¯å¯¹äºé‡è½½å‡½æ•°æ˜¯ä¸å¯è§çš„ã€‚ä¸è®ºæ˜¯virtualè¿˜æ˜¯non-virtualéƒ½æ˜¯ä¸€æ ·ã€‚</p>
<h3 id="è§£å†³ç»§æ‰¿æ¥çš„åç§°çš„é®æ©è¡Œä¸º"><a href="#è§£å†³ç»§æ‰¿æ¥çš„åç§°çš„é®æ©è¡Œä¸º" class="headerlink" title="è§£å†³ç»§æ‰¿æ¥çš„åç§°çš„é®æ©è¡Œä¸º"></a>è§£å†³ç»§æ‰¿æ¥çš„åç§°çš„é®æ©è¡Œä¸º</h3><blockquote>
<p>è¿åis-aå…³ç³»</p>
</blockquote>
<p>å½“publicç»§æ‰¿è€Œåˆä¸ç»§æ‰¿å“ªäº›é‡è½½å‡½æ•°å°±æ˜¯è¿åbaseå’Œderiver classä¹‹é—´çš„<strong>is-aå…³ç³»</strong> </p>
<blockquote>
<p>usingå£°æ˜è¡¨è¾¾å¼</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Â Â Â Â <span class="type">int</span> x;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span> </span>= <span class="number">0</span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf2</span><span class="params">( )</span></span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf3</span><span class="params">( )</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf3</span><span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">using</span> Base::mf1;<span class="comment">// make all things in Base named mf1 and mf3</span></span><br><span class="line"><span class="keyword">using</span> Base::mf3;<span class="comment">// visible (and public) in Derivedâ€™s scope</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span></span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="type">void</span> <span class="title">mf3</span><span class="params">( )</span></span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="type">void</span> <span class="title">mf4</span><span class="params">( )</span></span>;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\é»å’æ°\AppData\Roaming\marktext\images\2022-05-03-12-47-00-image.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Derived d;</span><br><span class="line"><span class="type">int</span> x;</span><br><span class="line">...</span><br><span class="line">d.<span class="built_in">mf1</span>( );<span class="comment">// still fine, still calls Derived::mf1d.mf1(x);</span></span><br><span class="line"><span class="comment">// now okay, calls Base::mf1</span></span><br><span class="line">d.<span class="built_in">mf2</span>( );</span><br><span class="line"><span class="comment">// still fine, still calls Base::mf2</span></span><br><span class="line">d.<span class="built_in">mf3</span>( );<span class="comment">// fine, calls Derived::mf3</span></span><br><span class="line">d.<span class="built_in">mf3</span>(x);<span class="comment">// now okay, calls Base::mf3 (The int x is </span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">// implicitly converted to a double so that</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="comment">// the call to Base::mf3 is valid.</span></span><br></pre></td></tr></table></figure>
<p>ç”¨usingå£°æ˜ï¼Œderivedç±»ç»§æ‰¿äº†baseå¹¶åŠ ä¸Šäº†é‡è½½å‡½æ•°ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥é‡å†™ä¸€éƒ¨åˆ†é‡è½½å‡½æ•°å°†baseçš„å‡½æ•°ç»™è¦†ç›–ã€‚</p>
<h3 id="forward-functionè½¬äº¤å‡½æ•°"><a href="#forward-functionè½¬äº¤å‡½æ•°" class="headerlink" title="forward functionè½¬äº¤å‡½æ•°"></a>forward functionè½¬äº¤å‡½æ•°</h3><blockquote>
<p>ä½¿ç”¨åœºæ™¯</p>
</blockquote>
<p>ä¸æƒ³ç»§æ‰¿baseçš„æ‰€æœ‰å‡½æ•°ï¼Œåœ¨â€œis-aâ€ä¸­ä¼šè¿èƒŒå…¶å«ä¹‰</p>
<blockquote>
<p>privateç»§æ‰¿</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span> </span>= <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">...<span class="comment">// as before</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">private</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span>    <span class="comment">// forwarding function; implicitly</span></span></span><br><span class="line"><span class="function"></span>&#123; Base::<span class="built_in">mf1</span>( ); &#125;    <span class="comment">// inline â€” see Item30. (For info...</span></span><br><span class="line">                    <span class="comment">// on calling a pure virtual</span></span><br><span class="line"><span class="comment">//-------ç»§æ‰¿private----------</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">(<span class="type">int</span>)</span></span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">mf1</span><span class="params">( )</span> </span></span><br><span class="line"><span class="function"><span class="comment">//---------------------------</span></span></span><br><span class="line"><span class="function">&#125;</span>;<span class="comment">// function, see Item34.)</span></span><br><span class="line">...</span><br><span class="line">Derived d;</span><br><span class="line"><span class="type">int</span> x;</span><br><span class="line">d.<span class="built_in">mf1</span>( );<span class="comment">// fine, calls Derived::mf1</span></span><br><span class="line">d.<span class="built_in">mf1</span>(x);<span class="comment">// error! Base::mf1( ) is hidden</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>inlineè½¬äº¤å‡½æ•°çš„ç”¨é€”</p>
</blockquote>
<p>å“ªäº›ä¸æ”¯æŒusingå£°æ˜å¼ï¼Œå°†ç»§æ‰¿è€Œå¾—çš„åç§°æ±‡å…¥derivedä½œç”¨åŸŸ</p>
<h3 id="æ€»ç»“-11"><a href="#æ€»ç»“-11" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Names in derived classes hide names in base classes. Under publicinheritance, this is never desirable. </p>
<p>âœ¦To make hidden names visible again, employ using declarations orforwarding functions.</p>
<hr>
<h2 id="æ¡æ¬¾34ï¼šåŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿"><a href="#æ¡æ¬¾34ï¼šåŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿" class="headerlink" title="æ¡æ¬¾34ï¼šåŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿"></a>æ¡æ¬¾34ï¼šåŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿</h2><p><code>Difference between inheritance of interface and inheritance of implementation</code></p>
<blockquote>
<p>publicç»§æ‰¿æ¦‚å¿µ</p>
</blockquote>
<p><strong>å‡½æ•°æ¥å£ç»§æ‰¿</strong>å’Œ<strong>å‡½æ•°å®ç°ç»§æ‰¿</strong></p>
<blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">( )</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">error</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">Â Â Â Â <span class="function"><span class="type">int</span> <span class="title">objectID</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>: <span class="keyword">public</span> Shape &#123;</span><br><span class="line">    ... </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ellipse</span>: <span class="keyword">public</span> Shape &#123; </span><br><span class="line">Â Â Â Â ... </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="æˆå‘˜å‡½æ•°çš„æ¥å£æ€»æ˜¯ä¼šè¢«ç»§æ‰¿"><a href="#æˆå‘˜å‡½æ•°çš„æ¥å£æ€»æ˜¯ä¼šè¢«ç»§æ‰¿" class="headerlink" title="æˆå‘˜å‡½æ•°çš„æ¥å£æ€»æ˜¯ä¼šè¢«ç»§æ‰¿"></a>æˆå‘˜å‡½æ•°çš„æ¥å£æ€»æ˜¯ä¼šè¢«ç»§æ‰¿</h3><p>publicä¸ºis-aå…³ç³»ç»§æ‰¿ï¼Œæ‰€æœ‰å¯¹Base classä¸ºçœŸçš„äº‹ä»¶å¯¹äºDerived classä¹Ÿä¸ºçœŸã€‚</p>
<blockquote>
<p>æ¥å£ä¸å®ç°</p>
</blockquote>
<ul>
<li>æ¥å£ï¼šæ˜¯(å¯¹å¤–æˆ–è€…å¯¹ç»§æ‰¿)å¯è§†çš„ï¼Œå®šä¹‰ä¸€ä¸ªçš„å¯¹è±¡å®ä½“å¯ä»¥é€šè¿‡(å¯¹å¤–å¯è§†çš„)æ¥å£å»è®¿é—®è¯¥å¯¹è±¡</li>
<li>å®ç°ï¼šæ˜¯ä¸€ä¸ªå®ä½“ï¼Œå¯ä»¥çœ‹ä½œæ˜¯æ¥å£æ‰€è¦åšåˆ°äº‹ï¼Œå¯¹å¤–ä¸ä¸€å®šå¯è§ï¼Œå¯¹å†…ä¸€å®šå¯è§</li>
</ul>
<blockquote>
<p>pure virtualå‡½æ•°</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">( )</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>pure virtualå‡½æ•°çš„ç‰¹æ€§ï¼š</p>
</blockquote>
<ul>
<li><p>å¿…é¡»è¢«ä»–ä»¬æ‰€ç»§æ‰¿çš„å…·è±¡ç±»æ‰€<strong>é‡æ–°å£°æ˜</strong></p>
</li>
<li><p>æŠ½è±¡ç±»ä¸­é€šå¸¸æ²¡æœ‰å¯¹è¯¥å‡½æ•°çš„å®šä¹‰</p>
</li>
</ul>
<h3 id="pure-virtualå‡½æ•°-å­ç±»å¿…é¡»é‡å†™"><a href="#pure-virtualå‡½æ•°-å­ç±»å¿…é¡»é‡å†™" class="headerlink" title="pure virtualå‡½æ•°(å­ç±»å¿…é¡»é‡å†™)"></a>pure virtualå‡½æ•°(å­ç±»å¿…é¡»é‡å†™)</h3><blockquote>
<p><strong>è®©derived classåªç»§æ‰¿æ¥å£</strong></p>
</blockquote>
<p>shape classæ— æ³•å¯¹shape::drawå‡½æ•°æä¾›åˆç†çš„é»˜è®¤å®ç°ï¼Œæ¯”è¾ƒå…¶æ¨¡æ£±ä¸¤å¯(æ¤­åœ†å’ŒçŸ©å½¢çš„ç”»æ³•)ï¼Œå› æ­¤åœ¨å…·è±¡derived class ä¸­<strong>å¿…é¡»æä¾›</strong>ä¸€ä¸ªdrawå‡½æ•°ï¼Œå¹¶ä¸”ä¸å¹²æ¶‰å¦‚ä½•å®ç°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Shape *ps = <span class="keyword">new</span> Shape;<span class="comment">// error! Shape is abstract</span></span><br><span class="line">Shape *ps1 = <span class="keyword">new</span> Rectangle;<span class="comment">// fine å¤šæ€</span></span><br><span class="line">ps1-&gt;<span class="built_in">draw</span>( );<span class="comment">// calls Rectangle::draw</span></span><br><span class="line">Shape *ps2 = <span class="keyword">new</span> Ellipse;<span class="comment">// fine</span></span><br><span class="line">ps2-&gt;<span class="built_in">draw</span>( );<span class="comment">// calls Ellipse::draw</span></span><br><span class="line">ps1-&gt;Shape::<span class="built_in">draw</span>();<span class="comment">// calls base class pure virtualå‡½æ•°ä¹Ÿå¯ä»¥æœ‰å®ç°</span></span><br><span class="line">Shape::drawps2-&gt;Shape::<span class="built_in">draw</span>();<span class="comment">// calls Shape::draw</span></span><br></pre></td></tr></table></figure>
<h3 id="impure-virtualå‡½æ•°-å¯é€‰æ˜¯å¦é‡å†™"><a href="#impure-virtualå‡½æ•°-å¯é€‰æ˜¯å¦é‡å†™" class="headerlink" title="impure virtualå‡½æ•°(å¯é€‰æ˜¯å¦é‡å†™)"></a>impure virtualå‡½æ•°(å¯é€‰æ˜¯å¦é‡å†™)</h3><blockquote>
<p><strong>è®©derived classç»§æ‰¿å‡½æ•°çš„æ¥å£å’Œé»˜è®¤å®ç°</strong></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">error</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Shaped::errorçš„å£°æ˜å¼è¦æ±‚derived classeså¿…é¡»<strong>æ”¯æŒä¸€ä¸ªerrorå‡½æ•°</strong>ï¼Œä½†å¦‚æœä¸æƒ³è‡ªå·±å†™ä¸€ä¸ªï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨<strong>Shaped classæä¾›çš„é»˜è®¤ç‰ˆæœ¬</strong></p>
<h3 id="non-virtualå‡½æ•°-ä¸èƒ½é‡å†™"><a href="#non-virtualå‡½æ•°-ä¸èƒ½é‡å†™" class="headerlink" title="non-virtualå‡½æ•°(ä¸èƒ½é‡å†™)"></a>non-virtualå‡½æ•°(ä¸èƒ½é‡å†™)</h3><blockquote>
<p><strong>è®©derived classç»§æ‰¿å‡½æ•°çš„æ¥å£åŠä¸€ä»½å¼ºåˆ¶æ€§å®ç°</strong></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="type">int</span> <span class="title">objectID</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>non-virtualå‡½æ•°ï¼šå¹¶ä¸æ‰“ç®—åœ¨derived classesä¸­æœ‰ä¸åŒçš„è¡Œä¸ºã€‚å®é™…ä¸Šnon-virtualå‡½æ•°è¡¨ç°çš„ä¸å˜æ€§(invariant)å¤§äºå…¶ç‰¹å¼‚æ€§(specialization)ã€‚</p>
<p>ä¾‹å¦‚ï¼šShape::objectIDæ˜¯æœ‰ç‰¹å®šè®¡ç®—IDçš„ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥æ–¹æ³•æ˜¯ç”±å…¶å®šä¹‰å¼å†³å®šçš„ï¼Œä»»ä½•derived classéƒ½<strong>ä¸åº”è¯¥ä¿®æ”¹å…¶è¡Œä¸º</strong>ï¼Œ<strong>ä¸åº”è¯¥åœ¨derived classä¸­è¢«é‡æ–°å®šä¹‰</strong>ã€‚(<strong>ç ´åå¤šæ€æ€§</strong>)</p>
<h3 id="æ€»ç»“-12"><a href="#æ€»ç»“-12" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Inheritance of interface is different from inheritance of implementa-tion.  Under  public  inheritance,  derived  classes  always  inherit  baseclass interfaces.</p>
<p>âœ¦Pure virtual functions specify inheritance of interface only. </p>
<p>âœ¦Simple  (impure)  virtual  functions  specify  inheritance  of  interfaceplus inheritance of a default implementation. </p>
<p>âœ¦Non-virtual  functions  specify  inheritance  of  interface  plus  inherit-ance of a mandatory implementation.</p>
<h2 id="æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„å…¶ä»–é€‰æ‹©"><a href="#æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„å…¶ä»–é€‰æ‹©" class="headerlink" title="æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„å…¶ä»–é€‰æ‹©"></a>æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„å…¶ä»–é€‰æ‹©</h2><p><code>Consider alternatives to virtual function</code></p>
<p>è®¾è®¡ä¸€ä¸ªè®¡ç®—äººç‰©ç”Ÿå‘½å€¼çš„å‡½æ•°healthValue()</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">healthValue</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// return characterâ€™s health rating;</span></span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â Â Â <span class="comment">// derived classes may redefine this</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸€impure virtualå‡½æ•°å»å£°æ˜å‡½æ•°ï¼Œé‚£ä¹ˆå½“å­ç±»ä¸æä¾›å‡½æ•°é‡å†™é‚£ä¹ˆäººç‰©å°†é‡‡ç”¨é»˜è®¤çš„å£°æ˜å€¼çš„è®¡ç®—æ–¹æ³•</p>
<h3 id="Template-Methodæ¨¡å¼"><a href="#Template-Methodæ¨¡å¼" class="headerlink" title="Template Methodæ¨¡å¼"></a>Template Methodæ¨¡å¼</h3><p>Non-virtual interfaceå®ç°æ–¹æ³•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">( )</span> <span class="type">const</span><span class="comment">// derived classes do not redefine</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">// this â€” see Item36</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// do â€œbeforeâ€ stuff â€” see below</span></span><br><span class="line">        <span class="type">int</span> retVal = <span class="built_in">doHealthValue</span>( );<span class="comment">// do the real work </span></span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// do â€œafterâ€ stuff â€” see below</span></span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">doHealthValue</span><span class="params">( )</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">Â Â Â Â <span class="comment">// derived classes may redefine this</span></span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// default algorithm for calculating&#125;</span></span><br><span class="line">    <span class="comment">// characterâ€™s health</span></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åŸºæœ¬è®¾è®¡</p>
</blockquote>
<p>ä»¤å®¢æˆ·é€šè¿‡public non-virtualæˆå‘˜å‡½æ•°å»é—´æ¥çš„è°ƒç”¨private virtualå‡½æ•°ï¼Œå› æ­¤ç§°ä¸ºnon-virtual(NVI)æ‰‹æ³•ã€‚</p>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<p>NVIæ‰‹æ³•çš„ä¼˜ç‚¹åœ¨äºâ€œdo â€˜beforeâ€™ stuffâ€å’Œâ€œdo â€˜afterâ€™ stuffâ€åœ¨ä¸Šè¿°çš„æ³¨é‡Šä»£ç ä¸­ï¼Œåœ¨Wrapperï¼ˆhealthValueï¼‰ä¸­è®¾å®šå¥½virtualå‡½æ•°çš„<strong>åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li><p>â€œdo â€˜beforeâ€™ stuffâ€ï¼šlocking a mutex, making a log entry(æ—¥å¿—è®°å½•é¡¹), verifying that class invariants and function preconditions aresatisfied, etc</p>
</li>
<li><p>â€œdo â€˜afterâ€™ stuffâ€ï¼šunlocking a mutex, veri-fying function postconditions, reverifying class invariants(å†æ¬¡éªŒè¯classçš„çº¦æŸæ¡ä»¶), etc.</p>
</li>
</ul>
<blockquote>
<p>ç–‘é—®</p>
</blockquote>
<p>NVIæ‰‹æ³•ä¸­æ¶‰åŠåˆ°derived classæ—¶base class private virtual å‡½æ•°æˆ‘ä»¬æ— æ³•è°ƒç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦redefiningè¿™äº›æˆ‘ä»¬ä¸ä¼šè°ƒç”¨çš„private virtual å‡½æ•°ï¼Œçœ‹èµ·æ¥ååˆ†çš„çŸ›ç›¾ã€‚ä½†æ—¶è°ƒç”¨virtualå‡½æ•°è¡¨ç¤ºå®ƒåœ¨â€ä½•æ—¶â€œè¢«å®Œæˆï¼Œä½†é‡å®šä¹‰virtualå‡½æ•°è¡¨ç¤ºâ€å¦‚ä½•â€œå®Œæˆï¼Œè¿™ä¸¤è€…å¹¶ä¸å†²çªã€‚</p>
<p>NVIå…è®¸derivedé‡æ–°å®šä¹‰virtualå‡½æ•°ï¼Œä»è€Œèµ‹äºˆäº†å®ƒå¦‚ä½•å…·ä½“å®ç°çš„æœºèƒ½ï¼Œä½†base classä»ç„¶ä¿ç•™å‡½æ•°åˆé€‚è¢«è°ƒç”¨çš„æƒåŠ›</p>
<blockquote>
<p>ç‰¹åˆ«çš„</p>
</blockquote>
<p>NVIæ‰‹æ³•ä¸­çš„virtualå‡½æ•°å¹¶ä¸æ˜¯éå¾—æ˜¯privateã€‚æŸäº›ç»§æ‰¿ä½“è¦æ±‚åœ¨derived classä¸­å¯¹åº”çš„å®ç°å¿…é¡»è°ƒç”¨å™¨base classçš„å¯¹åº”å…„å¼Ÿï¼Œä¸ºäº†åˆæ³•ï¼Œé‚£ä¹ˆå°±å¿…é¡»çš„è®¾ç½®ä¸ºprotectã€‚</p>
<h3 id="Strategy-Pattern-via-Function-Pointers"><a href="#Strategy-Pattern-via-Function-Pointers" class="headerlink" title="Strategy Pattern via Function Pointers"></a>Strategy Pattern via Function Pointers</h3><blockquote>
<p>è®¾è®¡ä¸»å¼ </p>
</blockquote>
<p>â€äººç‰©çš„å¥åº·æŒ‡æ•°çš„è®¡ç®—ä¸æ¯ä¸ªäººç‰©çš„ç±»å‹æ— å…³â€œï¼Œè¿™æ ·çš„è®¡ç®—ä¸éœ€è¦äººç‰©è¿™ä¸ªæˆåˆ†ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span>; </span><br><span class="line"><span class="comment">// forward declaration</span></span><br><span class="line"><span class="comment">// function for the default health calculation algorithm</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">defaultHealthCalc</span><span class="params">(<span class="type">const</span> GameCharacter&amp; gc)</span></span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*HealthCalcFunc)</span><span class="params">(<span class="type">const</span> GameCharacter&amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">GameCharacter</span><span class="params">(HealthCalcFunc hcf = defaultHealthCalc)</span>: </span></span><br><span class="line"><span class="function">                                    healthFunc(hcf )&#123;</span>&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">( )</span> <span class="type">const</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">healthFunc</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    HealthCalcFunc healthFunc;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¼˜ç‚¹</p>
</blockquote>
<p>ç›¸æ¯”virtualå‡½æ•°ç»§æ‰¿ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼æä¾›äº†æ›´å¥½çš„å¼¹æ€§</p>
<blockquote>
<p>å®ä¾‹</p>
</blockquote>
<ul>
<li>åœ¨<strong>åŒä¸€ç±»å‹çš„ä¸åŒçš„å®ä½“</strong>ä¸­åº”ç”¨ä¸åŒçš„è®¡ç®—å‡½æ•°</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EvilBadGuy</span>: <span class="keyword">public</span> GameCharacter &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">EvilBadGuy</span><span class="params">(HealthCalcFunc hcf = defaultHealthCalc)</span>: </span></span><br><span class="line"><span class="function">                                        GameCharacter(hcf )</span></span><br><span class="line"><span class="function">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">loseHealthQuickly</span><span class="params">(<span class="type">const</span> GameCharacter&amp;)</span></span>;<span class="comment">// health calculationint lose</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">HealthSlowly</span><span class="params">(<span class="type">const</span> GameCharacter&amp;)</span></span>;<span class="comment">// funcs with different</span></span><br><span class="line">                                    <span class="comment">// behavior</span></span><br><span class="line"><span class="function">EvilBadGuy <span class="title">ebg1</span><span class="params">(loseHealthQuickly)</span></span>;<span class="comment">// same-type charac-</span></span><br><span class="line"><span class="function">EvilBadGuy <span class="title">ebg2</span><span class="params">(loseHealthSlowly)</span></span>;<span class="comment">// ters with different// health-related</span></span><br><span class="line">                                    <span class="comment">// behavior</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å·²çŸ¥äººç‰©çš„å¥åº·æŒ‡æ•°è®¡ç®—å‡½æ•°å¯åœ¨è¿è¡ŒæœŸå˜æ›´ã€‚ä¾‹å¦‚ï¼šbaseç±»å¯ä»¥æä¾›ä¸€ä¸ªæˆå‘˜å‡½æ•°setHealthCalculatorï¼Œç”¨æ¥æ›¿æ¢å½“å‰çš„å¥åº·è®¡ç®—å‡½æ•°</li>
</ul>
<h3 id="Strategy-Pattern-via-tr1-function"><a href="#Strategy-Pattern-via-tr1-function" class="headerlink" title="Strategy Pattern via tr1::function"></a>Strategy Pattern via tr1::function</h3><blockquote>
<p>å‡½æ•°æŒ‡é’ˆçš„é™åˆ¶</p>
</blockquote>
<p>å¯¹templateä»¥åŠä»–ä»¬çš„çš„éšå¼æ¥å£çš„ä½¿ç”¨ï¼ŒåŸºäºå‡½æ•°çš„æŒ‡é’ˆçš„åšæ³•å°±ååˆ†çš„æ­»æ¿ã€‚ä¸å¤Ÿçµæ´»ï¼Œä¾‹å¦‚è¿”å›ç±»å‹åªèƒ½æ˜¯intï¼Œå‡½æ•°å¯¹è±¡ä¸èƒ½æ˜¯member function</p>
<blockquote>
<p>tr1::function</p>
</blockquote>
<p>æ”¹ç”¨tr1::functionçš„å¯¹è±¡æ›¿ä»£å‡½æ•°æŒ‡é’ˆï¼Œè¿™æ ·çš„å¯¹è±¡å¯æŒæœ‰ä»»ä½•å¯è°ƒç”¨ç‰©(callable entity å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡ã€æˆå‘˜å‡½æ•°æŒ‡é’ˆ)ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span>; <span class="comment">// as before</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">defaultHealthCalc</span><span class="params">(<span class="type">const</span> GameCharacter&amp; gc)</span></span>;<span class="comment">// as before</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// HealthCalcFunc is any callable entity that can be called with</span></span><br><span class="line"><span class="comment">// anything compatible with a GameCharacter and that returns anything</span></span><br><span class="line"><span class="comment">// compatible with an int; see below for details</span></span><br><span class="line"><span class="keyword">typedef</span> std::tr1::function&lt;<span class="type">int</span> (<span class="type">const</span> GameCharacter&amp;)&gt; HealthCalcFunc;</span><br><span class="line"><span class="function"><span class="keyword">explicit</span> <span class="title">GameCharacter</span><span class="params">(HealthCalcFunc hcf = defaultHealthCalc)</span>:</span></span><br><span class="line"><span class="function"> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â healthFunc(hcf )&#123;</span>&#125;</span><br><span class="line">Â Â Â Â <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">( )</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">healthFunc</span>(*<span class="keyword">this</span>); &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Â Â Â Â HealthCalcFunc healthFunc;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªå®ä¾‹ä¸­æˆ‘ä»¬ç”¨tr1::function instantiationæ¥ä»£æ›¿ç›®æ ‡ç­¾åå¼ã€‚é‚£ä¸ªç­¾åä»£è¡¨çš„å‡½æ•°æ—¶â€æ¥å—ä¸€ä¸ªreference æŒ‡å‘const GamCharacterâ€œï¼Œå¹¶è¿”å›intã€‚è¿™ä¸ªtr1::functionç±»å‹äº§ç”Ÿçš„å¯¹è±¡å¯æŒæœ‰ä»»ä½•ä¸æ­¤ç­¾åå¼å…¼å®¹çš„å¯è°ƒç”¨ç‰©ã€‚ä¾‹å¦‚å¯è°ƒç”¨ç‰©çš„<strong>å‚æ•°å¯ä»¥è¢«éšå¼çš„è½¬æ¢ä¸ºconst GameCharacters&amp;</strong>ï¼Œå…¶<strong>è¿”å›ç±»å‹å¯ä»¥è¢«éšå¼è½¬æ¢ä¸ºint</strong></p>
<p>tr1::functionå¯¹è±¡ç›¸å½“äºæŒ‡å‘å‡½æ•°çš„æ³›åŒ–æŒ‡é’ˆã€‚</p>
<blockquote>
<p>æ›´å…·ä¸å¼¹æ€§</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">short</span> <span class="title">calcHealth</span><span class="params">(<span class="type">const</span> GameCharacter&amp;)</span></span>;<span class="comment">// health calculation</span></span><br><span class="line"><span class="comment">// function; note </span></span><br><span class="line"><span class="comment">// non-int return type</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HealthCalculator</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// class for health</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> GameCharacter&amp;)</span> <span class="type">const</span><span class="comment">// calculation function</span></span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">    ... </span><br><span class="line">    &#125;<span class="comment">// objects</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameLevel</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">health</span><span class="params">(<span class="type">const</span> GameCharacter&amp;)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="comment">// health calculation</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// mem function; note</span></span><br><span class="line">&#125;;<span class="comment">// non-int return type</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EvilBadGuy</span>: <span class="keyword">public</span> GameCharacter &#123;</span><br><span class="line">    <span class="comment">// as before</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EyeCandyCharacter</span>: <span class="keyword">public</span> GameCharacter &#123;</span><br><span class="line">    <span class="comment">// another character</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// type; assume same</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// constructor as // EvilBadGuy</span></span><br><span class="line"><span class="function">EvilBadGuy <span class="title">ebg1</span><span class="params">(calcHealth)</span></span>;<span class="comment">// character using a</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// health calculation// function</span></span><br><span class="line"><span class="function">EyeCandyCharacter <span class="title">ecc1</span><span class="params">(HealthCalculator( ))</span></span>;<span class="comment">// character using a </span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// health calculation// function object</span></span><br><span class="line">GameLevel currentLevel;</span><br><span class="line">...</span><br><span class="line"><span class="function">EvilBadGuy <span class="title">ebg2</span><span class="params">( <span class="comment">// character using a</span></span></span></span><br><span class="line"><span class="params"><span class="function">Â Â Â Â std::tr1::bind(&amp;GameLevel::health,<span class="comment">// health calculation</span></span></span></span><br><span class="line"><span class="params"><span class="function">                            currentLevel,    <span class="comment">// member function;</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                      _1)</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="comment">// see below for details);</span></span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§£æebg2 -&gt; bind</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">EvilBadGuy <span class="title">ebg2</span><span class="params">( <span class="comment">// character using a</span></span></span></span><br><span class="line"><span class="params"><span class="function"> std::tr1::bind(&amp;GameLevel::health,<span class="comment">// health calculation</span></span></span></span><br><span class="line"><span class="params"><span class="function">                            currentLevel,    <span class="comment">// member function;</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                      _1)</span></span></span><br></pre></td></tr></table></figure>
<p>GameLevel::healthæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯éšå¼å‚æ•°currentLevelï¼Œä¹Ÿå°±æ˜¯thisæŒ‡å‘çš„é‚£ä¸ªã€å¦ä¸€ä¸ªæ˜¯referenceæŒ‡å‘GameCharactorã€‚</p>
<p>GameCharactersçš„å¥åº·è®¡ç®—å‡½æ•°å€¼æ¥å—å•ä¸€å‚æ•°ï¼šGameCharactersã€‚</p>
<p>ä½¿ç”¨GameLevel::healthä½œä¸ºebg2çš„å¥åº·è®¡ç®—å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ç‰¹æ®Šæ–¹å¼è½¬æ¢ï¼Œå–å‡ºGameLevelå…¶ä¸­çš„å¥åº·è®¡ç®—å‡½æ•°ã€‚</p>
<p>æœ¬ä¾‹ä¸­ç”¨currentLevelä½œä¸ºebg2çš„å¥åº·å‡½æ•°æ‰€éœ€çš„GameLevelçš„å¯¹è±¡ã€‚_1æ„å‘³ç€ç”¨currenLevelä½œä¸ºGamLevelçš„å¯¹è±¡</p>
<h3 id="the-â€œClassicâ€-Strategy-Pattern"><a href="#the-â€œClassicâ€-Strategy-Pattern" class="headerlink" title="the â€œClassicâ€ Strategy Pattern"></a>the â€œClassicâ€ Strategy Pattern</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\é»å’æ°\AppData\Roaming\marktext\images\2022-05-06-21-21-05-image.png" alt=""></p>
<p>åœ¨è¯¥å›¾ä¸­æŒ‡ç¤ºäº†GameCharacteæ˜¯æŸä¸ªç»§æ‰¿ä½“ç³»çš„æ ¹ç±»ï¼ŒEviBadGuyä¸EyeCandyCharacteréƒ½æ˜¯derived classesï¼šHealthCalcFuncæ˜¯å¦ä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„æ ¹ç±»ã€‚</p>
<blockquote>
<p>å®ç°ä»£ç </p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span>; <span class="comment">// forward declaration</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HealthCalcFunc</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">calc</span><span class="params">(<span class="type">const</span> GameCharacter&amp; gc)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">Â Â Â Â </span>&#123; </span><br><span class="line">Â Â Â Â ... </span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line">&#125;;</span><br><span class="line">HealthCalcFunc defaultHealthCalc;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameCharacter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">Â Â Â Â <span class="function"><span class="keyword">explicit</span> <span class="title">GameCharacter</span><span class="params">(HealthCalcFunc *phcf = &amp;defaultHealthCalc)</span>: </span></span><br><span class="line"><span class="function">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â pHealthCalc(phcf )&#123;</span>&#125;</span><br><span class="line">Â Â Â Â <span class="function"><span class="type">int</span> <span class="title">healthValue</span><span class="params">( )</span> <span class="type">const</span> </span></span><br><span class="line"><span class="function">Â Â Â Â </span>&#123; <span class="keyword">return</span> pHealthCalc-&gt;<span class="built_in">calc</span>(*<span class="keyword">this</span>); &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Â Â Â Â HealthCalcFunc *pHealthCalc;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-13"><a href="#æ€»ç»“-13" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Alternatives to virtual functions include the NVI idiom and variousforms of the Strategy design pattern. The NVI idiom is itself an ex-ample of the Template Method design pattern.</p>
<p>âœ¦A disadvantage of moving functionality from a member function to afunction outside the class is that the non-member function lacks ac-cess to the classâ€™s non-public members.</p>
<p>âœ¦tr1::function objects act like generalized function pointers. Such ob-jects support all callable entities compatible with a given target sig-nature.</p>
<hr>
<h2 id="æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°"><a href="#æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°" class="headerlink" title="æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°"></a>æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</h2><p><code>Never redefine an inherited non-virtual function</code></p>
<blockquote>
<p>non-virtualæ€§è´¨</p>
</blockquote>
<p>åœ¨æ¡æ¬¾34ä¸­æè¿°äº†non-virtualå‡½æ•°ä¼šç»™classå»ºç«‹ä¸€ä¸ª<strong>ä¸å˜æ€§</strong>(invariant),å‡Œé©¾å…¶<strong>ç‰¹å¼‚æ€§</strong>(specialization)</p>
<blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mf</span><span class="params">( )</span></span>;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>: <span class="keyword">public</span> B &#123; </span><br><span class="line">... </span><br><span class="line">&#125;;</span><br><span class="line">                <span class="comment">//Even without knowing anything about B, D, or mf, given an object x of</span></span><br><span class="line">                <span class="comment">//type D,</span></span><br><span class="line">D x;            <span class="comment">// x is an object of type D</span></span><br><span class="line">                <span class="comment">//you would probably be quite surprised if this,</span></span><br><span class="line">B *pB = &amp;x;      <span class="comment">// get pointer to xp</span></span><br><span class="line">B-&gt;<span class="built_in">mf</span>( );        <span class="comment">// call mf through pointerbehaved differently from this:</span></span><br><span class="line">D *pD = &amp;x;     <span class="comment">// get pointer to xp</span></span><br><span class="line">D-&gt;<span class="built_in">mf</span>( );      <span class="comment">// call mf through pointer</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­æˆ‘ä»¬éƒ½ä¼šè°ƒç”¨<strong>B::mf()</strong> ç‰ˆå‡½æ•°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨D classä¸­é‡å†™mf()é‚£ä¹ˆæˆ‘ä»¬ä¼šå‘ç°ä»¥ä¸‹é—®é¢˜</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>: <span class="keyword">public</span> B &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mf</span><span class="params">( )</span></span>;    <span class="comment">// hides B::mf; see Item33</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line">pB-&gt;<span class="built_in">mf</span>( );        <span class="comment">// calls B::mf</span></span><br><span class="line">pD-&gt;<span class="built_in">mf</span>( );        <span class="comment">// calls D::mf should call B::mf</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>non-virtualå‡½æ•°æ˜¯ä¸€ç§<strong>é™æ€ç»‘å®š</strong>(statically bound)</p>
</blockquote>
<pre><code>    åœ¨å­ç±»ä¸­é‡å†™non-virutalå‡½æ•°ï¼Œå®ƒä¼šæ ¹æ®å…¶**å£°æ˜å¼** (ä¹Ÿå°±æ˜¯D* ,B*)æ¥é€‰å–å‡½æ•°æ‰§è¡Œï¼Œä½†å®é™…ä¸ŠpBä¸pDæŒ‡å‘éƒ½æ˜¯**åŒä¸€å¯¹è±¡**ï¼ŒæŒ‰ç†æ¥è¯´åº”è¯¥è°ƒç”¨åŒä¸€å¯¹è±¡çš„å‡½æ•°ï¼Œå› æ­¤é‡å†™non-virtualå‡½æ•°ä¼š**å¯¼è‡´ç ´åå¤šæ€æ€§**ã€‚
</code></pre><blockquote>
<p>publicç»§æ‰¿å…³ç³»</p>
</blockquote>
<p>publicç»§æ‰¿å…³ç³»â€is-aâ€å…³ç³»ï¼Œé‚£ä¹ˆnon-vitualå‡½æ•°çš„ä½œç”¨(ä¸å˜æ€§å‡Œé©¾äºç‰¹å¼‚æ€§):</p>
<ol>
<li><p>é€‚ç”¨äºBå¯¹è±¡çš„æ¯ä¸€ä»¶äº‹ï¼Œä¹Ÿé€‚ç”¨ä¸Då¯¹è±¡</p>
</li>
<li><p>Bçš„derived classesä¸€å®šä¼šç»§æ‰¿mfçš„æ¥å£ä¸å®ç°ï¼Œå› ä¸ºmfæ˜¯Bçš„ä¸€ä¸ªnon-virutalå‡½æ•°</p>
</li>
</ol>
<blockquote>
<p>å¤šæ€æ€§çš„è™šæ„é—®é¢˜</p>
</blockquote>
<p>   æ¡æ¬¾7ï¼š virtualææ„å‡½æ•°ï¼Œå¯¹äºB<em> pd = new D();ç”±äºå£°æ˜çš„æ˜¯non-virtualçš„ææ„å‡½æ•°ï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™ä¼šæ ¹æ®<em>*å£°æ˜å¼æ¥å®šä¹‰</em></em> é™æ€ç»‘å®šè°ƒç”¨å‡½æ•°ï¼Œå› æ­¤åœ¨å¤šæ€ä¸­åªä¼šä½¿ç”¨Bçš„ææ„å‡½æ•°ï¼Œå¯¹äºDçš„ææ„åˆ™ä¸ä¼šè°ƒç”¨ï¼Œè¿™æ—¶å€™æœ‰äº›Dç±»çš„æˆå‘˜ä¸èƒ½è¢«ææ„ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼é—®é¢˜</p>
<h3 id="æ€»ç»“-14"><a href="#æ€»ç»“-14" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Never redefine an inherited non-virtual function.</p>
<hr>
<h2 id="æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„é»˜è®¤å‚æ•°å€¼"><a href="#æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„é»˜è®¤å‚æ•°å€¼" class="headerlink" title="æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„é»˜è®¤å‚æ•°å€¼"></a>æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„é»˜è®¤å‚æ•°å€¼</h2><p><code>Never redefine a function&#39;s inherited default parameter value</code></p>
<p><strong>virtualå‡½æ•°ç³»åŠ¨æ€ç»‘å®šï¼Œç„¶è€Œé»˜è®¤çš„å´æ˜¯é™æ€ç»‘å®š</strong></p>
<h3 id="é™æ€ç»‘å®š"><a href="#é™æ€ç»‘å®š" class="headerlink" title="é™æ€ç»‘å®š"></a>é™æ€ç»‘å®š</h3><blockquote>
<p>é™æ€ç»‘å®šä¹‰</p>
</blockquote>
<pre><code>    åœ¨ç¨‹åºä¸­è¢«**å£°æ˜æ—¶**æ‰€é‡‡ç”¨çš„ç±»å‹,é™æ€ç»‘å®šå®¹æ˜“é€ æˆçš„é—®é¢˜å¦‚ï¼šç»§æ‰¿ç±»é‡å†™non-virtualå‡½æ•°
</code></pre><p>ç®€å•æ¥è¯´å°±æ˜¯è°ƒç”¨å¯¹è±¡æ˜¯é‡‡ç”¨å£°æ˜å¯¹è±¡çš„ä¸€éƒ¨åˆ†è¡Œä¸º</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">// a class for geometric shapes</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">ShapeColor</span> &#123; Red, Green, Blue &#125;;</span><br><span class="line">    <span class="comment">// all shapes must offer a function to draw themselves</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">(ShapeColor )</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Shape::draw</span><span class="params">(ShapeColor color = Red)</span><span class="type">const</span></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;Shape::darw &quot;</span>&lt;&lt;color&lt;&lt;std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>: <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// notice the different default parameter value â€” bad!</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">(ShapeColor color = Green)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;Rectangle::darw &quot;</span>&lt;&lt;color&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>: <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">(ShapeColor color)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">    std::cout&lt;&lt;<span class="string">&quot;Circle::darw &quot;</span>&lt;&lt;color&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Shape *ps;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// static type = Shape*</span></span><br><span class="line">    Shape *pc = <span class="keyword">new</span> <span class="built_in">Circle</span>();Â Â Â Â <span class="comment">// static type = Shape*</span></span><br><span class="line">    Shape *pr = <span class="keyword">new</span> <span class="built_in">Rectangle</span>();<span class="comment">// static type = Shape*</span></span><br><span class="line">    ps = pc;</span><br><span class="line">    ps = pr;</span><br><span class="line">   <span class="comment">// ps-&gt;draw();</span></span><br><span class="line">    pc-&gt;<span class="built_in">draw</span>(Shape::Red);<span class="comment">// calls Circle::draw(Shape::Red)</span></span><br><span class="line">    pr-&gt;<span class="built_in">draw</span>(Shape::Red);<span class="comment">// calls Rectangle::draw(Shape::Red)</span></span><br><span class="line"></span><br><span class="line">    pr-&gt;<span class="built_in">draw</span>();<span class="comment">// calls Rectangle::draw(Shape::Red)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç»§æ‰¿å…³ç³»</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\é»å’æ°\AppData\Roaming\marktext\images\2022-05-07-20-28-31-image.png" alt=""></p>
<blockquote>
<p>æŒ‡é’ˆ(é™æ€ç±»å‹)</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Shape *ps;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// static type = Shape*</span></span><br><span class="line">Shape *pc = <span class="keyword">new</span> Circle;Â Â Â Â <span class="comment">// static type = Shape*</span></span><br><span class="line">Shape *pr = <span class="keyword">new</span> Rectangle;<span class="comment">// static type = Shape*</span></span><br></pre></td></tr></table></figure>
<h3 id="åŠ¨æ€ç»‘å®š"><a href="#åŠ¨æ€ç»‘å®š" class="headerlink" title="åŠ¨æ€ç»‘å®š"></a>åŠ¨æ€ç»‘å®š</h3><blockquote>
<p>åŠ¨æ€ç»‘å®šå®šä¹‰</p>
</blockquote>
<pre><code>   æ™®éçš„æ¥è¯´æ˜¯å¤šæ€æ€§ï¼Œç”±ä¸€ä¸ª**é™æ€ç±»å‹**çš„å¯¹è±¡æŒ‡é’ˆ(å¼•ç”¨)æŒ‡å‘ä¸€ä¸ªå­ç±»å¯¹è±¡ï¼Œåœ¨è¿è¡Œå…¶å°±ä¼šå°†è¡Œä¸ºäºå…¶æŒ‡å‘çš„å¯¹è±¡è¿›è¡Œç»‘å®šï¼Œè°ƒç”¨å­ç±»å¯¹è±¡çš„è¡Œä¸ºã€‚

    ç®€å•æ¥è¯´å°±æ˜¯è°ƒç”¨æŒ‡å‘å¯¹è±¡çš„è¡Œä¸º
</code></pre><blockquote>
<p>åŠ¨æ€ç±»å‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps = pc;<span class="comment">// psâ€™s dynamic type is// now Circle*</span></span><br><span class="line">ps = pr;<span class="comment">// psâ€™s dynamic type is// now Rectangle*</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è°ƒç”¨</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pc-&gt;<span class="built_in">draw</span>(Shape::Red);<span class="comment">// calls Circle::draw(Shape::Red)</span></span><br><span class="line">pr-&gt;<span class="built_in">draw</span>(Shape::Red);<span class="comment">// calls Rectangle::draw(Shape::Red)</span></span><br><span class="line">pr-&gt;<span class="built_in">draw</span>();</span><br><span class="line">====================</span><br><span class="line"><span class="comment">//è¿è¡Œç»“æœ</span></span><br><span class="line">Circle::darw <span class="number">0</span></span><br><span class="line">Rectangle::darw <span class="number">0</span></span><br><span class="line">Rectangle::darw <span class="number">0</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>é—®é¢˜åˆ†æ:åŠ¨æ€ç»‘å®šä¸é™æ€ç»‘å®šå†²çª</p>
</blockquote>
<pre><code>    åœ¨pr-&gt;draw();ä¸­å‡ºç°äº†é—®é¢˜ï¼Œprçš„åŠ¨æ€ç±»å‹ä¸ºRectangleè°ƒç”¨ä¸ºvirtualå‡½æ•°ï¼Œä½†Rectangle::drawé»˜è®¤å‚æ•°ä¸ºåº”è¯¥æ—¶GREENï¼Œä½†ç”±äºprçš„é™æ€ç±»å‹ä¸ºShape*ï¼Œæ‰€ä»¥æ­¤ä¸€è°ƒç”¨çš„é»˜è®¤é˜è¿°æ—¶æ¥è‡ªäºShape classï¼Œè€Œä¸æ˜¯æ¥ä¹‹äºRectangle classã€‚è¿™ä¸ªå‡½æ•°æ—¶ä¸¤ä¸ªç±»å…±åŒå®Œæˆçš„
</code></pre><h3 id="NVIè§£å†³æ–¹æ¡ˆ"><a href="#NVIè§£å†³æ–¹æ¡ˆ" class="headerlink" title="NVIè§£å†³æ–¹æ¡ˆ"></a>NVIè§£å†³æ–¹æ¡ˆ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">ShapeColor</span> &#123; Red, Green, Blue &#125;;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(ShapeColor color = Red)</span> <span class="type">const</span><span class="comment">// now non-virtual</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">doDraw</span>(color);<span class="comment">// calls a virtual</span></span><br><span class="line">    &#125;</span><br><span class="line">Â Â Â Â ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doDraw</span><span class="params">(ShapeColor color)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">                                    <span class="comment">// the actual work is</span></span><br><span class="line">&#125;;<span class="comment">// done in this func</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>: <span class="keyword">public</span> Shape &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">doDraw</span><span class="params">(ShapeColor color)</span> <span class="type">const</span></span>;<span class="comment">// note lack of a</span></span><br><span class="line">    ...<span class="comment">// default param val.</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<pre><code>    non-virtual å‡½æ•°ä¸€ä¸ªä¸ä¼šè¢«derived classesé‡å†™(æ¡æ¬¾36)ï¼Œæ‰€ä»¥è¿™ä¸ªè®¾è®¡å¾ˆæ¸…æ¥šåœ°ä½¿ç”¨äº†colorçš„é»˜è®¤å€¼ä¸ºRedï¼Œç›¸å½“äºå¼ºåˆ¶æ€§ä¸è®©åŠ¨æ€ç»‘å®šé€‰æ‹©é™æ€ç»‘å®šçš„å‚æ•°ï¼ŒNVIæ‰‹æ³•å°†åŠ¨æ€ç»‘å®šå’Œé™æ€ç»‘å®šé€šè¿‡**privateåœ¨ç»§æ‰¿ä¸­å¯è§æ€§**ï¼Œè¿›è¡Œäº†å·§å¦™çš„ç»“åˆ
</code></pre><h3 id="æ€»ç»“-15"><a href="#æ€»ç»“-15" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Never redefine an inherited default parameter value, because defaultparameter values are statically bound, while virtual functions â€” theonly functions you should be redefining â€” are dynamically bound.</p>
<hr>
<h2 id="æ¡æ¬¾38ï¼šé€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€"><a href="#æ¡æ¬¾38ï¼šé€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€" class="headerlink" title="æ¡æ¬¾38ï¼šé€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€"></a>æ¡æ¬¾38ï¼šé€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€</h2><p><code>Model &quot;has-a&quot;or&quot;is-implement-in-terms-of&quot; throught composition</code></p>
<blockquote>
<p>å¤åˆç±»å‹</p>
</blockquote>
<p>åœ¨ä¸€ä¸ªç±»ä¸­çš„æ•°æ®æˆå‘˜æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªè‡ªå®šä¹‰æ•°æ®ç±»å‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span> &#123; </span><br><span class="line">... </span><br><span class="line">&#125;;<span class="comment">// where someone lives</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhoneNumber</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">std::string name;<span class="comment">// composed object</span></span><br><span class="line">Address address;<span class="comment">// ditto</span></span><br><span class="line">PhoneNumber voiceNumber;<span class="comment">// ditto</span></span><br><span class="line">PhoneNumber faxNumber;<span class="comment">// ditto</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>has-aä¸is-a</p>
</blockquote>
<p>åœ¨ä¸Šè¿°Personä¸­å®šä¹‰äº†nameã€addressã€voiceNumberã€faxNumberï¼Œæˆ‘ä»¬éƒ½å¾ˆå®¹æ˜“è¯´ï¼Œè¿™ä¸ªäººæœ‰ä¸€ä¸ªåå­—ã€åœ°å€ã€å·ç ï¼Œä½†æˆ‘ä»¬ä¸èƒ½è¯´è¿™ä¸ªäººæ˜¯ä¸€ä¸ªåå­—ï¼Œå¦å¤–is-aæ˜¯ä¸€ç§ç»§æ‰¿å…³ç³»</p>
<h3 id="å¤åˆç±»å‹ä¸­çš„has-aå’Œâ€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€åŒºåˆ†"><a href="#å¤åˆç±»å‹ä¸­çš„has-aå’Œâ€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€åŒºåˆ†" class="headerlink" title="å¤åˆç±»å‹ä¸­çš„has-aå’Œâ€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€åŒºåˆ†"></a>å¤åˆç±»å‹ä¸­çš„has-aå’Œâ€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€åŒºåˆ†</h3><ul>
<li><p>has-aæ˜¯åº”ç”¨åŸŸ</p>
</li>
<li><p>is-implement-in-terms-ofæ˜¯å®ç°åŸŸ</p>
</li>
</ul>
<p>ç”¨Set&lt; T &gt;ç»§æ‰¿list&lt; T &gt;å£°æ˜å¦‚ä¸‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;<span class="comment">//å°†liståº”ç”¨äºSet</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Set</span>:<span class="keyword">public</span> std::list&lt;T&gt;&#123;...&#125;;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸Šè¿°ç»§æ‰¿å…³ç³»å¾ˆå®¹æ˜“åŒºåˆ†å‡ºé”™è¯¯ï¼Œlistå¯ä»¥æ’å…¥ç›¸åŒå…ƒç´ ï¼ŒSetä¸èƒ½å«æœ‰ç›¸åŒå…ƒç´ ï¼Œå› æ­¤åœ¨é€»è¾‘ä¸Šï¼ŒSetä¸é€‚ç”¨äºlistçš„é€»è¾‘ï¼Œå› æ­¤ä¹Ÿä¸æ˜¯is-aå…³ç³»ï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸¤ç§å…³ç³»ä¸èƒ½ç”¨publicæ¥å®ç°.</p>
<blockquote>
<p>æ­£ç¡®åšæ³•</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;<span class="comment">// the right way to use list for Set</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Set</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">member</span><span class="params">(<span class="type">const</span> T&amp; item)</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">const</span> T&amp; item)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">const</span> T&amp; item)</span></span>;</span><br><span class="line">    <span class="function">std::<span class="type">size_t</span> <span class="title">size</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::list&lt;T&gt; rep;<span class="comment">// representation for Set data </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å¤åˆç±»å‹å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºå…³ç³»ï¼ŒSetåªæ˜¯ä¾èµ–listæ¥å®ç°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">bool</span> Set&lt;T&gt;::<span class="built_in">member</span>(<span class="type">const</span> T&amp; item) <span class="type">const</span>&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span> std::<span class="built_in">find</span>(rep.<span class="built_in">begin</span>( ), rep.<span class="built_in">end</span>( ), item) != rep.<span class="built_in">end</span>( );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> Set&lt;T&gt;::<span class="built_in">insert</span>(<span class="type">const</span> T&amp; item)&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">if</span> (!<span class="built_in">member</span>(item)) rep.<span class="built_in">push_back</span>(item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> Set&lt;T&gt;::<span class="built_in">remove</span>(<span class="type">const</span> T&amp; item)&#123; </span><br><span class="line"><span class="keyword">typename</span> std::list&lt;T&gt;::iterator it =<span class="comment">// see Item42 for info on</span></span><br><span class="line">Â Â Â Â std::<span class="built_in">find</span>(rep.<span class="built_in">begin</span>( ), rep.<span class="built_in">end</span>( ), item);<span class="comment">// â€œtypenameâ€ here</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span> (it != rep.<span class="built_in">end</span>( )) rep.<span class="built_in">erase</span>(it);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">std::<span class="type">size_t</span> Set&lt;T&gt;::<span class="built_in">size</span>() <span class="type">const</span>&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span> rep.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-16"><a href="#æ€»ç»“-16" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Composition has meanings completely different from that of publicinheritance. </p>
<p>âœ¦In the application domain, composition means has-a. In the imple-mentation domain, it means is-implemented-in-terms-of.</p>
<hr>
<h2 id="æ¡æ¬¾39ï¼šè°¨æ…çš„ä½¿ç”¨â€œprivateâ€ç»§æ‰¿"><a href="#æ¡æ¬¾39ï¼šè°¨æ…çš„ä½¿ç”¨â€œprivateâ€ç»§æ‰¿" class="headerlink" title="æ¡æ¬¾39ï¼šè°¨æ…çš„ä½¿ç”¨â€œprivateâ€ç»§æ‰¿"></a>æ¡æ¬¾39ï¼šè°¨æ…çš„ä½¿ç”¨â€œprivateâ€ç»§æ‰¿</h2><p><code>use private inheritance judiciously</code></p>
<h3 id="Private-ç»§æ‰¿"><a href="#Private-ç»§æ‰¿" class="headerlink" title="Private ç»§æ‰¿"></a>Private ç»§æ‰¿</h3><blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>: <span class="keyword">private</span> Person &#123; ... &#125;; <span class="comment">// inheritance is now private</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">(<span class="type">const</span> Person&amp; p)</span></span>;<span class="comment">// anyone can eat</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">study</span><span class="params">(<span class="type">const</span> Student&amp; s)</span></span>;<span class="comment">// only students study</span></span><br><span class="line">Person p;<span class="comment">// p is a PersonStudent s;// s is a Student</span></span><br><span class="line"><span class="built_in">eat</span>(p);<span class="comment">// fine, p is a Person</span></span><br><span class="line"><span class="built_in">eat</span>(s);<span class="comment">// error! a Student isnâ€™t a Person</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>privateç»§æ‰¿</p>
</blockquote>
<p>æ ¹æ®ä»¥ä¸Šä»£ç çš„å±•ç¤ºï¼Œæˆ‘ä»¬ä¼šå‘ç°privateç»§æ‰¿ä¸publicç»§æ‰¿ä¸æ˜¯åŒä¸€ä¸ªå«ä¹‰ï¼ŒåŒæ ·çš„publicç»§æ‰¿ä¼šäº§ç”Ÿä¸€äº›é€»è¾‘ä¸Šçš„é”™è¯¯ï¼Œä¾‹å¦‚å­¦ç”Ÿä¸æ˜¯äºº</p>
<ul>
<li>privateç»§æ‰¿ä¸ä¼šæœ‰éšå¼è½¬æ¢ï¼ŒåŒæ ·<strong>ä¸èƒ½å¤šæ€</strong></li>
<li>privateçš„è¯­ä¹‰ä¸ºæ ¹æ®æŸç‰©å®ç°( is-implemented-in-terms-of),ä¸ä¼šå¯¹å¤–å‘ˆç°çˆ¶ç±»çš„æ¥å£</li>
<li>privateç»§æ‰¿ä¸­baseçš„æˆå‘˜éƒ½ä¼šå˜ä¸ºprivateæ— è®ºæ˜¯protectedè¿˜æ˜¯public</li>
</ul>
<p>å› æ­¤ï¼Œprivateåªåœ¨è½¯ä»¶çš„å®ç°ä¸­ä¼šæœ‰æ„ä¹‰ï¼Œåœ¨è½¯ä»¶çš„è®¾è®¡ä¸­æ¯«æ— æ„ä¹‰</p>
<h3 id="å¤åˆä¸privateç»§æ‰¿çš„æŠ‰æ‹©"><a href="#å¤åˆä¸privateç»§æ‰¿çš„æŠ‰æ‹©" class="headerlink" title="å¤åˆä¸privateç»§æ‰¿çš„æŠ‰æ‹©"></a>å¤åˆä¸privateç»§æ‰¿çš„æŠ‰æ‹©</h3><p>privateç»§æ‰¿ä¸å¤åˆéƒ½æœ‰æ ¹æ®æŸç‰©å®ç°( is-implemented-in-terms-of)çš„æ¦‚å¿µã€‚</p>
<blockquote>
<p>å–èˆ</p>
</blockquote>
<p>å°½å¯èƒ½çš„é€‰æ‹©å¤åˆï¼Œå¿…è¦æ—¶æ‰ä¼šä½¿ç”¨private(å½“protectedæˆå‘˜æˆ–virtualå‡½æ•°è¢«ç‰µæ‰¯è¿›æ¥)</p>
<h3 id="ä½¿ç”¨Privateç»§æ‰¿"><a href="#ä½¿ç”¨Privateç»§æ‰¿" class="headerlink" title="ä½¿ç”¨Privateç»§æ‰¿"></a>ä½¿ç”¨Privateç»§æ‰¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Timer</span><span class="params">(<span class="type">int</span> tickFrequency)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onTick</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// automatically called for each tick</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span>: <span class="keyword">private</span> Timer &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onTick</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// look at Widget usage data, etc</span></span><br><span class="line">    ....</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºvirtualå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ç”¨privateç»§æ‰¿</p>
<p>ä¸Šè¿°ä»£ç å½“æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªWidgetç±»è¿›è¡Œè®¡æ—¶ï¼Œåœ¨è¿è¡ŒæœŸä¸­å‘¨æœŸæ€§çš„æ£€æŸ¥Widgetç±»ã€‚å¯¹äºTimerè¿™ä¸€ä¸ªè®¡æ—¶å™¨ï¼ŒWidgetä¸­å¯ä»¥é‡æ–°å®šä¹‰Timerå†…çš„virtualå‡½æ•°ï¼Œä½†ç”¨publicæ£€æŸ¥å°±è¯´æ˜Widgetæ˜¯ä¸€ä¸ªTimeré‚£è‚¯å®šæ˜¯ä¸ç¬¦åˆå®é™…çš„ã€‚å¯¹äºprivateç»§æ‰¿ç¡®å®æ˜¯å®Œç¾çš„é€‰æ‹©ï¼š</p>
<ul>
<li>Widgetä¼šæ‹¥æœ‰Timerçš„ä¸€äº›å®ç°,å› æ­¤ä¹Ÿæ˜¯æ ¹æ®æŸç‰©å®ç°ã€‚</li>
<li>ç”¨æˆ·ä¹Ÿä¸ä¼šé€ æˆæ¥å£çš„æ»¥ç”¨ï¼Œè¯¥æ­¤Timerå®ç°ä¹Ÿæ˜¯å¯¹Widgetå¯¹è±¡å†…å¯è§çš„ã€‚</li>
</ul>
<h3 id="å¤åˆå®ç°"><a href="#å¤åˆå®ç°" class="headerlink" title="å¤åˆå®ç°"></a>å¤åˆå®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WidgetTimer</span>: <span class="keyword">public</span> Timer &#123;</span><br><span class="line">        <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">onTick</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">        ...</span><br><span class="line">    &#125;; </span><br><span class="line">    WidgetTimer timer;</span><br><span class="line">...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç”¨å¤åˆç±»çš„æ–¹æ³•å®ç°privateç»§æ‰¿åŒæ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç•¥æ˜¾å¤æ‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\é»å’æ°\AppData\Roaming\marktext\images\2022-05-10-10-05-01-image.png" alt=""></p>
<h3 id="æ€»ç»“-17"><a href="#æ€»ç»“-17" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Private  inheritance  means  is-implemented-in-terms  of.  Itâ€™s  usually inferior  to  composition,  but  it  makes  sense  when  a  derived  classneeds access to protected base class members or needs to redefineinherited virtual functions.</p>
<p>âœ¦Unlike composition, private inheritance can enable the empty baseoptimization. This can be important for library developers who strive to minimize object sizes</p>
<hr>
<h2 id="æ¡æ¬¾40ï¼šæ˜æ™ºè€Œè°¨æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿"><a href="#æ¡æ¬¾40ï¼šæ˜æ™ºè€Œè°¨æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿" class="headerlink" title="æ¡æ¬¾40ï¼šæ˜æ™ºè€Œè°¨æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿"></a>æ¡æ¬¾40ï¼šæ˜æ™ºè€Œè°¨æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</h2><h3 id="å¤šé‡ç»§æ‰¿"><a href="#å¤šé‡ç»§æ‰¿" class="headerlink" title="å¤šé‡ç»§æ‰¿"></a>å¤šé‡ç»§æ‰¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BorrowableItem</span> &#123;<span class="comment">// something a library lets you borrow</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">checkOut</span><span class="params">()</span></span>;<span class="comment">// check the item out from the library</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElectronicGadget</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkOut</span><span class="params">()</span> <span class="type">const</span></span>;<span class="comment">// perform self-test, return whether</span></span><br><span class="line">    ...<span class="comment">// test succeeds</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MP3Player</span>:<span class="comment">// note MI here</span></span><br><span class="line">        <span class="keyword">public</span> BorrowableItem,<span class="comment">// (some libraries loan MP3 players)</span></span><br><span class="line">        <span class="keyword">public</span> ElectronicGadget</span><br><span class="line">&#123; ... &#125;;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">// class definition is unimportant</span></span><br><span class="line">MP3Player mp;</span><br><span class="line">mp.<span class="built_in">checkOut</span>();<span class="comment">// ambiguous! which checkOut?</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mp.ElectronicGadget::<span class="built_in">checkOut</span>();</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºåœ¨MP3playerä¸­åˆä¸¤ä¸ªç›¸åŒçš„æ¥å£ï¼Œå› æ­¤åœ¨è°ƒç”¨æ˜¯ä¼šæ— æ³•è¯†åˆ«åˆ°åº•è°ƒç”¨é‚£ä¸ªï¼Œå› æ­¤åªèƒ½æŒ‡å®šæ•°æ®æˆå‘˜</p>
<p>ä½†æ˜¯ä¼šå¾—åˆ°ä¸€ä¸ªå°è¯•è°ƒç”¨privateæˆå‘˜çš„é”™è¯¯</p>
<h3 id="è±å½¢ç»§æ‰¿"><a href="#è±å½¢ç»§æ‰¿" class="headerlink" title="è±å½¢ç»§æ‰¿"></a>è±å½¢ç»§æ‰¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">File</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InputFile</span>: <span class="keyword">public</span> File &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OutputFile</span>: <span class="keyword">public</span> File &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IOFile</span>: <span class="keyword">public</span> InputFile,<span class="keyword">public</span> OutputFile&#123; ... &#125;;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\lyj\AppData\Roaming\Typora\typora-user-images\image-20220511205507673.png" alt="image-20220511205507673"></p>
<p>ä»¥ä¸Šçš„ç»§æ‰¿è·¯çº¿æœ‰ä¸¤ä¸ªæ¡é‚£ä¹ˆï¼Œå‡è®¾Fileæœ‰ä¸€ä¸ªfilenameæ•°æ®æˆå‘˜åˆ†åˆ«ç»§æ‰¿åˆ°InputFileå’ŒOutputFileï¼Œå½“IOFileè¿›è¡Œå¤šé‡ç»§æ‰¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå¾—åˆ°ä¸¤ä»½filename(InputFile::filename,Output::filename)ã€‚</p>
<p>å¾—åˆ°çš„IOFileä¸­å¦‚æœè¦æ“ä½œfilenameè¿™<strong>æ•°æ®æˆå‘˜è¦æŒ‡å®šæ¥è‡ªäºé‚£ä¸ªçˆ¶ç±»</strong>åŒä¸Šã€‚ä½†å†é€»è¾‘ä¸Šè¿™æ˜¯ä¸ç¬¦åˆé€»è¾‘ï¼Œä¸€ä¸ªæ–‡ä»¶ä¸å¯èƒ½æ‹¥æœ‰ä¸¤ä¸ªåå­—ã€‚è¿™æ—¶å€™å°±éœ€è¦<strong>è™šæ‹Ÿç»§æ‰¿</strong>ã€‚</p>
<h3 id="è™šæ‹Ÿç»§æ‰¿"><a href="#è™šæ‹Ÿç»§æ‰¿" class="headerlink" title="è™šæ‹Ÿç»§æ‰¿"></a>è™šæ‹Ÿç»§æ‰¿</h3><blockquote>
<p>å«ä¹‰</p>
<p>è§£å†³å¤šç»§æ‰¿æ—¶çš„å‘½åå†²çªå’Œå†—ä½™æ•°æ®é—®é¢˜ï¼Œä½¿å¾—åœ¨æ´¾ç”Ÿç±»ä¸­åªä¿ç•™ä¸€ä»½é—´æ¥åŸºç±»çš„æˆå‘˜ã€‚</p>
</blockquote>
<p>é˜²æ­¢äºŒä¹‰æ€§é—®é¢˜ï¼Œå…±äº«Top-Baseç±»æ•°æ®ã€‚</p>
<blockquote>
<p>è™šæ‹Ÿç»§æ‰¿ä¸æ™®é€šç»§æ‰¿çš„åŒºåˆ«</p>
</blockquote>
<p><strong>æ—¶é—´</strong>åœ¨é€šè¿‡ç»§æ‰¿ç±»å¯¹è±¡è®¿é—®è™šåŸºç±»å¯¹è±¡ä¸­çš„æˆå‘˜ï¼ˆåŒ…æ‹¬æ•°æ®æˆå‘˜å’Œå‡½æ•°æˆå‘˜ï¼‰æ—¶ï¼Œéƒ½å¿…é¡»é€šè¿‡æŸç§é—´æ¥å¼•ç”¨æ¥å®Œæˆï¼Œè¿™æ ·ä¼šå¢åŠ å¼•ç”¨å¯»å€æ—¶é—´ï¼ˆå°±å’Œè™šå‡½æ•°ä¸€æ ·ï¼‰ï¼Œå…¶å®å°±æ˜¯è°ƒæ•´thisæŒ‡é’ˆä»¥æŒ‡å‘è™šåŸºç±»å¯¹è±¡ï¼Œåªä¸è¿‡è¿™ä¸ªè°ƒæ•´æ˜¯è¿è¡Œæ—¶é—´æ¥å®Œæˆçš„ã€‚(è™šæ‹Ÿå°±æ˜¯è¿è¡ŒæœŸè¿›è¡Œé€‰æ‹©)</p>
<p><strong>ç©ºé—´</strong>ç”±äºå…±äº«æ‰€ä»¥ä¸å¿…è¦åœ¨å¯¹è±¡å†…å­˜ä¸­ä¿å­˜å¤šä»½è™šåŸºç±»å­å¯¹è±¡çš„æ‹·è´ï¼Œè¿™æ ·è¾ƒä¹‹ å¤šç»§æ‰¿èŠ‚çœç©ºé—´ã€‚è™šæ‹Ÿç»§æ‰¿ä¸æ™®é€šç»§æ‰¿ä¸åŒçš„æ˜¯ï¼Œè™šæ‹Ÿç»§æ‰¿å¯ä»¥é˜²æ­¢å‡ºç°diamondç»§æ‰¿æ—¶ï¼Œä¸€ä¸ªæ´¾ç”Ÿç±»ä¸­åŒæ—¶å‡ºç°äº†ä¸¤ä¸ªåŸºç±»çš„å­å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†ä¿è¯ è¿™ä¸€ç‚¹ï¼Œåœ¨è™šæ‹Ÿç»§æ‰¿æƒ…å†µä¸‹ï¼ŒåŸºç±»å­å¯¹è±¡çš„å¸ƒå±€æ˜¯ä¸åŒäºæ™®é€šç»§æ‰¿çš„ã€‚å› æ­¤ï¼Œå®ƒéœ€è¦å¤šå‡ºä¸€ä¸ªæŒ‡å‘åŸºç±»å­å¯¹è±¡çš„æŒ‡é’ˆã€‚</p>
<blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">File</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InputFile</span>: <span class="keyword">virtual</span> <span class="keyword">public</span> File &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OutputFile</span>: <span class="keyword">virtual</span> <span class="keyword">public</span> File &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IOFile</span>: <span class="keyword">public</span> InputFile,<span class="keyword">public</span> OutputFile&#123; ... &#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„åšæ³•å°±ä¼šä½¿å¾—å†æœ€ç»ˆçš„outputFileä¸­ä»…æœ‰ä¸€ä¸ªä¸€ä»½filenameï¼Œä¸”ä¸ä¼šäº§ç”ŸäºŒä¹‰æ€§</p>
<h4 id="è™šæ‹Ÿç»§æ‰¿çš„æˆæœ¬"><a href="#è™šæ‹Ÿç»§æ‰¿çš„æˆæœ¬" class="headerlink" title="è™šæ‹Ÿç»§æ‰¿çš„æˆæœ¬"></a>è™šæ‹Ÿç»§æ‰¿çš„æˆæœ¬</h4><blockquote>
<p>ç©ºé—´</p>
</blockquote>
<p>virtualç»§æ‰¿çš„classäº§ç”Ÿçš„non-virtualçš„ç»§æ‰¿ä½“ç§¯å¤§</p>
<blockquote>
<p>æ—¶é—´</p>
</blockquote>
<p>è®¿é—®virtualç»§æ‰¿çš„æˆå‘˜å˜é‡æ—¶ï¼Œæ¯”è®¿é—®non-virtual base classeçš„é€Ÿåº¦æ…¢</p>
<h4 id="è™šæ‹Ÿç»§æ‰¿çš„åˆå§‹åŒ–è§„åˆ™æ›´å¤æ‚"><a href="#è™šæ‹Ÿç»§æ‰¿çš„åˆå§‹åŒ–è§„åˆ™æ›´å¤æ‚" class="headerlink" title="è™šæ‹Ÿç»§æ‰¿çš„åˆå§‹åŒ–è§„åˆ™æ›´å¤æ‚"></a>è™šæ‹Ÿç»§æ‰¿çš„åˆå§‹åŒ–è§„åˆ™æ›´å¤æ‚</h4><blockquote>
<p>åˆå§‹åŒ–èŒè´£æœ‰ç»§æ‰¿ä¸­çš„æœ€åº•å±‚æ‰¿æ‹…</p>
</blockquote>
<ol>
<li>classesè‹¥æ´¾ç”Ÿè‡ªvirtual basesè€Œéœ€è¦åˆå§‹åŒ–ï¼Œå¿…é¡»è¦çŸ¥é“å…¶virtual bases</li>
<li>å½“ä¸€ä¸ªæ–°çš„derived classåŠ å…¥ç»§æ‰¿ä½“ç³»ä¸­ï¼Œå®ƒå¿…é¡»æ‰¿å½“å…¶virtual basesçš„åˆå§‹åŒ–èŒè´£</li>
</ol>
<h4 id="è™šæ‹Ÿç»§æ‰¿çš„æŠ‰æ‹©"><a href="#è™šæ‹Ÿç»§æ‰¿çš„æŠ‰æ‹©" class="headerlink" title="è™šæ‹Ÿç»§æ‰¿çš„æŠ‰æ‹©"></a>è™šæ‹Ÿç»§æ‰¿çš„æŠ‰æ‹©</h4><ol>
<li>éå¿…è¦ä¸ç”¨è™šæ‹Ÿç»§æ‰¿ï¼Œå°±ç”¨non-virtual ç»§æ‰¿</li>
<li>å¿…é¡»ä½¿ç”¨virtual base classesï¼Œå°½å¯èƒ½é¿å…å†å…¶ä¸­æ”¾ç½®æ•°æ®</li>
</ol>
<h3 id="æ€»ç»“-18"><a href="#æ€»ç»“-18" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Multiple inheritance is more complex than single inheritance. It canlead to new ambiguity issues and to the need for virtual inheritance. </p>
<p>âœ¦Virtual  inheritance  imposes  costs  in  size,  speed,  and  complexity  ofinitialization and assignment. Itâ€™s most practical when virtual baseclasses have no data.</p>
<p>âœ¦Multiple  inheritance  does  have  legitimate  uses.  One  scenario  in-volves  combining  public  inheritance  from  an  Interface  class  withprivate inheritance from a class that helps with implementation.CPersonIPersonPersonInfo{private}</p>
<hr>
<h1 id="æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹"><a href="#æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹" class="headerlink" title="æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹"></a>æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹</h1><h2 id="æ¡æ¬¾41ï¼šäº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€"><a href="#æ¡æ¬¾41ï¼šäº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€" class="headerlink" title="æ¡æ¬¾41ï¼šäº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€"></a>æ¡æ¬¾41ï¼šäº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</h2><p><code>Understand implicit interfaces and compile-time polymorphism</code></p>
<h3 id="é¢å¯¹å¯¹è±¡"><a href="#é¢å¯¹å¯¹è±¡" class="headerlink" title="é¢å¯¹å¯¹è±¡"></a>é¢å¯¹å¯¹è±¡</h3><ul>
<li>æä¾›æ˜¾ç¤ºæ¥å£</li>
<li>è¿è¡ŒæœŸå¤šæ€</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>( );</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Widget</span>( );</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> std::<span class="type">size_t</span> <span class="title">size</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">normalize</span><span class="params">( )</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">( Widget&amp; other)</span></span>;<span class="comment">// see Item25</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//and this (equally meaningless) function,</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doProcessing</span><span class="params">( Widget&amp; w)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (w.<span class="built_in">size</span>( ) &gt; <span class="number">10</span> &amp;&amp; w != someNastyWidget) &#123;</span><br><span class="line">        <span class="function">Widget <span class="title">temp</span><span class="params">(w)</span></span>;</span><br><span class="line">        temp.<span class="built_in">normalize</span>( );</span><br><span class="line">        temp.<span class="built_in">swap</span>(w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆ†æ</p>
</blockquote>
<ul>
<li>æ˜¾ç¤ºæ¥å£ï¼šåœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬åœ¨<code>doProcessing</code>ä¸­è°ƒç”¨wçš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æºæ–‡ä»¶ä¸­æ‰¾åˆ°è¿™äº›æ¥å£(.hæ–‡ä»¶)ï¼Œå¿…é¡»çŸ¥é“æ¥å£çš„å®ç°ã€‚</li>
<li>è¿è¡ŒæœŸå¤šæ€ï¼šåœ¨æ¡æ¬¾37ä¸­æœ‰åŠ¨æ€ç±»å‹ç»‘å®šï¼Œwidgetä¸­virtualå‡½æ•°è¡¨ç°å‡ºæ¥çš„ä¸ºè¿è¡ŒæœŸå¤šæ€</li>
</ul>
<h3 id="Templateä»¥åŠæ³›å‹ç¼–ç¨‹-generic-programming"><a href="#Templateä»¥åŠæ³›å‹ç¼–ç¨‹-generic-programming" class="headerlink" title="Templateä»¥åŠæ³›å‹ç¼–ç¨‹( generic programming )"></a>Templateä»¥åŠæ³›å‹ç¼–ç¨‹( generic programming )</h3><blockquote>
<p>é¢å¯¹å¯¹è±¡çš„è§„åˆ™ä¾ç„¶å­˜åœ¨ä½†æ˜¯è¢«å¼±åŒ–äº†</p>
</blockquote>
<ul>
<li>éšå¼æ¥å£</li>
<li>ç¼–è¯‘æœŸå¤šæ€</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doProcessing</span><span class="params">(T&amp; w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (w.<span class="built_in">size</span>( ) &gt; <span class="number">10</span> &amp;&amp; w != someNastyWidget) &#123;</span><br><span class="line">        <span class="function">T <span class="title">temp</span><span class="params">(w)</span></span>;</span><br><span class="line">        temp.<span class="built_in">normalize</span>( );</span><br><span class="line">        temp.<span class="built_in">swap</span>(w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>wæ‰€æ”¯æŒçš„æ¥å£ï¼Œæ˜¯ç”±templateä¸­çš„wèº«ä¸Šçš„æ“ä½œæ¥å†³å®šï¼Œwéœ€è¦æä¾›ä¸€ç³»åˆ—çš„éšå¼æ¥å£</li>
<li>wçš„ä»»ä½•å‡½æ•°çš„è°ƒç”¨ï¼Œå…¥operator&gt; and operator!=,æœ‰å¯èƒ½é€ æˆtemplateçš„æ®å…·ç°åŒ–(instantiated),è¿™äº›å‡½æ•°çš„è°ƒç”¨éƒ½æ˜¯å…·ç°åŒ–åœ¨ç¼–è¯‘æœŸã€‚é€šä¿—æ¥è®²å°±æ˜¯ï¼Œé€šè¿‡æ¨¡æ¿ç±»å‹Tå»åˆ¤æ–­Tä¸­æ˜¯å¦æœ‰ä»¥ä¸‹è¡Œä¸º(æ¥å£)ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šç¼–è¯‘å¤±è´¥ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿›è¡Œé€‰æ‹©</li>
</ul>
<h3 id="è¿è¡ŒæœŸå¤šæ€ä¸ç¼–è¯‘æœŸå¤šæ€"><a href="#è¿è¡ŒæœŸå¤šæ€ä¸ç¼–è¯‘æœŸå¤šæ€" class="headerlink" title="è¿è¡ŒæœŸå¤šæ€ä¸ç¼–è¯‘æœŸå¤šæ€"></a>è¿è¡ŒæœŸå¤šæ€ä¸ç¼–è¯‘æœŸå¤šæ€</h3><blockquote>
<p>åŒºåˆ«</p>
</blockquote>
<ul>
<li>è¿è¡ŒæœŸå¤šæ€ï¼šé‚£ä¸ªvirtualå‡½æ•°è¢«é€‰æ‹©</li>
<li>ç¼–è¯‘æœŸå¤šæ€ï¼šé‚£ä¸ªé‡è½½å‡½æ•°è¢«è°ƒç”¨</li>
</ul>
<h3 id="éšå¼æ¥å£ä¸æ˜¾å¼æ¥å£"><a href="#éšå¼æ¥å£ä¸æ˜¾å¼æ¥å£" class="headerlink" title="éšå¼æ¥å£ä¸æ˜¾å¼æ¥å£"></a>éšå¼æ¥å£ä¸æ˜¾å¼æ¥å£</h3><blockquote>
<p>æ˜¾å¼æ¥å£</p>
</blockquote>
<p>é€šå¸¸æ˜¯ç”±å‡½æ•°çš„ç­¾åå¼(å‡½æ•°åç§°ã€å‚æ•°ç±»å‹ã€è¿”å›ç±»å‹)æ„æˆ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Widget</span>( );</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Widget</span>( );</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::<span class="type">size_t</span> <span class="title">size</span><span class="params">( )</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">normalize</span><span class="params">( )</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">( Widget&amp; other)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Špublicæ¥å£æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ã€ææ„å‡½æ•°ã€å„ä¸ªæˆå‘˜å‡½æ•°åŠå…¶å‚æ•°ç±»å‹ã€è¿”å›ç±»å‹ã€å¸¸é‡æ€§æ„æˆã€‚</p>
<blockquote>
<p>éšå¼æ¥å£</p>
</blockquote>
<p>å®ƒä¸åŸºäºå‡½æ•°ç­¾åå¼ï¼Œæ˜¯ç”±æœ‰æ•ˆè¡¨è¾¾å¼(valid expression)ç»„æˆã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doProcessing</span><span class="params">(T&amp; w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (w.<span class="built_in">size</span>( ) &gt; <span class="number">10</span> &amp;&amp; w != someNastyWidget) </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼š</p>
<p>Tçš„éšå¼æ¥å£æœ‰ä¸€ç³»åˆ—çš„çº¦æŸ</p>
<ul>
<li>å¿…é¡»æä¾›sizeå‡½æ•°</li>
<li>å¿…é¡»æä¾›operator !=çš„ç±»å‹æ¯”è¾ƒå‡½æ•°(å‡è®¾<code>someNastyWidget</code>çš„ç±»å‹ä¸ºT)</li>
</ul>
<p><strong>éšå¼æ¥å£åŒæ ·éœ€è¦æ”¯æŒTç±»å‹</strong></p>
<h3 id="æ€»ç»“-19"><a href="#æ€»ç»“-19" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Both classes and templates support interfaces and polymorphism.</p>
<p> âœ¦For classes, interfaces are explicit and centered on function signatures. Polymorphism occurs at runtime through virtual functions. </p>
<p>âœ¦For template parameters, interfaces are implicit and based on valid expressions. Polymorphism occurs during compilation through template instantiation and function overloading resolution.</p>
<hr>
<h2 id="æ¡æ¬¾42ï¼šäº†è§£typenameçš„åŒé‡æ„ä¹‰"><a href="#æ¡æ¬¾42ï¼šäº†è§£typenameçš„åŒé‡æ„ä¹‰" class="headerlink" title="æ¡æ¬¾42ï¼šäº†è§£typenameçš„åŒé‡æ„ä¹‰"></a>æ¡æ¬¾42ï¼šäº†è§£typenameçš„åŒé‡æ„ä¹‰</h2><p><code>Understand the two meaning of typename</code></p>
<h3 id="class-and-typename-å£°æ˜"><a href="#class-and-typename-å£°æ˜" class="headerlink" title="class and typename å£°æ˜"></a>class and typename å£°æ˜</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; <span class="keyword">class</span> <span class="title class_">widget</span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">class</span> <span class="title class_">Widget</span>;</span><br></pre></td></tr></table></figure>
<p>class ä¸ typenameæ²¡æœ‰ä»»ä½•ä¸åŒã€‚å½“å£°æ˜templateç±»å‹å‚æ•°ï¼Œclasså’Œtypenameçš„æ„ä¹‰å®Œå…¨ç›¸åŒ</p>
<h3 id="typenameçš„å¦ä¸€é‡æ„ä¹‰"><a href="#typenameçš„å¦ä¸€é‡æ„ä¹‰" class="headerlink" title="typenameçš„å¦ä¸€é‡æ„ä¹‰"></a>typenameçš„å¦ä¸€é‡æ„ä¹‰</h3><blockquote>
<p>å£°æ˜â€œç±»å‹â€</p>
</blockquote>
<p>å½“æœ‰staticæˆå‘˜å˜é‡ä¸T::~å®šä¹‰çš„ç±»å‹å‘½åå†²çªæ—¶ä¼šé€ æˆç¼–è¯‘å™¨çš„è­¦å‘Šï¼Œå› æ­¤éœ€è¦typenameçš„æ˜¾å¼çš„å£°æ˜è¿™æ˜¯å‘½åä¸ºä¸€ä¸ª<strong>ç±»å‹</strong>ï¼Œè€Œä¸æ˜¯<strong>å˜é‡</strong></p>
<blockquote>
<p>ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> C&gt;<span class="comment">// typename allowed (as is â€œclassâ€)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">( <span class="type">const</span> C&amp; container,<span class="comment">// typename not allowed</span></span></span></span><br><span class="line"><span class="params"><span class="function">       <span class="keyword">typename</span> C::iterator iter)</span></span>;<span class="comment">// typename required</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°çš„Cä¸æ˜¯åµŒå¥—ä»å±ç±»å‹åç§°ï¼Œæ‰€ä»¥å£°æ˜containeræ—¶å¹¶ä¸éœ€è¦typenameä¸ºç­¾åˆ°ï¼Œä½†C::iteratoræ˜¯ä¸ªåµŒå¥—ä»å±ç±»å‹å› æ­¤éœ€è¦typenameä½œä¸ºå‰ç½®å£°æ˜</p>
<blockquote>
<p>ä¾‹å¤–</p>
</blockquote>
<p>typenameä¸èƒ½å‡ºç°åœ¨base classes listå†…çš„åµŒå¥—ä»å±ç±»å‹åç§°ä¹‹å‰ï¼Œä¹Ÿä¸å¯ä»¥åœ¨member initalization listä¸­ä½œä¸ºbase classä¿®é¥°ç¬¦</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span>: <span class="keyword">public</span> Base&lt;T&gt;::Nested &#123;<span class="comment">// base class list: typename not</span></span><br><span class="line"><span class="keyword">public</span>:<span class="comment">// allowed</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Derived</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">        : Base&lt;T&gt;::Nested(x)// base class identifier in mem.&#123;</span></span><br><span class="line">        <span class="comment">// init. list: typename not allowed</span></span><br><span class="line">        <span class="keyword">typename</span> Base&lt;T&gt;::Nested temp;     <span class="comment">// use of nested dependent type</span></span><br><span class="line">        ...<span class="comment">// name not in a base class list or</span></span><br><span class="line">&#125;<span class="comment">// as a base class identifier in a </span></span><br><span class="line">...<span class="comment">// mem. init. list: typename required</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>typename ä¸ typedefè¿ç”¨</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> IterT&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">workWithIterator</span><span class="params">(IterT iter)</span></span>&#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> std::iterator_traits&lt;IterT&gt;::value_type value_type;</span><br><span class="line">    <span class="function">value_type <span class="title">temp</span><span class="params">(*iter)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-20"><a href="#æ€»ç»“-20" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦When declaring template parameters, class  and typename  are  inter-changeable.</p>
<p>âœ¦Use typename  to  identify  nested  dependent  type  names,  except  inbase class lists or as a base class identifier in a member initializa-tion list</p>
<hr>
<h2 id="æ¡æ¬¾43-ï¼šå­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°"><a href="#æ¡æ¬¾43-ï¼šå­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°" class="headerlink" title="æ¡æ¬¾43 ï¼šå­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°"></a>æ¡æ¬¾43 ï¼šå­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°</h2><p><code>Know how to access names in templatized base classes</code></p>
<h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªç¨‹åºå¯ä»¥å‘é€æ¶ˆæ¯ç»™ä¸åŒå…¬å¸ï¼Œä¿¡æ¯å¯ä»¥ä»¥å¯†æ–‡æˆ–åˆ™æ˜æ–‡çš„æ–¹å¼å‘é€ï¼Œç”¨ç±»æ¨¡æ¿è¿™å¯ä»¥åœ¨ç¼–è¯‘æœŸå¯¹å…¬å¸è¿›è¡Œé€‰æ‹©</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CompanyA</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendCleartext</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendEncrypted</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompanyB</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendCleartext</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendEncrypted</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line">...<span class="comment">// classes for other companies</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MsgInfo</span> &#123; ... &#125;;<span class="comment">// class for holding information</span></span><br><span class="line"><span class="comment">// used to create a message</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Company&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MsgSender</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...<span class="comment">// ctors, dtor, etc.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendClear</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span></span>&#123;</span><br><span class="line">        std::string msg;<span class="comment">//create msg from info;</span></span><br><span class="line">        Company c;</span><br><span class="line">        c.<span class="built_in">sendCleartext</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendSecret</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span><span class="comment">// similar to sendClear, except</span></span></span><br><span class="line"><span class="function">    </span>&#123; ... &#125;<span class="comment">// calls c.sendEncrypted</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MsgSenderç±»çš„è°ƒç”¨ä¸ä¼šç”¨ä»»ä½•çš„é—®é¢˜</p>
<p>æ·»åŠ æ´¾ç”Ÿç±»LoggingMsgSender</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Company&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingMsgSender</span>: <span class="keyword">public</span> MsgSender&lt;Company&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    ...<span class="comment">// ctors, dtor, etc.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendClearMsg</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span></span>&#123;</span><br><span class="line">        <span class="comment">//write &quot;before sending&quot; info to the log;</span></span><br><span class="line">        <span class="built_in">sendClear</span>(info);<span class="comment">// call base class function;</span></span><br><span class="line">                        <span class="comment">// this code will not compile!</span></span><br><span class="line">        <span class="comment">//write &quot;after sending&quot; info to the log;</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>:ice_cream: è¿™ä¸ªæ´¾ç”Ÿç±»åœ¨æ–°çš„ä¸€ä¸ªnon-virtual memberå‡½æ•°ä¸­è°ƒç”¨äº†çˆ¶ç±»çš„non-virtual memberå‡½æ•°,è¿™ä¸ªå‡½æ•°è§£å†³äº†(æ¡æ¬¾33å’Œæ¡æ¬¾36)non-virtualå‡½æ•°åœ¨æ´¾ç”Ÿç±»ä¸­å‡ºç°çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªä»£ç åœ¨ä¸åŒçš„ç¼–è¯‘å™¨æ˜¯<strong>ä¸èƒ½ç¼–è¯‘çš„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\lyj\AppData\Roaming\Typora\typora-user-images\image-20220518220901314.png" alt="image-20220518220901314"></p>
<blockquote>
<p>é—®é¢˜æ‰€åœ¨</p>
</blockquote>
<p>ç¼–è¯‘å™¨é‡åˆ°LoggingMsgSenderçš„æ¨¡æ¿å®šä¹‰ï¼Œä¸çŸ¥é“å®ƒæ˜¯ç»§æ‰¿çš„é‚£ä¸ªç±»ã€‚</p>
<p>å› ä¸ºCompanyæ˜¯ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼Œå®ƒæ˜¯ä¸ç¡®å®šçš„ä¸€ä¸ªå‚æ•°ï¼Œåªæœ‰å½“LoggingMsgSenderè¢«å®ä¾‹åŒ–åCompanyæ‰ä¼šç¡®å®šï¼Œå› æ­¤åœ¨MsgSender&lt; Company &gt;çš„æ´¾ç”Ÿç±»ä¸­ä¼šå‡ºç°æ— æ³•ç¡®å®šç»§æ‰¿çš„çˆ¶ç±»çš„é—®é¢˜ã€‚</p>
<p>æ›´åŠ æ˜ç¡®çš„è¯´æ˜¯ä¸çŸ¥é“Companyä¸­æ˜¯å¦æœ‰sendClearè¿™ä¸ªå‡½æ•°</p>
<blockquote>
<p>æ¨¡æ¿å…¨ç‰¹åŒ–</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CompanyZ</span> &#123;<span class="comment">// this class offers no</span></span><br><span class="line"><span class="keyword">public</span>:<span class="comment">// sendCleartext function</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendEncrypted</span><span class="params">(<span class="type">const</span> std::string&amp; msg)</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;<span class="comment">// a total specialization of </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MsgSender</span>&lt;CompanyZ&gt; &#123;<span class="comment">// MsgSender; the same as the</span></span><br><span class="line"><span class="keyword">public</span>:<span class="comment">// general template, except </span></span><br><span class="line">    ...<span class="comment">// sendClear is omitted</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendSecret</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span></span>&#123;</span><br><span class="line">        ... </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šç”¨çš„MsgSenderæ¨¡æ¿æ˜¯ä¸é€‚ç”¨äºCompanyZçš„ï¼Œå› ä¸ºæ¨¡æ¿æä¾›çš„sendClearå‡½æ•°æ˜¯å¯¹CompanyZæ²¡æœ‰æ„ä¹‰çš„ã€‚å› æ­¤åœ¨ä»ç„¶ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œåœ¨Companyä¸­æ‰¾ä¸åˆ°sendClearçš„å£°æ˜(å› ä¸ºCompanyZçš„ç‰¹ä¾‹åŒ–æ²¡æœ‰å®šä¹‰sendClearå‡½æ•°)</p>
<h3 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h3><blockquote>
<p>æ–¹æ¡ˆä¸€:åœ¨base classå‡½æ•°è°ƒç”¨åŠ¨ä½œä¹‹å‰åŠ ä¸Šthis-&gt;</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Company&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingMsgSender</span>: <span class="keyword">public</span> MsgSender&lt;Company&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendClearMsg</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span></span>&#123;</span><br><span class="line">        write <span class="string">&quot;before sending&quot;</span> info to the log;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">sendClear</span>(info);<span class="comment">// okay, assumes that// sendClear will be inherited</span></span><br><span class="line">        write <span class="string">&quot;after sending&quot;</span> info to the log;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨usingå£°æ˜</p>
</blockquote>
<p>åœ¨æ¡æ¬¾33ä¸­æ‰¾ä¸åˆ°åŸºç±»é‡è½½ç»§æ‰¿ä¸‹æ¥çš„éšè—çš„å‡½æ•°ï¼Œæ˜¯å› ä¸ºè¢«æ´¾ç”Ÿç±»æ‰€éšè—</p>
<p>åœ¨æœ¬ä¾‹ä¸­æ˜¯ç¼–è¯‘å™¨ä¸æœç´¢åŸºç±»ä½œç”¨åŸŸ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Company&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingMsgSender</span>: <span class="keyword">public</span> MsgSender&lt;Company&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> MsgSender&lt;Company&gt;::sendClear;<span class="comment">// tell compilers to assume</span></span><br><span class="line">    ...<span class="comment">// that sendClear is in the// base class</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendClearMsg</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="built_in">sendClear</span>(info);<span class="comment">// okay, assumes that</span></span><br><span class="line">            ...<span class="comment">// sendClear will be inherited</span></span><br><span class="line">     &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–¹æ¡ˆä¸‰ï¼šæ˜¾å¼çš„æŒ‡å®šä½ çš„å‡½æ•°ä½äºbase classä¸­</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Company&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingMsgSender</span>: <span class="keyword">public</span> MsgSender&lt;Company&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendClearMsg</span><span class="params">(<span class="type">const</span> MsgInfo&amp; info)</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        MsgSender&lt;Company&gt;::<span class="built_in">sendClear</span>(info);<span class="comment">// okay, assumes that</span></span><br><span class="line">        ...<span class="comment">// sendClear will be </span></span><br><span class="line">    &#125;<span class="comment">// inherited</span></span><br><span class="line">    ...</span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªä¸å¤ªå¥½çš„æ–¹æ³•ï¼Œå› ä¸ºè¢«è°ƒç”¨çš„æ˜¯virtualå‡½æ•°ä¼šå¯¼è‡´virtualå‡½æ•°çš„ç»‘å®šè¡Œä¸ºè¢«å…³é—­</p>
<h3 id="æ€»ç»“-21"><a href="#æ€»ç»“-21" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦In  derived  class  templates,  refer  to  names  in  base  class  templatesvia  a  â€œthis-&gt;â€  prefix,  via using  declarations,  or  via  an  explicit  base class qualification.</p>
<hr>
<h2 id="æ¡æ¬¾44ï¼šå°†äºå‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates"><a href="#æ¡æ¬¾44ï¼šå°†äºå‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates" class="headerlink" title="æ¡æ¬¾44ï¼šå°†äºå‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates"></a>æ¡æ¬¾44ï¼šå°†äºå‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates</h2><p>Factor parameter -independent code out of templates</p>
<blockquote>
<p>ä¸æ°å½“çš„ä½¿ç”¨templateå¯èƒ½ä¼šå¯¼è‡´ä»£ç è†¨èƒ€(code bloat):å…¶äºŒè¿›åˆ¶å¸¦ç€é‡å¤çš„ä»£ç ã€æ•°æ®</p>
</blockquote>
<p>è§£å†³æ–¹æ³•ï¼šå½“ä¸¤ä¸ªå‡½æ•°å®ç°çš„å®è´¨ç›¸åŒ</p>
<p>æŠ½ç¦»ä¸¤ä¸ªå‡½æ•°ä¸­å…±åŒçš„éƒ¨åˆ†ï¼Œå°†ä»–æ”¾å…¥ç¬¬ä¸‰ä¸ªå‡½æ•°ä¸­ï¼Œç„¶åå°†ä»–ä»¬è°ƒç”¨è¿™ä¸ªæ–°å‡½æ•°ã€‚classä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œä½¿ç”¨ç»§æ‰¿æˆ–åˆ™å¤åˆ</p>
<h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ç”¨å›ºå®šå°ºå¯¸çš„æ–¹é˜µç¼–å†™ä¸€ä¸ªtemplateã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="comment">// template for n x n matrices of</span></span><br><span class="line">            std::<span class="type">size_t</span> n&gt;<span class="comment">// objects of type T; see below for info</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquareMatrix</span> &#123;<span class="comment">// on the size_t parameter</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">invert</span><span class="params">( )</span></span>;<span class="comment">// invert the matrix in place</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çš„ç±»å‹ä¸ºsize_tçš„å‚æ•°æ˜¯ä¸€ä¸ªéç±»å‹å‚æ•°(non-type parameter)ã€‚</p>
<p>å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œè°ƒç”¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SquareMatrix&lt;<span class="type">double</span>, <span class="number">5</span>&gt; sm1;</span><br><span class="line">...</span><br><span class="line">sm1.<span class="built_in">invert</span>();<span class="comment">// call SquareMatrix&lt;double, 5&gt;::invert</span></span><br><span class="line">SquareMatrix&lt;<span class="type">double</span>, <span class="number">10</span>&gt; sm2;</span><br><span class="line">...</span><br><span class="line">sm2.<span class="built_in">invert</span>();<span class="comment">// call SquareMatrix&lt;double, 10&gt;::invert</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆ†æ</p>
</blockquote>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå°†ä¼šå…·ç°åŒ–ä¸¤ä»½invertå‡½æ•°ï¼Œä½†è¿™ä¸¤ä»½å‡½æ•°æ˜¯å®Œå…¨ç›¸åŒï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªæ“ä½œçš„5<em>5çŸ©é˜µè€Œå¦ä¸€ä¸ªæ˜¯10 </em>10çš„çŸ©é˜µï¼Œé™¤äº†å¸¸é‡5å’Œ10å…¶ä»–éƒ¨åˆ†å®Œå…¨ç›¸åŒï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå…¸å‹çš„ä»£ç è†¨èƒ€ç¤ºä¾‹</p>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆä¸€</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="comment">// size-independent base class for</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquareMatrixBase</span> &#123;<span class="comment">// square matrices</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">invert</span><span class="params">(std::<span class="type">size_t</span> matrixSize)</span></span>;<span class="comment">// invert matrix of the given size</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, std::<span class="type">size_t</span> n&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquareMatrix</span>: <span class="keyword">private</span> SquareMatrixBase&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">using</span> SquareMatrixBase&lt;T&gt;::invert;<span class="comment">// make base class version of invert</span></span><br><span class="line">                                    <span class="comment">// visible in this class; see Items 33</span></span><br><span class="line">                                    <span class="comment">// and 43</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">invert</span><span class="params">( )</span> </span>&#123;<span class="built_in">invert</span>(n); &#125;<span class="comment">// make inline call to base class</span></span><br><span class="line">&#125;;<span class="comment">// version of invert</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°è§£å†³æ–¹æ¡ˆä¸­</p>
<p>åœ¨æ‰€æœ‰æ–¹é˜µå®ä½“ä¸­åªä¼šå…±äº«ä¸€ä¸ªçˆ¶ç±»çš„invertå®ç°ï¼Œè¿™æ ·å°±æœ‰æ•ˆçš„é˜²æ­¢çš„ä»£ç è†¨èƒ€</p>
<ul>
<li>é¿å…derived classä»£ç é‡å¤ï¼šçˆ¶ç±»ä½¿ç”¨äº†protectä»£æ›¿äº†publicã€‚æ³¨<code>åœ¨è°ƒç”¨æ—¶ä¼šå¦‚æœæ—¶public(å®ä½“å¯¹è±¡ä»ç„¶å¯ä»¥è°ƒç”¨è¯¥æ¥å£)çš„è¯ä¹ŸåŒæ ·ä¼šäº§ç”Ÿä¸åŒç‰ˆæœ¬çš„ä»£ç </code></li>
<li>è°ƒç”¨å…¶ä»£ç çš„æˆæœ¬ä¸º0ï¼Œå› ä¸ºderived classesçš„invertsè°ƒç”¨base clasçš„ç‰ˆæœ¬æ˜¯inlineè°ƒç”¨</li>
<li>this-&gt;è°ƒç”¨è¡¨ç¤ºæ¨¡æ¿åŒ–åŸºç±»åä¹‹å‡½æ•°åç§°è¢«éšç›–</li>
<li>ä½¿ç”¨privateçš„ç»§æ‰¿å…³ç³»è¡¨ç°çš„æ˜¯ä¸€ç§is-aå…³ç³»</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼šåœ¨è¯¥æ–¹æ¡ˆä¸­æ²¡æœ‰è§£å†³çˆ¶ç±»ä¸å­ç±»ä¹‹é—´è”ç³»çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨å­ç±»ä¸­éœ€è¦å¸¦å…¥çŸ©é˜µçš„ç›¸å…³æ•°æ®ï¼Œå› æ­¤éœ€è¦åŠ å…¥ä¸€ä¸ªæŒ‡é’ˆæˆ–è€…å¼•ç”¨ã€‚ä½†æ˜¯åå¤çš„ä¼ å‚ï¼Œè¿™æ ·ä¹Ÿä¼šå½±å“æ•ˆç‡</p>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆäºŒï¼šçˆ¶ç±»ä¸­å­˜å‚¨ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ‰€åœ¨çš„å†…å­˜</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquareMatrixBase</span> &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">SquareMatrixBase</span>(std::<span class="type">size_t</span> n, T *pMem)<span class="comment">// store matrix size and a</span></span><br><span class="line">        : <span class="built_in">size</span>(n), <span class="built_in">pData</span>(pMem) &#123; &#125;<span class="comment">// ptr to matrix values</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setDataPtr</span><span class="params">( T *ptr)</span> </span>&#123; pData = ptr; &#125;<span class="comment">// reassign pData</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::<span class="type">size_t</span> size;<span class="comment">// size of matrix</span></span><br><span class="line">    T *pData;<span class="comment">// pointer to matrix values</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, std::<span class="type">size_t</span> n&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquareMatrix</span>: <span class="keyword">private</span> SquareMatrixBase&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span>:<span class="built_in">SquareMatrix</span>( )<span class="comment">// send matrix size and </span></span><br><span class="line">        : <span class="built_in">SquareMatrixBase</span>&lt;T&gt;(n, data) &#123; &#125;<span class="comment">// data ptr to base class</span></span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T data[n*n];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•åœ¨å­ç±»ä¸­è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç”¨æ¥åˆå§‹çˆ¶ç±»ä¸­çš„æ•°æ®æˆå‘˜</p>
<p>å½“æ•°æ®æˆå‘˜ç‰¹åˆ«å¤§çš„æ—¶å€™å¯ä»¥ä½¿ç”¨<strong>åŠ¨æ€å†…å­˜åˆ†é…</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, std::<span class="type">size_t</span> n&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquareMatrix</span>: <span class="keyword">private</span> SquareMatrixBase&lt;T&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SquareMatrix</span>( )<span class="comment">// set base class data ptr to null,</span></span><br><span class="line">        :   <span class="built_in">SquareMatrixBase</span>&lt;T&gt;(n, <span class="number">0</span>),<span class="comment">// allocate memory for matrixpData(new T[n*n])</span></span><br><span class="line">                                        <span class="comment">// values, save a ptr to the</span></span><br><span class="line">    &#123; <span class="keyword">this</span>-&gt;<span class="built_in">setDataPtr</span>(pData.<span class="built_in">get</span>( )); &#125;<span class="comment">// memory, and give a copy of it</span></span><br><span class="line">    ...<span class="comment">// to the base classprivate:boost::scoped_array&lt;T&gt; pData;</span></span><br><span class="line">        <span class="comment">// see Item13 for info on</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-22"><a href="#æ€»ç»“-22" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦Templates generate multiple classes and multiple functions, so anytemplate code not dependent on a template parameter causes bloat.</p>
<p>âœ¦Bloat due to non-type template parameters can often be eliminatedby replacing template parameters with function parameters or classdata members.</p>
<p>âœ¦Bloat due to type parameters can be reduced by sharing implemen-tations for instantiation types with identical binary representations.</p>
<hr>
<h2 id="æ¡æ¬¾45ï¼šä½¿ç”¨æˆå‘˜å‡½æ•°templateæ¥å—æ‰€æœ‰å¯ä»¥å…¼å®¹çš„ç±»å‹"><a href="#æ¡æ¬¾45ï¼šä½¿ç”¨æˆå‘˜å‡½æ•°templateæ¥å—æ‰€æœ‰å¯ä»¥å…¼å®¹çš„ç±»å‹" class="headerlink" title="æ¡æ¬¾45ï¼šä½¿ç”¨æˆå‘˜å‡½æ•°templateæ¥å—æ‰€æœ‰å¯ä»¥å…¼å®¹çš„ç±»å‹"></a>æ¡æ¬¾45ï¼šä½¿ç”¨æˆå‘˜å‡½æ•°templateæ¥å—æ‰€æœ‰å¯ä»¥å…¼å®¹çš„ç±»å‹</h2><p><code>Use member function template to accept â€œall compatible typeâ€</code></p>
<h3 id="æ™ºèƒ½æŒ‡é’ˆ"><a href="#æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆ"></a>æ™ºèƒ½æŒ‡é’ˆ</h3><p>è¡Œä¸ºåƒæŒ‡é’ˆçš„å¯¹è±¡ï¼Œå¹¶æä¾›æŒ‡é’ˆæ²¡æœ‰çš„æŠ€èƒ½ã€‚STLå®¹å™¨å‡ ä¹éƒ½æ˜¯ç”¨åˆ°æ™ºèƒ½æŒ‡é’ˆï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ä¼šä½¿ç”¨â€œ++â€çš„è¿ç®—ç¬¦å°†ä¸€ä¸ªå†…ç½®çš„æŒ‡é’ˆä»link listçš„èŠ‚ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°è¿­ä»£å™¨</p>
<h3 id="çœŸå®æŒ‡é’ˆ-raw-pointer"><a href="#çœŸå®æŒ‡é’ˆ-raw-pointer" class="headerlink" title="çœŸå®æŒ‡é’ˆ(raw pointer)"></a>çœŸå®æŒ‡é’ˆ(raw pointer)</h3><p>æ”¯æŒéšå¼è½¬æ¢ã€‚ä¾‹å¦‚ï¼šDerived class æŒ‡é’ˆå¯ä»¥éšå¼çš„è½¬æ¢ä¸ºbase classæŒ‡é’ˆ(æä¾›å¤šæ€çš„é€‰æ‹©)ï¼Œâ€œæŒ‡å‘non-constå¯¹è±¡â€çš„æŒ‡é’ˆå¯ä»¥è½¬ä¸ºâ€constå¯¹è±¡â€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Top</span> &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Middle</span>: <span class="keyword">public</span> Top &#123; ... &#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bottom</span>: <span class="keyword">public</span> Middle &#123; ... &#125;;</span><br><span class="line">Top *pt1 = <span class="keyword">new</span> Middle;<span class="comment">// convert Middle*â‡’  Top*</span></span><br><span class="line">Top *pt2 = <span class="keyword">new</span> Bottom;<span class="comment">// convert Bottom*â‡’  Top*</span></span><br><span class="line"><span class="type">const</span> Top *pct2 = pt1;<span class="comment">// convert Top*â‡’  const Top*</span></span><br></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆ"><a href="#è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆ" class="headerlink" title="è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆ"></a>è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartPtr</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:<span class="comment">// smart pointers are typically</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">SmartPtr</span><span class="params">( T *realPtr)</span></span>;<span class="comment">// initialized by built-in pointers </span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line">SmartPtr&lt;Top&gt; pt1 =<span class="comment">// convert SmartPtr&lt;Middle&gt; â‡’</span></span><br><span class="line">            <span class="built_in">SmartPtr</span>&lt;Middle&gt;(<span class="keyword">new</span> Middle);<span class="comment">//     SmartPtr&lt;Top&gt;</span></span><br><span class="line">SmartPtr&lt;Top&gt; pt2 =<span class="comment">// convert SmartPtr&lt;Bottom&gt; â‡’</span></span><br><span class="line">            <span class="built_in">SmartPtr</span>&lt;Bottom&gt;(<span class="keyword">new</span> Bottom);<span class="comment">//     SmartPtr&lt;Top&gt;</span></span><br><span class="line">SmartPtr&lt;<span class="type">const</span> Top&gt; pct2 = pt1;<span class="comment">// convert SmartPtr&lt;Top&gt; â‡’</span></span><br><span class="line">                            <span class="comment">//SmartPtr&lt;const Top&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°åŒä¸€ä¸ªtemplateçš„ä¸åŒå…·ç°ä½“(instantiation)ä¹‹é—´ä¸å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥SmartPtr&lt; Top &gt;ä¸SmartPtr&lt; Middle &gt;æ˜¯å®Œå…¨ä¸åŒçš„class</p>
<h3 id="Templateså’Œæ³›å‹ç¼–ç¨‹-Generic-Programming"><a href="#Templateså’Œæ³›å‹ç¼–ç¨‹-Generic-Programming" class="headerlink" title="Templateså’Œæ³›å‹ç¼–ç¨‹(Generic Programming)"></a>Templateså’Œæ³›å‹ç¼–ç¨‹(Generic Programming)</h3><blockquote>
<p>ç”Ÿäº§éœ€æ±‚:è‡ªå®šä¹‰æŒ‡é’ˆæ„é€ å‡½æ•°çš„ç¼–å†™</p>
</blockquote>
<p>å½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°ç»§æ‰¿å…³ç³»çš„å¯¹è±¡æ—¶ï¼Œé‚£æ²¡æœ‰æ·»åŠ è½¬å‹çš„æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šåå¤çš„åœ¨SmartPträ¸­æ·»åŠ æ„é€ å‡½æ•°</p>
<p><code>class BelowBottom: public Bottom &#123; ... &#125;;</code></p>
<blockquote>
<p>member function tempaltesâ€”â€”æ³›åŒ–copyæ„é€ å‡½æ•°</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartPtr</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;<span class="comment">// member template </span></span><br><span class="line">    <span class="built_in">SmartPtr</span>(<span class="type">const</span> SmartPtr&lt;U&gt;&amp; other);<span class="comment">// for a â€generalized</span></span><br><span class="line">    ...<span class="comment">// copy constructorâ€</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­å¯¹äºä»»æ„ç±»å‹Tä¸ä»»æ„ç±»å‹Uï¼Œå¯ä»¥æ ¹æ®SmartPtr&lt; U &gt;ç”Ÿæˆä¸€ä¸ªSmartPtr&lt; T &gt;â€”â€”å› ä¸ºSmartPtr&lt; T &gt;æœ‰ä¸ªæ„é€ å‡½æ•°æ¥å—æœ‰ä¸ªSmartPtr&lt; U &gt;å‚æ•°ã€‚</p>
<p>æ³›åŒ–çš„copyæ„é€ å‡½æ•°å¹¶æœªè¢«å£°æ˜ä¸ºexplicitï¼Œå› ä¸ºåŸå§‹æŒ‡é’ˆä¹‹é—´(base classä¸derived classä¹‹é—´)çš„è½¬æ¢æ˜¯éšå¼çš„è½¬æ¢ï¼Œæ— éœ€æ˜ç™½çš„å†™å‡ºè½¬å‹åŠ¨ä½œ(cast)</p>
<blockquote>
<p>æä¾›åŸå§‹èµ„æºçš„æˆå‘˜å‡½æ•°</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmartPtr</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> U&gt;</span></span><br><span class="line"><span class="function">    <span class="title">SmartPtr</span><span class="params">(<span class="type">const</span> SmartPtr&lt;U&gt;&amp; other)</span><span class="comment">// initialize this held ptr: </span></span></span><br><span class="line"><span class="function">    <span class="title">heldPtr</span><span class="params">(other.get( ))</span> </span>&#123; ... &#125;<span class="comment">// with otherâ€™s held ptr</span></span><br><span class="line">    <span class="function">T* <span class="title">get</span><span class="params">( )</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> heldPtr; &#125;</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">private</span>:<span class="comment">// built-in pointer held</span></span><br><span class="line">    T*heldPtr;<span class="comment">// by the SmartPtr</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–SmartPtr&lt; T &gt;ä¹‹å†…ç±»å‹ä¸ºT<em>çš„æˆå‘˜å˜é‡ï¼Œå¹¶ä»¥ç±»å‹ä¸ºU</em>çš„æŒ‡é’ˆä½œä¸ºåˆå€¼ã€‚</p>
<p><code>member initialization templates</code>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨çš„ä½œç”¨ä¸é™äºæ„é€ å‡½æ•°ï¼Œå¦ä¸€ä¸ªä½œç”¨æ˜¯æ”¯æŒèµ‹å€¼æ“ä½œ</p>
<blockquote>
<p>æ‘˜å½•</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt; </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">shared_ptr</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">Y</span>&gt;<span class="comment">// construct from</span></span><br><span class="line">        <span class="function"><span class="keyword">explicit</span> <span class="title">shared_ptr</span><span class="params">(Y * p)</span></span>;<span class="comment">// any compatible</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">Y</span>&gt; <span class="comment">// built-in pointer,</span></span><br><span class="line">           <span class="built_in">shared_ptr</span>(shared_ptr&lt;Y&gt; <span class="type">const</span>&amp; r);<span class="comment">// shared_ptr,</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">Y</span>&gt;<span class="comment">// weak_ptr, or</span></span><br><span class="line">        <span class="function"><span class="keyword">explicit</span> <span class="title">shared_ptr</span><span class="params">(weak_ptr&lt;Y&gt; <span class="type">const</span>&amp; r)</span></span>;<span class="comment">// auto_ptr</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Y&gt;</span></span><br><span class="line"><span class="function">        <span class="keyword">explicit</span> <span class="title">shared_ptr</span><span class="params">(auto_ptr&lt;Y&gt;&amp; r)</span></span>;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">Y</span>&gt;<span class="comment">// assign from</span></span><br><span class="line">        shared_ptr&amp; <span class="keyword">operator</span>=(shared_ptr&lt;Y&gt; <span class="type">const</span>&amp; r);<span class="comment">// any compatible</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">Y</span>&gt;<span class="comment">// shared_ptr or</span></span><br><span class="line">        shared_ptr&amp; <span class="keyword">operator</span>=(auto_ptr&lt;Y&gt;&amp; r);<span class="comment">// auto_ptr...&#125;;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æ‰€æœ‰æ„é€ å‡½æ•°éƒ½æ˜¯explicitï¼Œå”¯æœ‰â€æ³›åŒ–copyæ„é€ å‡½æ•°â€é™¤å¤–ï¼Œé‚£ä¹ˆä»<strong>æŸä¸ªshared_ptrç±»å‹éšå¼è½¬ä¸ºå¦ä¸€ä¸ªshared_ptr</strong>æ˜¯å…è®¸çš„ï¼Œä½†æ˜¯ä»æŸä¸ªå†…ç½®æŒ‡é’ˆæˆ–ä»å…¶ä»–æ™ºèƒ½æŒ‡é’ˆè¿›è¡Œéšå¼è½¬æ¢åˆ™æ˜¯ä¸å…è®¸çš„(æ˜¾ç¤ºçš„è½¬æ¢å€’æ˜¯å¯ä»¥)ã€‚</p>
<h3 id="æ€»ç»“ï¼š-12"><a href="#æ€»ç»“ï¼š-12" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p>âœ¦Use member function templates to generate functions that accept allcompatible types.</p>
<p>âœ¦If  you  declare  member  templates  for  generalized  copy  constructionor  generalized  assignment,  youâ€™ll  still  need  to  declare  the  normalcopy constructor and copy assignment operator, too</p>
<hr>
<h2 id="æ¡æ¬¾46ï¼šéœ€è¦ç±»å‹è½¬æ¢æ˜¯è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°"><a href="#æ¡æ¬¾46ï¼šéœ€è¦ç±»å‹è½¬æ¢æ˜¯è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°" class="headerlink" title="æ¡æ¬¾46ï¼šéœ€è¦ç±»å‹è½¬æ¢æ˜¯è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°"></a>æ¡æ¬¾46ï¼šéœ€è¦ç±»å‹è½¬æ¢æ˜¯è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°</h2><p><code>Define non-member function inside templates when type conversion are desired</code></p>
<p>è¿™ä¸ªæ¡æ¬¾æ¢ä¸ªè¯´æ³•æ˜¯ï¼š<strong>å½“æˆ‘ä»¬éœ€è¦è¿›è¡Œæ¨¡æ¿å‡½æ•°å‚æ•°ç±»å‹éœ€è¦éšå¼è½¬æ¢æ—¶ï¼Œå°†æ¨¡æ¿å‡½æ•°å®šä¹‰ä¸ºfriendå‡½æ•°</strong></p>
<h3 id="ç¤ºä¾‹ï¼šæ¡æ¬¾24çš„ä¾‹å­è½¬ä¸ºæ¨¡æ¿"><a href="#ç¤ºä¾‹ï¼šæ¡æ¬¾24çš„ä¾‹å­è½¬ä¸ºæ¨¡æ¿" class="headerlink" title="ç¤ºä¾‹ï¼šæ¡æ¬¾24çš„ä¾‹å­è½¬ä¸ºæ¨¡æ¿"></a>ç¤ºä¾‹ï¼šæ¡æ¬¾24çš„ä¾‹å­è½¬ä¸ºæ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">const</span> T&amp; numerator = <span class="number">0</span>,<span class="comment">// see Item20 for why params</span></span><br><span class="line">             <span class="type">const</span> T&amp; denominator = <span class="number">1</span>);<span class="comment">// are now passed by referenceconst </span></span><br><span class="line">    <span class="function">T <span class="title">numerator</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// see Item28 for why returnconst </span></span><br><span class="line">    <span class="function">T <span class="title">denominator</span><span class="params">( )</span> <span class="type">const</span></span>;<span class="comment">// values are still passed by value,</span></span><br><span class="line">    ...<span class="comment">// Item3 for why theyâ€™re const</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">const</span> Rational&lt;T&gt; <span class="keyword">operator</span>*(<span class="type">const</span> Rational&lt;T&gt;&amp; lhs,</span><br><span class="line">                            <span class="type">const</span> Rational&lt;T&gt;&amp; rhs)</span><br><span class="line">&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>è¿›è¡Œä»¥ä¸‹æ··åˆå¼(mixed-mode)è¿ç®—</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Rational&lt;<span class="type">int</span>&gt; <span class="title">oneHalf</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;<span class="comment">// this example is from Item24,</span></span><br><span class="line">                            <span class="comment">// except Rational is now a template</span></span><br><span class="line">Rational&lt;<span class="type">int</span>&gt; result = oneHalf * <span class="number">2</span>;<span class="comment">// error! wonâ€™t compile</span></span><br></pre></td></tr></table></figure>
<p>å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\lyj\Desktop\C and C++\å­¦ä¹ ç¬”è®°\C++11\img\2022-06-03-17-34-47-image.png" alt=""></p>
<blockquote>
<p>åˆ†æ</p>
</blockquote>
<p>ä»¥ä¸Šé—®é¢˜æ˜¯å› ä¸ºæ²¡æœ‰æ‰¾å¯¹åº”çš„operator * æ“ä½œç¬¦å¯¹åº”çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ¨å¯¼å¤±è´¥ã€‚</p>
<p>ä»¥ä¸Šä»£ç ä¸­operator*è¿™ä¸ªnon-memberå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°è¿›è¡Œéšå¼ç±»å‹æ¨å¯¼æ—¶å‡ºç°äº†é—®é¢˜:</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå®å‚æ˜¯onehalfï¼Œæ‰€ä»¥Tä¸€å®šæ˜¯intï¼Œèƒ½å¤Ÿé¡ºåˆ©çš„æ¨å¯¼å‡º</li>
<li>ç¬¬äºŒä¸ªå®å‚æ˜¯2ï¼Œç¼–è¯‘å™¨æ— æ³•å°†å…¶æ¨å¯¼ä¸ºRational&lt; int &gt;</li>
</ul>
<p>ç»è¿‡ä»¥ä¸Šè€ƒè™‘ï¼Œå› è¯¥æ˜¯å°†éšå¼è½¬æ¢ç±»å‹è½¬æ¢å‡½æ•°å‡ºç°è°ƒç”¨å¤±è´¥çš„é—®é¢˜,æ— æ³•å°†non-memberå‡½æ•°æŒ‡å®šä¸ºoperator*</p>
<h3 id="friendå‡½æ•°å£°æ˜"><a href="#friendå‡½æ•°å£°æ˜" class="headerlink" title="friendå‡½æ•°å£°æ˜"></a>friendå‡½æ•°å£°æ˜</h3><p>template classä¸­friendå£°æ˜å¼å¯ä»¥æŒ‡å®šç‰¹å®šçš„å‡½æ•°ï¼ŒRational&lt; T &gt;å¯ä»¥å£°æ˜operator<em>æ˜¯<em>*classçš„ä¸€ä¸ªfriendå‡½æ•°</em></em></p>
<p>class templateå¹¶ä¸ä¾èµ–templateçš„<strong>å®å‚æ¨å¯¼</strong>ï¼Œæ‰€ä»¥èƒ½å¤Ÿåœ¨class Rational&lt; T &gt;å…·ç°åŒ–æ—¶å¾—çŸ¥T,<strong>æ¢å¥è¯è¯´å°±æ˜¯Tçš„ç±»å‹è¢«ç¡®å®šåï¼Œå°±å·²ç»æŒ‡å®šè°ƒç”¨operator*å‡½æ•°</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="keyword">class</span> <span class="title class_">Rational</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(<span class="type">const</span> T&amp; numerator = <span class="number">0</span>,<span class="comment">// see Item20 for why params</span></span><br><span class="line">             <span class="type">const</span> T&amp; denominator = <span class="number">1</span>);<span class="comment">// are now passed by referenceconst </span></span><br><span class="line">    ...<span class="comment">// Item3 for why theyâ€™re const</span></span><br><span class="line">    <span class="keyword">friend</span><span class="comment">// declare operator*</span></span><br><span class="line">    <span class="type">const</span> Rational <span class="keyword">operator</span>*(<span class="type">const</span> Rational&amp; lhs,<span class="comment">// function (see </span></span><br><span class="line">                             <span class="type">const</span> Rational&amp; rhs);<span class="comment">// below for details)</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">const</span> Rational&lt;T&gt; <span class="keyword">operator</span>*(<span class="type">const</span> Rational&lt;T&gt;&amp; lhs,</span><br><span class="line">                            <span class="type">const</span> Rational&lt;T&gt;&amp; rhs)</span><br><span class="line">&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æ··åˆå¼è°ƒç”¨å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œå½“å¯¹è±¡onehalfè¢«å£°æ˜ä¸ºä¸€ä¸ªRational&lt; int &gt;ï¼Œclass Rational&lt; int &gt;è¢«å…·ç°åŒ–å‡ºæ¥äº†ã€‚è€Œä½œä¸ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œfriendå‡½æ•°operator<em>(æ¥å—Rational&lt; int &gt; å‚æ•°)ä¹Ÿå°±è¢«<strong>è‡ªåŠ¨å£°æ˜å‡ºæ¥</strong>ã€‚åè€…èº«ä¸º<em>*ä¸€ä¸ªå‡½è€Œéå‡½æ•°æ¨¡æ¿</em></em>ï¼Œå› æ­¤ç¼–è¯‘å™¨å¯ä»¥è°ƒç”¨å®ƒæ—¶ä½¿ç”¨éšå¼è½¬æ¢å‡½æ•°ã€‚</p>
<p>ä¸Šè¿°friendå‡½æ•°åŒæ ·å¯ä»¥å£°æ˜ä¸º</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">friend</span></span><br><span class="line"><span class="type">const</span> Rational&lt;T&gt; <span class="keyword">operator</span>*(<span class="type">const</span> Rational&lt;T&gt;&amp; lhs,<span class="type">const</span> Rational&lt;T&gt;&amp; rhs);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é“¾æ¥é”™è¯¯</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:\Users\lyj\Desktop\C and C++\å­¦ä¹ ç¬”è®°\C++11\img\image-20220603221112025.png" alt="image-20220603221112025"></p>
<p>è™½ç„¶ç»è¿‡ä¿®æ”¹æˆ‘ä»¬èƒ½è¿‡é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯åœ¨é“¾æ¥æ—¶ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜äº†ï¼Œå› ä¸ºfriendå‡½æ•°åªæœ‰ä¸€ä¸ªå£°æ˜å¼å­˜åœ¨ï¼Œå¹¶æ²¡æœ‰è¢«å®šä¹‰ï¼Œå› æ­¤ä¼šå¯¼è‡´è¿æ¥å™¨æ— æ³•æ‰¾åˆ°å¯¹åº”çš„å®ç°</p>
<h3 id="å‡½æ•°æœ¬ä½“ä¸å£°æ˜å¼ç»“åˆ-ç®€å•ç‰ˆ"><a href="#å‡½æ•°æœ¬ä½“ä¸å£°æ˜å¼ç»“åˆ-ç®€å•ç‰ˆ" class="headerlink" title="å‡½æ•°æœ¬ä½“ä¸å£°æ˜å¼ç»“åˆ(ç®€å•ç‰ˆ)"></a>å‡½æ•°æœ¬ä½“ä¸å£°æ˜å¼ç»“åˆ(ç®€å•ç‰ˆ)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">friend</span></span><br><span class="line">    <span class="type">const</span> Rational&lt;T&gt; <span class="keyword">operator</span>*(<span class="type">const</span> Rational&lt;T&gt;&amp; lhs,<span class="type">const</span> Rational&lt;T&gt;&amp; rhs)&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">Rational</span>&lt;T&gt;(lhs.<span class="built_in">numerator</span>()*rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                        lhs.<span class="built_in">denominator</span>()*rhs.<span class="built_in">denominator</span>());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="friendç‰¹æ®Šæ„ä¹‰"><a href="#friendç‰¹æ®Šæ„ä¹‰" class="headerlink" title="friendç‰¹æ®Šæ„ä¹‰"></a>friendç‰¹æ®Šæ„ä¹‰</h3><p> åœ¨æœ¬æ¡æ¬¾ä¸­è™½ç„¶ä½¿ç”¨äº†friendå´å’Œå®ƒçš„<strong>ä¼ ç»Ÿæ„ä¹‰</strong>ä¸åŒ(è®¿é—®non-publicæˆåˆ†)ï¼Œä½†æ˜¯åœ¨æ­¤çš„æ„ä¹‰å´æ˜¯è®©ç±»å‹è½¬æ¢å‘ç”Ÿäºæ‰€æœ‰å®å‚èº«ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>non-memberå‡½æ•°</strong>(æ¡æ¬¾24)ï¼›ä¸ºäº†ä½¿è¿™ä¸ªå‡½æ•°<strong>è‡ªåŠ¨å…·ç°åŒ–</strong>(éšå¼è½¬æ¢æ„é€ å‡½æ•°çš„æŒ‡å®š)ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒ<strong>å£°æ˜åœ¨classå†…éƒ¨</strong>ï¼›è€Œåœ¨classå†…éƒ¨å£°æ˜non-memberå‡½æ•°çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯å°†å…¶å£°æ˜ä¸º<strong>friendå‡½æ•°</strong></p>
<h3 id="non-memberä¸friend-memberåˆä½œ"><a href="#non-memberä¸friend-memberåˆä½œ" class="headerlink" title="non-memberä¸friend memberåˆä½œ"></a>non-memberä¸friend memberåˆä½œ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">const</span> Rational&lt;T&gt; <span class="title">doMultiply</span><span class="params">(<span class="type">const</span> Rational&lt;T&gt;&amp; lhs,<span class="type">const</span> Rational&lt;T&gt;&amp; rhs)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rational</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rational</span>(T numerator = <span class="number">0</span>,</span><br><span class="line">    T denominator = <span class="number">1</span>):<span class="built_in">n</span>(numerator),<span class="built_in">d</span>(denominator)&#123;&#125;;</span><br><span class="line">    <span class="function">T <span class="title">numerator</span><span class="params">( )</span> <span class="type">const</span></span>&#123;<span class="keyword">return</span> n;&#125;</span><br><span class="line">    <span class="function">T <span class="title">denominator</span><span class="params">( )</span> <span class="type">const</span></span>&#123;<span class="keyword">return</span> d;&#125;</span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; out,<span class="type">const</span> Rational&amp; rhs)</span><br><span class="line">    &#123;</span><br><span class="line">        out&lt;&lt; rhs.n/rhs.d;</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span></span><br><span class="line">    <span class="type">const</span> Rational&lt;T&gt; <span class="keyword">operator</span>*(<span class="type">const</span> Rational&lt;T&gt;&amp; lhs,<span class="type">const</span> Rational&lt;T&gt;&amp; rhs)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">doMultiply</span>(lhs,rhs);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T n;</span><br><span class="line">    T d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">const</span> Rational&lt;T&gt; <span class="title">doMultiply</span><span class="params">(<span class="type">const</span> Rational&lt;T&gt;&amp; lhs,<span class="type">const</span> Rational&lt;T&gt;&amp; rhs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Rational</span>&lt;T&gt;(lhs.<span class="built_in">numerator</span>()*rhs.<span class="built_in">numerator</span>(),</span><br><span class="line">                        lhs.<span class="built_in">denominator</span>()*rhs.<span class="built_in">denominator</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-23"><a href="#æ€»ç»“-23" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>âœ¦When  writing  a  class  template  that  offers  functions  related  to  thetemplate  that  support  implicit  type  conversions  on  all  parameters,define those functions as friends inside the class template.</p>
<hr>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Effect C++ç¬”è®°</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://www.ember-l.top/2023/01/20/C++/Effective%20C++/">http://www.ember-l.top/2023/01/20/C++/Effective C++/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>EmberğŸ</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2023-01-20</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2023-01-20</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C++</a><a class="post-meta__tags" href="/tags/Effective-C/">Effective C++</a></div><div class="post_share"><div class="social-share" data-image="https://ember-img.oss-cn-chengdu.aliyuncs.com/img32.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://lib.baomitu.com/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æŠ•å–‚ç¡¬å¸</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/20/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/FaRM%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/202301251417569.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">FaRM</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/20/%E5%8F%AF%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img21.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å¯è°ƒç”¨å¯¹è±¡</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2023/01/20/%E5%8F%AF%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1/" title="å¯è°ƒç”¨å¯¹è±¡"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img21.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-20</div><div class="title">å¯è°ƒç”¨å¯¹è±¡</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="author_top is-center"><div class="card-info-avatar"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/assets/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-status-box"><div class="author-status"><g-emoji class="g-emoji" alias="palm_tree" fallback-src="https://lskypro.acozycotage.net/LightPicture/2022/12/fe1dc0402e623096.jpg">ğŸŸ</g-emoji><span>è®¤çœŸæ‘¸é±¼ä¸­</span></div></div></div><div class="author-info__name">EmberğŸ</div><div class="author-info__description">BugMaker ğŸ’¦ğŸ’¦ğŸ’¦</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ember-l"><i></i><span>Follow meğŸš€</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="/assets/qq.jpg" target="_blank" title="QQ"><svg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-QQ"></use></svg></a><a class="social-icon faa-parent animated-hover" href="/assets/wx.jpg" target="_blank" title="å¾®ä¿¡"><svg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-weixin"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://github.com/ember-l" target="_blank" title="github"><svg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-github1"></use></svg></a><a class="social-icon faa-parent animated-hover" href="mailto:2508856440@qq.com" target="_blank" title="é‚®ç®±"><svg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://www.zhihu.com/people/low-45-75" target="_blank" title="çŸ¥ä¹"><svg class="social_icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shejiaotubiao-10"></use></svg></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><a class="faa-parent animated-hover"><svg class="faa-tada icon" style="height:27px;width:27px;fill:currentColor;position:relative;top:3px" aria-hidden="true"><use xlink:href="#icon-fengche"></use></svg></a><span>å…¬å‘Š</span></div><div class="announcement_content"><center><b>--- ä¸»åŸŸå ---<br><a href="https://www.ember-l.top" title="æ­¤çº¿è·¯éƒ¨ç½²äºVercel" class="anno_content"><font color="#cc7227">ember-l.top</font></a></b></center></div><div id="welcome-info"></div></div><div class="card-widget tzy-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face"></div><div class="back face"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><a class="faa-parent animated-hover"><svg class="faa-tada icon" style="height:27px;width:27px;fill:currentColor;position:relative;top:3px" aria-hidden="true"><use xlink:href="#icon-mulu"></use></svg></a><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Effective-C"><span class="toc-text">Effective C++</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A9%E8%87%AA%E5%B7%B1%E4%B9%A0%E6%83%AFC"><span class="toc-text">è®©è‡ªå·±ä¹ æƒ¯C++</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE01"><span class="toc-text">æ¡æ¬¾01</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE02%EF%BC%9A%E5%B0%BD%E9%87%8F%E4%BB%A5const%EF%BC%8Cenum%EF%BC%8Cinline%E6%9B%BF%E6%8D%A2-define"><span class="toc-text">æ¡æ¬¾02ï¼šå°½é‡ä»¥constï¼Œenumï¼Œinlineæ›¿æ¢#define</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE03%EF%BC%9A%E5%B0%BD%E5%8F%AF%E8%83%BD%E4%BD%BF%E7%94%A8const"><span class="toc-text">æ¡æ¬¾03ï¼šå°½å¯èƒ½ä½¿ç”¨const</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#const%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-text">constæˆå‘˜å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8const%E5%92%8Cnon-const%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E4%B8%AD%E9%81%BF%E5%85%8D%E9%87%8D%E5%A4%8D"><span class="toc-text">åœ¨constå’Œnon-constæˆå‘˜å‡½æ•°ä¸­é¿å…é‡å¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE04%EF%BC%9A%E7%A1%AE%E5%AE%9A%E5%AF%B9%E8%B1%A1%E8%A2%AB%E4%BD%BF%E7%94%A8%E5%89%8D%E5%B7%B2%E7%BB%8F%E5%85%88%E8%A2%AB%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">æ¡æ¬¾04ï¼šç¡®å®šå¯¹è±¡è¢«ä½¿ç”¨å‰å·²ç»å…ˆè¢«åˆå§‹åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E8%B5%8B%E5%80%BC"><span class="toc-text">åˆå§‹åŒ–ä¸èµ‹å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%97%E8%A1%A8"><span class="toc-text">åˆå§‹åŒ–åˆ—è¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E5%91%98%E5%88%9D%E5%A7%8B%E5%8C%96%E6%AC%A1%E5%BA%8F"><span class="toc-text">æˆå‘˜åˆå§‹åŒ–æ¬¡åº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#static%E5%AF%B9%E8%B1%A1"><span class="toc-text">staticå¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%BA%90%E6%96%87%E4%BB%B6%E8%B7%A8%E7%BC%96%E8%AF%91%E5%8D%95%E5%85%83%E7%BC%96%E8%AF%91"><span class="toc-text">å¤šæºæ–‡ä»¶è·¨ç¼–è¯‘å•å…ƒç¼–è¯‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#non-local-static-%E5%AF%B9%E8%B1%A1%E5%88%9D%E5%A7%8B%E5%8C%96%E6%AC%A1%E5%BA%8F%E9%97%AE%E9%A2%98"><span class="toc-text">non-local static å¯¹è±¡åˆå§‹åŒ–æ¬¡åºé—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-1"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E9%80%A0-%E6%9E%90%E6%9E%84-%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97"><span class="toc-text">æ„é€ &#x2F;ææ„&#x2F;èµ‹å€¼è¿ç®—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE05%EF%BC%9A%E4%BA%86%E8%A7%A3C-%E9%BB%98%E8%AE%A4%E7%BC%96%E5%86%99%E5%92%8C%E8%B0%83%E7%94%A8%E4%BA%86%E5%93%AA%E4%BA%9B%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾05ï¼šäº†è§£C++é»˜è®¤ç¼–å†™å’Œè°ƒç”¨äº†å“ªäº›å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-2"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE06%EF%BC%9A%E8%8B%A5%E4%B8%8D%E6%83%B3%E4%BD%BF%E7%94%A8%E7%BC%96%E8%AF%91%E5%99%A8%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E5%B0%B1%E5%9B%A0%E8%AF%A5%E6%98%8E%E7%A1%AE%E7%9A%84%E6%8B%92%E7%BB%9D"><span class="toc-text">æ¡æ¬¾06ï¼šè‹¥ä¸æƒ³ä½¿ç”¨ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°ï¼Œå°±å› è¯¥æ˜ç¡®çš„æ‹’ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-3"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE07%EF%BC%9A%E4%B8%BA%E5%A4%9A%E6%80%81%E5%9F%BA%E7%B1%BB%E5%A3%B0%E6%98%8Evirtual%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾07ï¼šä¸ºå¤šæ€åŸºç±»å£°æ˜virtualææ„å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-4"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE08%EF%BC%9A%E5%88%AB%E8%AE%A9%E5%BC%82%E5%B8%B8%E9%80%83%E7%A6%BB%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾08ï¼šåˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE11%EF%BC%9A%E5%9C%A8operator-%E4%B8%AD%E2%80%9C%E8%87%AA%E6%88%91%E8%B5%8B%E5%80%BC%E2%80%9D"><span class="toc-text">æ¡æ¬¾11ï¼šåœ¨operator&#x3D;ä¸­â€œè‡ªæˆ‘èµ‹å€¼â€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E8%AF%81%E5%90%8C%E6%B5%8B%E8%AF%95"><span class="toc-text">æ–¹æ³•ä¸€ï¼šè¯åŒæµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">æ–¹æ³•äºŒï¼šå¼‚å¸¸å®‰å…¨æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89%EF%BC%9Acopy-swap%EF%BC%88%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E6%80%A7%EF%BC%89%E2%80%94-%E6%9D%A1%E6%AC%BE29"><span class="toc-text">æ–¹æ³•ä¸‰ï¼šcopy-swapï¼ˆå¼‚å¸¸å®‰å…¨æ€§ï¼‰â€”-æ¡æ¬¾29</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86"><span class="toc-text">èµ„æºç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE14%EF%BC%9A%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E5%B0%8F%E5%BF%83copying%E8%A1%8C%E4%B8%BA"><span class="toc-text">æ¡æ¬¾14ï¼šåœ¨èµ„æºç®¡ç†ç±»ä¸­å°å¿ƒcopyingè¡Œä¸º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RAII%E5%AF%B9%E8%B1%A1copied%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-text">RAIIå¯¹è±¡copiedçš„é€‰æ‹©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE15%EF%BC%9A%E5%9C%A8%E8%B5%84%E6%BA%90%E7%B1%BB%E4%B8%AD%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%8E%9F%E5%A7%8B%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="toc-text">æ¡æ¬¾15ï¼šåœ¨èµ„æºç±»ä¸­æä¾›å¯¹åŸå§‹èµ„æºçš„è®¿é—®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%A3%B0%E6%98%8E"><span class="toc-text">è®¾è®¡ä¸å£°æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE20%EF%BC%9A%E5%AE%81%E4%BB%A5pass-by-reference-to-const-%E6%9B%BF%E6%8D%A2pass-by-value"><span class="toc-text">æ¡æ¬¾20ï¼šå®ä»¥pass-by-reference-to-const æ›¿æ¢pass-by-value</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8pass-by-reference-to-const%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-text">ç”¨pass-by-reference-to-constçš„å¥½å¤„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-5"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE21%EF%BC%9A%E5%BF%85%E9%A1%BB%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%97%B6%EF%BC%8C%E5%88%AB%E5%A6%84%E6%83%B3%E8%BF%94%E5%9B%9E%E5%85%B6reference"><span class="toc-text">æ¡æ¬¾21ï¼šå¿…é¡»è¿”å›å¯¹è±¡æ—¶ï¼Œåˆ«å¦„æƒ³è¿”å›å…¶reference</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E4%BB%A5reference%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC%E6%97%B6%E7%9A%84%E5%87%A0%E5%A4%A7%E8%AF%AF%E5%8C%BA"><span class="toc-text">å½“ä»¥referenceä½œä¸ºè¿”å›å€¼æ—¶çš„å‡ å¤§è¯¯åŒº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E5%81%9A%E6%B3%95%EF%BC%9A"><span class="toc-text">æ­£ç¡®åšæ³•ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-5"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE22%EF%BC%9A%E5%B0%86%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E4%B8%BAprivate"><span class="toc-text">æ¡æ¬¾22ï¼šå°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#private%EF%BC%88%E6%8F%90%E4%BE%9B%E5%B0%81%E8%A3%85%EF%BC%89%E5%92%8C%E5%85%B6%E4%BB%96%EF%BC%88%E6%8F%90%E4%BE%9B%E5%B0%81%E8%A3%85%EF%BC%89"><span class="toc-text">privateï¼ˆæä¾›å°è£…ï¼‰å’Œå…¶ä»–ï¼ˆæä¾›å°è£…ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-6"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE23%EF%BC%9A%E5%AE%81%E4%BB%A5non-member%E3%80%81non-friend%E6%9B%BF%E6%8D%A2member%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾23ï¼šå®ä»¥non-memberã€non-friendæ›¿æ¢memberå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="toc-text">é—®é¢˜æè¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E9%97%AE%E9%A2%98"><span class="toc-text">ç¨‹åºè®¾è®¡é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-7"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE24%EF%BC%9A-%E8%8B%A5%E6%89%80%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%86%E9%9C%80%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-%E8%AF%B7%E4%B8%BA%E6%AD%A4%E9%87%87%E7%94%A8non-member%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾24ï¼š è‹¥æ‰€æœ‰å‚æ•°çš†éœ€ç±»å‹è½¬æ¢,è¯·ä¸ºæ­¤é‡‡ç”¨non-memberå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86operator%E5%86%99%E4%B8%BAnon-member%E5%87%BD%E6%95%B0"><span class="toc-text">å°†operatorå†™ä¸ºnon-memberå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-6"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE25%EF%BC%9A%E8%80%83%E8%99%91%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E7%9A%84swap%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾25ï¼šè€ƒè™‘å†™å‡ºä¸€ä¸ªä¸æŠ›å‡ºå¼‚å¸¸çš„swapå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-text">å‰ç½®çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E6%B3%95%E4%BA%A4%E6%8D%A2%E5%80%BC%E3%80%81%E6%97%A0%E6%B3%95%E4%BA%A4%E6%8D%A2%E6%8C%87%E9%92%88"><span class="toc-text">æ— æ³•äº¤æ¢å€¼ã€æ— æ³•äº¤æ¢æŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E6%B3%95%E4%BA%A4%E6%8D%A2%E5%9C%B0%E5%9D%80%E3%80%81%E5%8F%AF%E4%BB%A5%E4%BA%A4%E6%8D%A2%E6%8C%87%E9%92%88"><span class="toc-text">æ— æ³•äº¤æ¢åœ°å€ã€å¯ä»¥äº¤æ¢æŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E4%BA%A4%E6%8D%A2%E5%80%BC%E5%92%8C%E5%9C%B0%E5%9D%80"><span class="toc-text">å¯ä»¥äº¤æ¢å€¼å’Œåœ°å€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">å¼•ç”¨æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%BA%93swap"><span class="toc-text">æ ‡å‡†åº“swap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9Aswap"><span class="toc-text">ç¤ºä¾‹ï¼šswap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%AE%E6%8D%A2%E5%85%B6impl%E6%8C%87%E9%92%88"><span class="toc-text">ç½®æ¢å…¶implæŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8Epublic%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%BD%AE%E6%8D%A2"><span class="toc-text">å£°æ˜publicæˆå‘˜å‡½æ•°ç½®æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%8F%E7%89%B9%E5%8C%96function-template"><span class="toc-text">åç‰¹åŒ–function template</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%81%9A%E6%B3%95"><span class="toc-text">æ ‡å‡†åšæ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-7"><span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-text">å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE26%EF%BC%9A%E5%B0%BD%E9%87%8F%E5%B0%86%E5%8F%98%E9%87%8F%E7%9A%84%E5%A3%B0%E6%98%8E%E7%BD%AE%E5%90%8E"><span class="toc-text">æ¡æ¬¾26ï¼šå°½é‡å°†å˜é‡çš„å£°æ˜ç½®å</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E5%89%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-text">å˜é‡å£°æ˜å‰ç½®ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E7%BD%AE%E5%90%8E"><span class="toc-text">å˜é‡ç½®å</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E"><span class="toc-text">å¾ªç¯ä¸­çš„å˜é‡å£°æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-8"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE27%EF%BC%9A%E5%B0%BD%E9%87%8F%E5%B0%91%E5%81%9A%E8%BD%AC%E5%9E%8B%E6%93%8D%E4%BD%9C"><span class="toc-text">æ¡æ¬¾27ï¼šå°½é‡å°‘åšè½¬å‹æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C%E8%AF%AD%E8%A8%80%E8%BD%AC%E5%9E%8B%E8%AF%AD%E6%B3%95"><span class="toc-text">Cè¯­è¨€è½¬å‹è¯­æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%E6%96%B0%E5%BC%8F%E8%BD%AC%E5%9E%8B-new-style"><span class="toc-text">C++æ–°å¼è½¬å‹(new-style)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BC%8F%E8%BD%AC%E6%8D%A2%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-text">æ–°å¼è½¬æ¢çš„ä¼˜ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A7%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-text">æ—§å¼ç±»å‹è½¬æ¢çš„ä½¿ç”¨åœºæ™¯ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RTII-Run-Time-Type-Identification"><span class="toc-text">RTII(Run Time Type Identification)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%9E%8B%E5%AE%B9%E6%98%93%E5%86%99%E5%87%BA%E4%BC%BC%E6%98%AF%E8%80%8C%E9%9D%9E%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="toc-text">è½¬å‹å®¹æ˜“å†™å‡ºä¼¼æ˜¯è€Œéçš„ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dynamic-cast"><span class="toc-text">dynamic__cast</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">ä½¿ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E9%99%B7"><span class="toc-text">ç¼ºé™·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9A%E6%B3%95%E4%B8%80"><span class="toc-text">åšæ³•ä¸€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9A%E6%B3%95%E4%BA%8C"><span class="toc-text">åšæ³•äºŒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-9"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE28%EF%BC%9A%E9%81%BF%E5%85%8D%E8%BF%94%E5%9B%9Ehandles-reference-pointer-iterators-%E6%8C%87%E5%90%91%E5%AF%B9%E8%B1%A1%E5%86%85%E9%83%A8%E6%88%90%E5%88%86"><span class="toc-text">æ¡æ¬¾28ï¼šé¿å…è¿”å›handles(reference,pointer,iterators)æŒ‡å‘å¯¹è±¡å†…éƒ¨æˆåˆ†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B4%E5%9D%8F%E5%B0%81%E8%A3%85%E6%80%A7"><span class="toc-text">ç ´åå°è£…æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dangling-handles-%E6%89%80%E6%8C%87%E5%AF%B9%E8%B1%A1%E4%B8%8D%E5%AD%98%E5%9C%A8"><span class="toc-text">dangling handles æ‰€æŒ‡å¯¹è±¡ä¸å­˜åœ¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%A4%96%EF%BC%9Aoperator"><span class="toc-text">ä¾‹å¤–ï¼šoperator[]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-8"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE29%EF%BC%9A%E4%B8%BA%E2%80%9D%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E2%80%9C%E8%80%8C%E5%8A%AA%E5%8A%9B%E6%98%AF%E5%80%BC%E5%BE%97%E7%9A%84"><span class="toc-text">æ¡æ¬¾29ï¼šä¸ºâ€å¼‚å¸¸å®‰å…¨â€œè€ŒåŠªåŠ›æ˜¯å€¼å¾—çš„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9D%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E2%80%9C%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-text">â€å¼‚å¸¸å®‰å…¨â€œçš„æ¡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%9D%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E5%87%BD%E6%95%B0%E2%80%9C%E4%BF%9D%E8%AF%81"><span class="toc-text">â€å¼‚å¸¸å®‰å…¨å‡½æ•°â€œä¿è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E5%87%BD%E6%95%B0%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98"><span class="toc-text">å¼‚å¸¸å®‰å…¨å‡½æ•°è§£å†³é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-text">æ™ºèƒ½æŒ‡é’ˆè§£å†³é—®é¢˜ï¼š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Copy-and-Swap"><span class="toc-text">Copy and Swap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-10"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE30%EF%BC%9A%E9%80%8F%E5%BD%BB%E4%BA%86%E8%A7%A3inlining%E7%9A%84%E9%87%8C%E9%87%8C%E5%A4%96%E5%A4%96"><span class="toc-text">æ¡æ¬¾30ï¼šé€å½»äº†è§£inliningçš„é‡Œé‡Œå¤–å¤–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#inline%E7%9A%84%E7%BB%86%E8%8A%82"><span class="toc-text">inlineçš„ç»†èŠ‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inline%E7%9A%84%E5%A3%B0%E6%98%8E"><span class="toc-text">inlineçš„å£°æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-9"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE31%EF%BC%9A%E5%B0%86%E6%96%87%E4%BB%B6%E9%97%B4%E7%9A%84%E7%BC%96%E8%AF%91%E4%BE%9D%E5%AD%98%E5%85%B3%E7%B3%BB%E9%99%8D%E8%87%B3%E6%9C%80%E4%BD%8E"><span class="toc-text">æ¡æ¬¾31ï¼šå°†æ–‡ä»¶é—´çš„ç¼–è¯‘ä¾å­˜å…³ç³»é™è‡³æœ€ä½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#include-lt-string-gt"><span class="toc-text">include &lt; string &gt;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#include-%E2%80%9Cdate-h%E2%80%9D"><span class="toc-text">include â€œdate.hâ€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#include-%E2%80%9Caddress-h%E2%80%9D"><span class="toc-text">include â€œaddress.hâ€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pimpl-idiom-pointer-to-implementation"><span class="toc-text">pimpl idiom(pointer to implementation)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E7%AD%96%E7%95%A5"><span class="toc-text">è®¾è®¡ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Handle-classses"><span class="toc-text">Handle classses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Interface-classes"><span class="toc-text">Interface classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-11"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1"><span class="toc-text">ç»§æ‰¿ä¸é¢å‘å¯¹è±¡è®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE32%EF%BC%9A%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84public%E7%BB%A7%E6%89%BF%E5%A1%91%E9%80%A0%E5%87%BA%E7%9A%84is-a%E5%85%B3%E7%B3%BB"><span class="toc-text">æ¡æ¬¾32ï¼šç¡®å®šä½ çš„publicç»§æ‰¿å¡‘é€ å‡ºçš„is-aå…³ç³»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#is-a%E7%9A%84%E8%AF%AF%E5%8C%BA"><span class="toc-text">is-açš„è¯¯åŒº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80-%E5%8F%8Cclass%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB"><span class="toc-text">æ–¹æ³•ä¸€:åŒclassç»§æ‰¿ä½“ç³»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%9C%9F%E9%94%99%E8%AF%AF"><span class="toc-text">æ–¹æ³•äºŒï¼šè¿è¡ŒæœŸé”™è¯¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-10"><span class="toc-text">æ€»ç»“:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE33%EF%BC%9A%E9%81%BF%E5%85%8D%E9%81%AE%E6%8E%A9%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-text">æ¡æ¬¾33ï¼šé¿å…é®æ©ç»§æ‰¿è€Œæ¥çš„åç§°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E6%9F%A5%E6%89%BE%E8%A7%84%E5%88%99-%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text">å‘½åæŸ¥æ‰¾è§„åˆ™(ä½œç”¨åŸŸ)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E7%A7%B0%E5%8F%AF%E8%A7%86%E6%80%A7-name-visibility"><span class="toc-text">åç§°å¯è§†æ€§(name visibility)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%BB%A7%E6%89%BF%E6%9D%A5%E7%9A%84%E5%90%8D%E7%A7%B0%E7%9A%84%E9%81%AE%E6%8E%A9%E8%A1%8C%E4%B8%BA"><span class="toc-text">è§£å†³ç»§æ‰¿æ¥çš„åç§°çš„é®æ©è¡Œä¸º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#forward-function%E8%BD%AC%E4%BA%A4%E5%87%BD%E6%95%B0"><span class="toc-text">forward functionè½¬äº¤å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-11"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE34%EF%BC%9A%E5%8C%BA%E5%88%86%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF"><span class="toc-text">æ¡æ¬¾34ï¼šåŒºåˆ†æ¥å£ç»§æ‰¿å’Œå®ç°ç»§æ‰¿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%80%BB%E6%98%AF%E4%BC%9A%E8%A2%AB%E7%BB%A7%E6%89%BF"><span class="toc-text">æˆå‘˜å‡½æ•°çš„æ¥å£æ€»æ˜¯ä¼šè¢«ç»§æ‰¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pure-virtual%E5%87%BD%E6%95%B0-%E5%AD%90%E7%B1%BB%E5%BF%85%E9%A1%BB%E9%87%8D%E5%86%99"><span class="toc-text">pure virtualå‡½æ•°(å­ç±»å¿…é¡»é‡å†™)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#impure-virtual%E5%87%BD%E6%95%B0-%E5%8F%AF%E9%80%89%E6%98%AF%E5%90%A6%E9%87%8D%E5%86%99"><span class="toc-text">impure virtualå‡½æ•°(å¯é€‰æ˜¯å¦é‡å†™)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#non-virtual%E5%87%BD%E6%95%B0-%E4%B8%8D%E8%83%BD%E9%87%8D%E5%86%99"><span class="toc-text">non-virtualå‡½æ•°(ä¸èƒ½é‡å†™)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-12"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE35%EF%BC%9A%E8%80%83%E8%99%91virtual%E5%87%BD%E6%95%B0%E4%BB%A5%E5%A4%96%E7%9A%84%E5%85%B6%E4%BB%96%E9%80%89%E6%8B%A9"><span class="toc-text">æ¡æ¬¾35ï¼šè€ƒè™‘virtualå‡½æ•°ä»¥å¤–çš„å…¶ä»–é€‰æ‹©</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Template-Method%E6%A8%A1%E5%BC%8F"><span class="toc-text">Template Methodæ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strategy-Pattern-via-Function-Pointers"><span class="toc-text">Strategy Pattern via Function Pointers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strategy-Pattern-via-tr1-function"><span class="toc-text">Strategy Pattern via tr1::function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-%E2%80%9CClassic%E2%80%9D-Strategy-Pattern"><span class="toc-text">the â€œClassicâ€ Strategy Pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-13"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE36%EF%BC%9A%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84non-virtual%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾36ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„non-virtualå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-14"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE37%EF%BC%9A%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E5%80%BC"><span class="toc-text">æ¡æ¬¾37ï¼šç»ä¸é‡æ–°å®šä¹‰ç»§æ‰¿è€Œæ¥çš„é»˜è®¤å‚æ•°å€¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%BB%91%E5%AE%9A"><span class="toc-text">é™æ€ç»‘å®š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A"><span class="toc-text">åŠ¨æ€ç»‘å®š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NVI%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">NVIè§£å†³æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-15"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE38%EF%BC%9A%E9%80%9A%E8%BF%87%E5%A4%8D%E5%90%88%E5%A1%91%E9%80%A0%E5%87%BAhas-a%E6%88%96%E2%80%9C%E6%A0%B9%E6%8D%AE%E6%9F%90%E7%89%A9%E5%AE%9E%E7%8E%B0%E5%87%BA%E2%80%9D"><span class="toc-text">æ¡æ¬¾38ï¼šé€šè¿‡å¤åˆå¡‘é€ å‡ºhas-aæˆ–â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B%E4%B8%AD%E7%9A%84has-a%E5%92%8C%E2%80%9C%E6%A0%B9%E6%8D%AE%E6%9F%90%E7%89%A9%E5%AE%9E%E7%8E%B0%E5%87%BA%E2%80%9D%E5%8C%BA%E5%88%86"><span class="toc-text">å¤åˆç±»å‹ä¸­çš„has-aå’Œâ€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€åŒºåˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-16"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE39%EF%BC%9A%E8%B0%A8%E6%85%8E%E7%9A%84%E4%BD%BF%E7%94%A8%E2%80%9Cprivate%E2%80%9D%E7%BB%A7%E6%89%BF"><span class="toc-text">æ¡æ¬¾39ï¼šè°¨æ…çš„ä½¿ç”¨â€œprivateâ€ç»§æ‰¿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Private-%E7%BB%A7%E6%89%BF"><span class="toc-text">Private ç»§æ‰¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E4%B8%8Eprivate%E7%BB%A7%E6%89%BF%E7%9A%84%E6%8A%89%E6%8B%A9"><span class="toc-text">å¤åˆä¸privateç»§æ‰¿çš„æŠ‰æ‹©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Private%E7%BB%A7%E6%89%BF"><span class="toc-text">ä½¿ç”¨Privateç»§æ‰¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E5%AE%9E%E7%8E%B0"><span class="toc-text">å¤åˆå®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-17"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE40%EF%BC%9A%E6%98%8E%E6%99%BA%E8%80%8C%E8%B0%A8%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-text">æ¡æ¬¾40ï¼šæ˜æ™ºè€Œè°¨æ…åœ°ä½¿ç”¨å¤šé‡ç»§æ‰¿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-text">å¤šé‡ç»§æ‰¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%B1%E5%BD%A2%E7%BB%A7%E6%89%BF"><span class="toc-text">è±å½¢ç»§æ‰¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%BB%A7%E6%89%BF"><span class="toc-text">è™šæ‹Ÿç»§æ‰¿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%BB%A7%E6%89%BF%E7%9A%84%E6%88%90%E6%9C%AC"><span class="toc-text">è™šæ‹Ÿç»§æ‰¿çš„æˆæœ¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%BB%A7%E6%89%BF%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E8%A7%84%E5%88%99%E6%9B%B4%E5%A4%8D%E6%9D%82"><span class="toc-text">è™šæ‹Ÿç»§æ‰¿çš„åˆå§‹åŒ–è§„åˆ™æ›´å¤æ‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%BB%A7%E6%89%BF%E7%9A%84%E6%8A%89%E6%8B%A9"><span class="toc-text">è™šæ‹Ÿç»§æ‰¿çš„æŠ‰æ‹©</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-18"><span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B"><span class="toc-text">æ¨¡æ¿ä¸æ³›å‹ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE41%EF%BC%9A%E4%BA%86%E8%A7%A3%E9%9A%90%E5%BC%8F%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%9A%E6%80%81"><span class="toc-text">æ¡æ¬¾41ï¼šäº†è§£éšå¼æ¥å£å’Œç¼–è¯‘æœŸå¤šæ€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1"><span class="toc-text">é¢å¯¹å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Template%E4%BB%A5%E5%8F%8A%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B-generic-programming"><span class="toc-text">Templateä»¥åŠæ³›å‹ç¼–ç¨‹( generic programming )</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%9C%9F%E5%A4%9A%E6%80%81%E4%B8%8E%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%9A%E6%80%81"><span class="toc-text">è¿è¡ŒæœŸå¤šæ€ä¸ç¼–è¯‘æœŸå¤šæ€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E6%8E%A5%E5%8F%A3%E4%B8%8E%E6%98%BE%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-text">éšå¼æ¥å£ä¸æ˜¾å¼æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-19"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE42%EF%BC%9A%E4%BA%86%E8%A7%A3typename%E7%9A%84%E5%8F%8C%E9%87%8D%E6%84%8F%E4%B9%89"><span class="toc-text">æ¡æ¬¾42ï¼šäº†è§£typenameçš„åŒé‡æ„ä¹‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#class-and-typename-%E5%A3%B0%E6%98%8E"><span class="toc-text">class and typename å£°æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#typename%E7%9A%84%E5%8F%A6%E4%B8%80%E9%87%8D%E6%84%8F%E4%B9%89"><span class="toc-text">typenameçš„å¦ä¸€é‡æ„ä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-20"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE43-%EF%BC%9A%E5%AD%A6%E4%B9%A0%E5%A4%84%E7%90%86%E6%A8%A1%E6%9D%BF%E5%8C%96%E5%9F%BA%E7%B1%BB%E5%86%85%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-text">æ¡æ¬¾43 ï¼šå­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-text">è§£å†³æ–¹æ¡ˆï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-21"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE44%EF%BC%9A%E5%B0%86%E4%BA%8E%E5%8F%82%E6%95%B0%E6%97%A0%E5%85%B3%E7%9A%84%E4%BB%A3%E7%A0%81%E6%8A%BD%E7%A6%BBtemplates"><span class="toc-text">æ¡æ¬¾44ï¼šå°†äºå‚æ•°æ— å…³çš„ä»£ç æŠ½ç¦»templates</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-22"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE45%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0template%E6%8E%A5%E5%8F%97%E6%89%80%E6%9C%89%E5%8F%AF%E4%BB%A5%E5%85%BC%E5%AE%B9%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">æ¡æ¬¾45ï¼šä½¿ç”¨æˆå‘˜å‡½æ•°templateæ¥å—æ‰€æœ‰å¯ä»¥å…¼å®¹çš„ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-text">æ™ºèƒ½æŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E6%8C%87%E9%92%88-raw-pointer"><span class="toc-text">çœŸå®æŒ‡é’ˆ(raw pointer)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-text">è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Templates%E5%92%8C%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B-Generic-Programming"><span class="toc-text">Templateså’Œæ³›å‹ç¼–ç¨‹(Generic Programming)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-12"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E6%AC%BE46%EF%BC%9A%E9%9C%80%E8%A6%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%98%AF%E8%AF%B7%E4%B8%BA%E6%A8%A1%E6%9D%BF%E5%AE%9A%E4%B9%89%E9%9D%9E%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-text">æ¡æ¬¾46ï¼šéœ€è¦ç±»å‹è½¬æ¢æ˜¯è¯·ä¸ºæ¨¡æ¿å®šä¹‰éæˆå‘˜å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E6%9D%A1%E6%AC%BE24%E7%9A%84%E4%BE%8B%E5%AD%90%E8%BD%AC%E4%B8%BA%E6%A8%A1%E6%9D%BF"><span class="toc-text">ç¤ºä¾‹ï¼šæ¡æ¬¾24çš„ä¾‹å­è½¬ä¸ºæ¨¡æ¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#friend%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E"><span class="toc-text">friendå‡½æ•°å£°æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%9C%AC%E4%BD%93%E4%B8%8E%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BB%93%E5%90%88-%E7%AE%80%E5%8D%95%E7%89%88"><span class="toc-text">å‡½æ•°æœ¬ä½“ä¸å£°æ˜å¼ç»“åˆ(ç®€å•ç‰ˆ)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#friend%E7%89%B9%E6%AE%8A%E6%84%8F%E4%B9%89"><span class="toc-text">friendç‰¹æ®Šæ„ä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#non-member%E4%B8%8Efriend-member%E5%90%88%E4%BD%9C"><span class="toc-text">non-memberä¸friend memberåˆä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-23"><span class="toc-text">æ€»ç»“</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/07/26/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab10%EF%BC%9Ammap/" title="Mit6.S081:lab mmap"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/202301251415687.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mit6.S081:lab mmap"/></a><div class="content"><a class="title" href="/2023/07/26/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab10%EF%BC%9Ammap/" title="Mit6.S081:lab mmap">Mit6.S081:lab mmap</a><time datetime="2023-07-25T16:00:00.000Z" title="å‘è¡¨äº 2023-07-26 00:00:00">2023-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/17/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab9%EF%BC%9Afs/" title="Mit6.S081:lab fs"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img40.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mit6.S081:lab fs"/></a><div class="content"><a class="title" href="/2023/07/17/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab9%EF%BC%9Afs/" title="Mit6.S081:lab fs">Mit6.S081:lab fs</a><time datetime="2023-07-16T16:00:00.000Z" title="å‘è¡¨äº 2023-07-17 00:00:00">2023-07-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/26/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab8%EF%BC%9Alocks/" title="Mit6.S081:lab locks"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mit6.S081:lab locks"/></a><div class="content"><a class="title" href="/2023/06/26/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab8%EF%BC%9Alocks/" title="Mit6.S081:lab locks">Mit6.S081:lab locks</a><time datetime="2023-06-25T16:00:00.000Z" title="å‘è¡¨äº 2023-06-26 00:00:00">2023-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/15/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab7%EF%BC%9Anet/" title="Mit6.S081:lab net"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img32.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mit6.S081:lab net"/></a><div class="content"><a class="title" href="/2023/06/15/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/lab/Lab7%EF%BC%9Anet/" title="Mit6.S081:lab net">Mit6.S081:lab net</a><time datetime="2023-06-14T16:00:00.000Z" title="å‘è¡¨äº 2023-06-15 00:00:00">2023-06-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Chapter%205%EF%BC%9A%E4%B8%AD%E6%96%AD%E4%B8%8E%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" title="xv6ï¼šä¸­æ–­ä¸è®¾å¤‡é©±åŠ¨"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/202301251417569.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="xv6ï¼šä¸­æ–­ä¸è®¾å¤‡é©±åŠ¨"/></a><div class="content"><a class="title" href="/2023/06/14/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Chapter%205%EF%BC%9A%E4%B8%AD%E6%96%AD%E4%B8%8E%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" title="xv6ï¼šä¸­æ–­ä¸è®¾å¤‡é©±åŠ¨">xv6ï¼šä¸­æ–­ä¸è®¾å¤‡é©±åŠ¨</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By EmberğŸ</div><div class="footer_custom_text"><a href="https://icp.gov.moe/?keyword=20232016" target="_blank">èŒICPå¤‡20232016å·</a> <p>There is only one heroism in the world to see the world as it is and to love it<p><a target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="åšå®¢æ¡†æ¶ä¸ºHexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="ä¸»é¢˜é‡‡ç”¨butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"></a> &nbsp;<a target="_blank" href="https://vercel.com/ "><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œè”é€šçº¿è·¯æ‰˜ç®¡äºCoding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><i class="fas fa-share-nodes"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script src="https://cdn.staticfile.org/algoliasearch/4.14.3/algoliasearch-lite.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.49.0/instantsearch.production.min.js"></script><script src="https://cdn.jsdelivr.net/gh/Lea321/cdn/js/algolia.min.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.ember-l.top',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
        setTimeout(function(){
          let tk_comment = document.querySelectorAll('.tk-comments-container .tk-comment')
          if (tk_comment.length > 0) {
            let html = `<div class="swiper-wrapper">`
            for (let i = 0; i < tk_comment.length; i++) {
              let tk_id = tk_comment[i].getAttribute('id') || ''
              let tk_nick = tk_comment[i].querySelector('.tk-nick')?.innerText || ''
              let tk_href = tk_comment[i].querySelector('.tk-nick')?.href || ''
              let tk_avatar = tk_comment[i].querySelector('.tk-avatar-img')?.src || ''
              let tk_time = tk_comment[i].querySelector('.tk-time')?.innerText || ''
              let tk_city = tk_comment[i].querySelector('.tk-extras .tk-extra:first-child span:last-child')?.innerText || ''
              let tk_content = tk_comment[i].querySelector('.tk-content>span:last-child')?.innerHTML || ''
              tk_content = tk_content.replace(/\n/g, '') // replace \n
              tk_content = tk_content.replace(/<blockquote>.*?<\/blockquote>/gi, '') // replace blockquote
              tk_content = tk_content.replace(/<pre.*?<\/pre>/gi, '[ä»£ç ]') // replace code
              html += `
                <div class="swiper-slide">
                  <div class="comment-barrage-item">
                    <div class="barrage-info">
                      <a class="barrage-title" title="è·³è½¬è‡³è¯„è®ºåŒº" href="#post-comment">çƒ­è¯„</a>
                      <a href="${tk_href ? tk_href + '" target="_blank" rel="noopener noreferrer" title="è®¿é—® '+ tk_nick +'"' : 'javascript:void(0);"'}>
                        <img class="barrage-avatar" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="${tk_avatar}">
                      </a>
                      <span class="barrage-nick">${tk_nick}</span>
                      <span class="barrage-city">${tk_city}</span>
                      <span class="barrage-time">${tk_time}</span>
                      <a class="barrage-close" onclick="eurkon.switchCommentBarrage()" title="éšè—çƒ­è¯„"><i class="fa-solid fa-xmark"></i></a>
                    </div>
                    <div class="barrage-content">
                      <a title="è·³è½¬è‡³è¯¥è¯„è®º" href="#${tk_id}">${tk_content}</a>
                    </div>
                  </div>
                </div>`
            }
            html += '</div>'
            let barrageContainer = document.getElementById('comment-barrage') || document.createElement('div')
            barrageContainer.id = 'comment-barrage'
            barrageContainer.innerHTML = html
            barrageContainer.style.display = window.localStorage.getItem('commentBarrageDisplay') === 'false' ? 'none' : 'block'
            document.getElementById('post-comment').appendChild(barrageContainer)
            var barrageSwiper = new Swiper('#comment-barrage', {
              direction: 'vertical',
              loop: true,
              mousewheel: true,
              autoplay: {
                delay: 3000,
                disableOnInteraction: true,
              }
            })
            barrageContainer.onmouseenter = function () {
              barrageSwiper.autoplay.stop()
            };
            barrageContainer.onmouseleave = function () {
              barrageSwiper.autoplay.start()
            };
          }
        }, 1000)
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.ember-l.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script src="/js/share.js"></script><script src="/js/key.js"></script><script src="/js/barrage.js"></script><script defer src="/js/light.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer data-pjax src="/js/readPercent.js"></script><script async src="//at.alicdn.com/t/c/font_3864328_90xjkz8cfrn.js"></script><script async src="/js/fps.js"></script><script src="/js/nav.js" async></script><script src="/js/sun_moon.js" async></script><script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="/js/txmap.js"></script><script src="/js/charts.js" async></script><script defer data-pjax src="/js/beautify.js"></script><script src="/js/twikoo_beautify.js"></script><script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script> LA.init({id:"Jx18u1PbLX8sXMaz",ck:"Jx18u1PbLX8sXMaz"})</script><script>new LingQue.Monitor().init({id:"Jx18u1PbLX8sXMaz",sendSuspicious:true});</script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/fireworks.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="http://www.ember-l.top/categories/MIT6-824/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“š é˜¿æ¢¨ã®åˆ†å¸ƒå¼ç³»ç»Ÿå­¦ä¹  (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.ember-l.top/categories/C/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ® é˜¿æ¢¨ã®C++å­¦ä¹  (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.ember-l.top/categories/æ“ä½œç³»ç»Ÿ/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ± é˜¿æ¢¨ã®æ“ä½œç³»ç»Ÿå­¦ä¹  (15)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.ember-l.top/categories/Tool/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ“’ é˜¿æ¢¨ã®å¸¸ç”¨å·¥å…· (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="http://www.ember-l.top/categories" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #fed558}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/07/17/æ“ä½œç³»ç»Ÿ/lab/Lab9ï¼šfs/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img40.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-07-17</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/07/17/æ“ä½œç³»ç»Ÿ/lab/Lab9ï¼šfs/&quot;);" href="javascript:void(0);" alt="">Mit6.S081:lab fs</a><div class="blog-slider__text">MITï¼šlab9</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/07/17/æ“ä½œç³»ç»Ÿ/lab/Lab9ï¼šfs/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/07/26/æ“ä½œç³»ç»Ÿ/lab/Lab10ï¼šmmap/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/202301251415687.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-07-26</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/07/26/æ“ä½œç³»ç»Ÿ/lab/Lab10ï¼šmmap/&quot;);" href="javascript:void(0);" alt="">Mit6.S081:lab mmap</a><div class="blog-slider__text">MITï¼šlab4</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/07/26/æ“ä½œç³»ç»Ÿ/lab/Lab10ï¼šmmap/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 1ï¼šæ“ä½œç³»ç»Ÿæ¥å£/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/202301251415687.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-14</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 1ï¼šæ“ä½œç³»ç»Ÿæ¥å£/&quot;);" href="javascript:void(0);" alt="">xv6ï¼šæ“ä½œç³»ç»Ÿæ¥å£</a><div class="blog-slider__text">MITï¼šxv6 chapter1</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 1ï¼šæ“ä½œç³»ç»Ÿæ¥å£/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/01/20/åˆ†å¸ƒå¼ç³»ç»Ÿ/FaRMè®ºæ–‡ç¬”è®°/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/202301251417569.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-20</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/01/20/åˆ†å¸ƒå¼ç³»ç»Ÿ/FaRMè®ºæ–‡ç¬”è®°/&quot;);" href="javascript:void(0);" alt="">FaRM</a><div class="blog-slider__text">No compromises:distributed transactions with consistency, availability, and performance</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/01/20/åˆ†å¸ƒå¼ç³»ç»Ÿ/FaRMè®ºæ–‡ç¬”è®°/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 2ï¼šæ“ä½œç³»ç»Ÿç»„æˆ/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img21.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-14</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 2ï¼šæ“ä½œç³»ç»Ÿç»„æˆ/&quot;);" href="javascript:void(0);" alt="">xv6ï¼šæ“ä½œç³»ç»Ÿç»„æˆ</a><div class="blog-slider__text">MITï¼šxv6 chapter2</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 2ï¼šæ“ä½œç³»ç»Ÿç»„æˆ/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/03/14/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/Sharded KV Service/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img31.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-14</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/03/14/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/Sharded KV Service/&quot;);" href="javascript:void(0);" alt="">Lab4:Shards KV Service(æœªå®Œå–„)</a><div class="blog-slider__text">MIT6.824 lab4å®ç°# æè¿°</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/03/14/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/Sharded KV Service/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/01/20/C++/Effective C++/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img32.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-20</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/01/20/C++/Effective C++/&quot;);" href="javascript:void(0);" alt="">Effect C++ç¬”è®°</a><div class="blog-slider__text">Effective C++ çš„éƒ¨åˆ†å­¦ä¹ ç¬”è®°</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/01/20/C++/Effective C++/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/01/20/åˆ†å¸ƒå¼ç³»ç»Ÿ/Spannerè®ºæ–‡ç¬”è®°/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img30.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-20</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/01/20/åˆ†å¸ƒå¼ç³»ç»Ÿ/Spannerè®ºæ–‡ç¬”è®°/&quot;);" href="javascript:void(0);" alt="">Spanner</a><div class="blog-slider__text">No compromises:distributed transactions with consistency, availability, and performance</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/01/20/åˆ†å¸ƒå¼ç³»ç»Ÿ/Spannerè®ºæ–‡ç¬”è®°/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/01/13/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/KVRaft/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img8.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-01-13</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/01/13/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/KVRaft/&quot;);" href="javascript:void(0);" alt="">Lab:KVRaft</a><div class="blog-slider__text">MIT6.824 lab3å®ç°# æè¿°</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/01/13/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/KVRaft/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 3ï¼šé¡µè¡¨/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img10.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-14</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 3ï¼šé¡µè¡¨/&quot;);" href="javascript:void(0);" alt="">xv6ï¼šé¡µè¡¨</a><div class="blog-slider__text">MITï¼šxv6 chapter3</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/03/14/æ“ä½œç³»ç»Ÿ/Chapter 3ï¼šé¡µè¡¨/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2023/03/14/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/Debug/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ember-img.oss-cn-chengdu.aliyuncs.com/img25.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-14</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2023/03/14/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/Debug/&quot;);" href="javascript:void(0);" alt="">Debugging by Pretty Printing</a><div class="blog-slider__text">Lab2ï¼šRaftç¾åŒ–è°ƒè¯•å·¥å…·é…ç½®æ–¹æ³•</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2023/03/14/åˆ†å¸ƒå¼ç³»ç»Ÿ/å®éªŒ/Debug/&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1s');
    arr[i].setAttribute('data-wow-delay', '700ms');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --></body></html>